<!--#set var="section" value="documentation" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
    <h1>READ_CONFIG</h1>Section: Net-SNMP (3)<br />
    Updated: 07 Mar 2002<br />
    <a href="#index">Index</a> <a href="../index.html">Return to Main Contents</a>
    <hr />
    <a name="lbAB" id="lbAB">&nbsp;</a>

    <h2>NAME</h2>register_config_handler, register_premib_handler unregister_config_handler, register_mib_handlers, read_configs,
    read_premib_configs, config_perror, config_pwarn - read_config functions <a name="lbAC" id="lbAC">&nbsp;</a>

    <h2>SYNOPSIS</h2><b>#include &lt;<a href="file:/usr/include/net-snmp/config_api.h">net-snmp/config_api.h</a>&gt;</b>

    <p><b>struct config_line *</b><br />
    <b>register_config_handler(const char *</b><i>filePrefix</i><b>,</b><br />
    <b>const char *</b><i>token</i><b>,</b><br />
    <b>void (*</b><i>parser</i><b>)(const char *, char *),</b><br />
    <b>void (*</b><i>releaser</i><b>)(void),</b><br />
    <b>const char *usageLine</b><i>);</i></p>

    <p><b>struct config_line *</b><br />
    <b>register_premib_handler(const char *</b><i>filePrefix</i><b>,</b><br />
    <b>const char *</b><i>token</i><b>,</b><br />
    <b>void (*</b><i>parser</i><b>)(const char *, char *),</b><br />
    <b>void (*</b><i>releaser</i><b>)(void),</b><br />
    <b>const char *</b><i>usageLine</i><b>);</b></p>

    <p><b>void unregister_config_handler(const char *</b><i>filePrefix</i><b>,</b><br />
    <b>const char *</b><i>token</i><b>);</b></p>

    <p><b>struct config_line *</b><br />
    <b>register_app_config_handler(const char *</b><i>token</i><b>,</b><br />
    <b>void (*</b><i>parser</i><b>)(const char *, char *),</b><br />
    <b>void (*</b><i>releaser</i><b>)(void),</b><br />
    <b>const char *usageLine</b><i>);</i></p>

    <p><b>struct config_line *</b><br />
    <b>register_app_premib_handler(const char *</b><i>token</i><b>,</b><br />
    <b>void (*</b><i>parser</i><b>)(const char *, char *),</b><br />
    <b>void (*</b><i>releaser</i><b>)(void),</b><br />
    <b>const char *</b><i>usageLine</i><b>);</b></p>

    <p><b>void unregister_app_config_handler(const char *</b><i>token</i><b>);</b></p>

    <p><b>void read_config_print_usage(char *</b><i>lead</i><b>);</b></p>

    <p><b>void read_configs(void);</b></p>

    <p><b>void read_premib_configs(void);</b></p>

    <p><b>void config_pwarn(const char *</b><i>string</i><b>);</b><br />
    <b>void config_perror(const char *</b><i>string</i><b>);</b></p>

    <p><a name="lbAD" id="lbAD">&nbsp;</a></p>

    <h2>DESCRIPTION</h2>The functions are a fairly extensible system of parsing various configuration files at the run time of an
    application. The configuration file flow is broken into the following phases:

    <dl compact="compact">
      <dd>
        <dl compact="compact">
          <dt>1.</dt>

          <dd>Registration of handlers.</dd>

          <dt>2.</dt>

          <dd>Reading of the configuration files for pre-MIB parsing requirements.</dd>

          <dt>3.</dt>

          <dd>Reading and parsing of the textual MIB files.</dd>

          <dt>4.</dt>

          <dd>Reading of the configuration files for configuration directives.</dd>

          <dt>5.</dt>

          <dd>Optionally re-reading the configuration files at a future date.</dd>
        </dl>
      </dd>
    </dl>

    <p>The idea is that the calling application is able to register <i>handlers</i> for certain <i>tokens</i> specified in
    certain types of <i>files.</i> The <b>read_configs()</b> function can then be called to look for all the files that it has
    registrations for, find the first word on each line, and pass the remainder to the appropriately registered handler. <a name=
    "lbAE" id="lbAE">&nbsp;</a></p>

    <h2>TOKEN HANDLERS</h2>

    <p>Handler functions should have the following signature:</p>

    <dl compact="compact">
      <dd><b>void handler(const char *</b><i>token</i><b>, char *</b><i>line</i><b>);</b></dd>
    </dl>

    <p>The function will be called with two arguments, the first being the token that triggered the call to this function (which
    would be one of the tokens that the function had been registered for), and the second being the remainder of the
    configuration file line beyond the white space following the token. <a name="lbAF" id="lbAF">&nbsp;</a></p>

    <h2>RESOURCE FREEING HANDLERS</h2>

    <p>If the parameter <i>releaser</i> passed to <b>register_config_handler</b> is non-NULL, then the function specified is
    called if and when the configuration files are re-read. This function should free any resources allocated by the token
    handler function and reset its notion of the configuration to its default. The token handler function will then be called
    again. No arguments are passed to the resource freeing handler. <a name="lbAG" id="lbAG">&nbsp;</a></p>

    <h2>REGISTERING A HANDLER</h2>

    <dl compact="compact">
      <dt><b>register_config_handler()</b></dt>

      <dd>The <b>handler()</b> function above could be registered for the configuration file <i>snmp.conf,</i> with the token
      <i>genericToken</i> and the help string (discussed later) <i>ARG1 [ARG2]</i> using the following call to the
      <b>register_config_handler()</b> function:</dd>
    </dl>

    <dl compact="compact">
      <dd>
        <dl compact="compact">
          <dd>register_config_handler("snmp", "genericToken", handler, NULL, "ARG1 [ARG2]");</dd>
        </dl>
      </dd>
    </dl>

    <dl compact="compact">
      <dd>This would register the <b>handler()</b> function so that it will get called every time the first word of a line in the
      <i>snmp.conf</i> configuration file(s) matches "genericToken" (see <b>read_configs()</b> below).</dd>

      <dt><b>register_premib_handler()</b></dt>

      <dd>The <b>register_premib_handler()</b> function works identically to the <b>register_config_handler()</b> function but is
      intended for config file tokens that need to be read in before the textual MIBs are read in, probably because they will be
      used to configure the MIB parser. It is rarely the case that anything but the SNMP library itself should need to use this
      function.</dd>

      <dt><b>unregister_config_handler()</b></dt>

      <dd>Removes the registered configuration handler for the <i>filePrefix</i> and <i>token</i>.</dd>

      <dt><b>register_app_config_handler()</b></dt>

      <dt><b>register_app_premib_handler()</b></dt>

      <dt><b>unregister_app_config_handler()</b></dt>

      <dd>These functions are analagous to <b>register_config_handler()</b>, <b>register_premib_handler()</b> and
      <b>unregister_config_handler()</b> but don't require the file type argument (which is filled in by the application). It is
      intended that MIB modules written for the agent use these functions to allow the agent to have more control over which
      configuration files are read (typically the <i>snmpd.conf</i> files).</dd>
    </dl><a name="lbAH" id="lbAH">&nbsp;</a>

    <h2>HELP STRINGS</h2>

    <p>The <i>usageLine</i> parameter passed to <b>register_config_handler()</b> and similar calls, is used to display help
    information when the <b>read_config_print_usage()</b> function is called. This function is used by all of the applications
    when the <b>-H</b> flag is passed on the command line. It prints a summary of all of the configuration file lines, and the
    associated files, that the configuration system understands. The <i>usageLine</i> parameter should be a list of arguments
    expected after the token, and not a lengthy description (which should go into a manual page instead). The <i>lead</i> prefix
    will be prepended to each line that the function prints to stderr, where it displays its output.</p>

    <p>The <b>init_snmp()</b> function should be called before the <b>read_config_print_usage()</b> function is called, so that
    the library can register its configuration file directives as well for the <b>read_config_print_usage()</b> function to
    display. <a name="lbAI" id="lbAI">&nbsp;</a></p>

    <h2>READING CONFIGURATION FILES</h2>

    <dl compact="compact">
      <dt><b>init_snmp()</b></dt>

      <dd>Once the relevant configuration token parsers have been registered, <b>init_snmp()</b> should be called. It will parse
      the configuration file tokens registered with <b>register_premib_handler(),</b> read in the textual MIB files using
      <b>init_mib(),</b> and finally parse the configuration file tokens registered with <b>register_config_handler()</b>.</dd>
    </dl>

    <p>If the <b>init_snmp()</b> function is used, none of the following functions need to be called by the application:</p>

    <dl compact="compact">
      <dt><b>register_mib_handlers()</b></dt>

      <dd>The SNMP library's routine to register its configuration file handlers.</dd>

      <dt><b>read_premib_configs()</b></dt>

      <dd>The routine that parses the configuration files for tokens registered to be dealt with before the textual MIBs are read
      in. See <b>read_configs()</b> below.</dd>

      <dt><b>read_configs()</b></dt>

      <dd>Reads all the configuration files it can find in the <i>SNMPCONFPATH</i> environment variable (or its default value)
      for tokens and appropriately calls the handlers registered to it, or prints a "Unknown token" warning message. It looks for
      any file that it has previously received a registration request for.</dd>
    </dl><a name="lbAJ" id="lbAJ">&nbsp;</a>

    <h2>CONFIGURATION FILES READ</h2>

    <p>The configuration files read are found by using the colon separated <i>SNMPCONFPATH</i> environment variable (or its
    default value, which will be /usr/local/etc/snmp, followed by /usr/local/share/snmp, followed by /usr/local/lib/snmp,
    followed by $HOME/.snmp) and reading in the files found that match both the prefix registered and the two suffixes
    <i>.conf</i> and <i>.local.conf.</i> The idea behind the two different suffixes is that the first file can be shared (via
    rdist or an NFS mount) across a large number of machines and the second file can be used to configure local settings for one
    particular machine. They do not need to be present, and will only be read if found. <a name="lbAK" id="lbAK">&nbsp;</a></p>

    <h2>ERROR HANDLING FUNCTIONS</h2>

    <p>The two functions <b>config_pwarn()</b> and <b>config_perror()</b> both take an error string as an argument and print it
    to stderr along with the file and line number that caused the error. A call to the second function will also force
    <b>read_configs()</b> to eventually return with an error code indicating to it's calling function that it should abort the
    operation of the application. <a name="lbAL" id="lbAL">&nbsp;</a></p>

    <h2>ENVIRONMENT VARIABLES</h2>

    <dl compact="compact">
      <dt>SNMPCONFPATH</dt>

      <dd>A colon separated list of directories to search for configuration files in. Default:
      /usr/local/etc/snmp:/usr/local/share/snmp:/usr/local/lib/snmp:$HOME/.snmp</dd>
    </dl><a name="lbAM" id="lbAM">&nbsp;</a>

    <h2>SEE ALSO</h2><b><a href="mib_api.html">mib_api</a></b>(3), <b><a href="snmp_api.html">snmp_api</a></b>(3)
    <hr />
    <a name="index" id="index">&nbsp;</a>

    <h2>Index</h2>

    <dl>
      <dt><a href="#lbAB">NAME</a></dt>

      <dt><a href="#lbAC">SYNOPSIS</a></dt>

      <dt><a href="#lbAD">DESCRIPTION</a></dt>

      <dt><a href="#lbAE">TOKEN HANDLERS</a></dt>

      <dt><a href="#lbAF">RESOURCE FREEING HANDLERS</a></dt>

      <dt><a href="#lbAG">REGISTERING A HANDLER</a></dt>

      <dt><a href="#lbAH">HELP STRINGS</a></dt>

      <dt><a href="#lbAI">READING CONFIGURATION FILES</a></dt>

      <dt><a href="#lbAJ">CONFIGURATION FILES READ</a></dt>

      <dt><a href="#lbAK">ERROR HANDLING FUNCTIONS</a></dt>

      <dt><a href="#lbAL">ENVIRONMENT VARIABLES</a></dt>

      <dt><a href="#lbAM">SEE ALSO</a></dt>
    </dl>
    <hr />
    This document was created by <a href="http://localhost/cgi-bin/man/man2html">man2html</a>, using the manual pages.<br />
    Time: 13:12:01 GMT, September 23, 2007
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

