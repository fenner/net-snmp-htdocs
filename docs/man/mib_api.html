<!--#set var="section" value="documentation" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
    <h1>MIB_API</h1>Section: Net-SNMP (3)<br />
    Updated: 06 Mar 2002<br />
    <a href="#index">Index</a> <a href="../index.html">Return to Main Contents</a>
    <hr />
    <a name="lbAB" id="lbAB"> </a>

    <h2>NAME</h2>init_mib, add_mibdir, init_mib_internals, add_module_replacement, read_module, read_mib, read_all_mibs,
    read_objid, read_module_node, get_module_node, snmp_set_mib_warnings, snmp_set_save_descriptions, shutdown_mib, print_mib,
    print_variable, fprint_variable, snprint_variable, sprint_realloc_variable, print_value, fprint_value, snprint_value,
    sprint_realloc_value, print_objid, fprint_objid, snprint_objid, sprint_realloc_objid, print_description, fprint_description -
    mib_api functions <a name="lbAC" id="lbAC"> </a>

    <h2>SYNOPSIS</h2><b>#include &lt;<a href="file:/usr/include/net-snmp/mib_api.h">net-snmp/mib_api.h</a>&gt;</b>

    <p><b>void init_mib(void);</b><br />
    <b>int add_mibdir(char *</b><i>dirname</i><b>);</b><br />
    <b>int add_module_replacement(char *</b><i>old_module</i><b>, char *</b><i>new_module</i><b>, char *</b><i>tag</i><b>,
    int</b> <i>len</i><b>);</b><br />
    <b>void init_mib_internals(void);</b><br />
    <b>struct tree *read_module(char *</b><i>name</i><b>);</b><br />
    <b>struct tree *read_mib(char *</b><i>filename</i><b>);</b><br />
    <b>struct tree *read_all_mibs(void);</b></p>

    <p><b>void shutdown_mib(void);</b></p>

    <p><b>void print_mib(FILE *</b><i>fp</i><b>);</b></p>

    <p><b>int read_objid(char *</b><i>input</i><b>, oid *</b><i>output</i><b>, size_t *</b><i>out_len</i><b>);</b><br />
    <b>int get_module_node(const char *</b><i>name</i><b>, const char *</b><i>module</i><b>, oid *</b><i>objid</i><b>, size_t
    *</b><i>objidlen</i><b>);</b></p>

    <p><b>void print_variable(const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>, const netsnmp_variable_list
    *</b><i>variable</i><b>);</b><br />
    <b>void fprint_variable(FILE *</b><i>fp</i><b>, const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>, const
    netsnmp_variable_list *</b><i>variable</i><b>);</b><br />
    <b>int snprint_variable(char *</b><i>buf</i><b>, size_t</b> <i>len</i><b>, const oid *</b><i>objid</i><b>, size_t</b>
    <i>objidlen</i><b>, const netsnmp_variable_list *</b><i>variable</i><b>);</b><br />
    <b>int sprint_realloc_variable(u_char **</b><i>buf</i><b>, size_t *</b><i>buf_len</i><b>, size_t *</b><i>out_len</i><b>,
    int</b> <i>allow_realloc</i><b>, const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>, const netsnmp_variable_list
    *</b><i>variable</i><b>);</b></p>

    <p><b>void print_value(oid *objid, size_t objidlen, const netsnmp_variable_list *variable)</b><br />
    <b>void fprint_value(FILE *</b><i>fp</i><b>, const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>, const
    netsnmp_variable_list *</b><i>variable</i><b>);</b><br />
    <b>int snprint_value(char *</b><i>buf</i><b>, size_t</b> <i>len</i><b>, const oid *</b><i>objid</i><b>, size_t</b>
    <i>objidlen</i><b>, const netsnmp_variable_list *</b><i>variable</i><b>);</b><br />
    <b>int sprint_realloc_value(u_char **</b><i>buf</i><b>, size_t *</b><i>buf_len</i><b>, size_t *</b><i>out_len</i><b>, int</b>
    <i>allow_realloc</i><b>, const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>, const netsnmp_variable_list
    *</b><i>variable</i><b>);</b></p>

    <p><b>void print_objid(const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>);</b><br />
    <b>void fprint_objid(FILE *</b><i>fp</i><b>, const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>);</b><br />
    <b>int snprint_objid(char *</b><i>buf</i><b>, size_t</b> <i>len</i><b>, const oid *</b><i>objid</i><b>, size_t</b>
    <i>objidlen</i><b>);</b><br />
    <b>int sprint_realloc_objid(u_char **</b><i>buf</i><b>, size_t *</b><i>buf_len</i><b>, size_t *</b><i>out_len</i><b>, int
    allow_realloc</b><i>, const oid *</i><b>objid</b><i>, size_t</i> <b>objidlen</b><i>);</i></p>

    <p><b>void print_description(oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>, int</b> <i>width</i><b>);</b><br />
    <b>void fprint_description(FILE *</b><i>fp</i><b>, const oid *</b><i>objid</i><b>, size_t</b> <i>objidlen</i><b>, int</b>
    <i>width</i><b>);</b></p>

    <p><b>void snmp_set_mib_warnings(int</b> <i>level</i><b>);</b><br />
    <b>void snmp_set_save_descriptions(int</b> <i>save</i><b>);</b></p>

    <p><a name="lbAD" id="lbAD"> </a></p>

    <h2>DESCRIPTION</h2>The functions dealing with MIB modules fall into four groups. Those dealing with initialisation and
    shutdown, those that read in and parse MIB files, those that search the MIB tree, and various output routines. <a name="lbAE"
    id="lbAE"> </a>

    <h3>Initialisation and Shutdown</h3><b>init_mib</b> is a convenience function that handles all calls to <b>add_mibdir</b>,
    <b>read_module</b> and <b>read_mib</b> for standard applications. It should be called before any other routine that
    manipulates or accesses the MIB tree. This routine sets up various internal structures, as well as reading in the default MIB
    modules, as detailed below.

    <p><b>add_mibdir</b> is used to define the range of directory locations which are searched for files containing MIB modules
    (one module per file). By default, this will be set to the directory <i>/usr/local/share/mibs</i> but this can be overridden
    by setting the environment variable <i>MIBDIRS</i> to a (colon-separated) list of directories to search. Note that this does
    not actually load the MIB modules located in that directory, but is an initialisation step to make them available. This
    function returns a count of files found in the directory, or a -1 if there is an error.</p>

    <p><b>init_mib_internals</b> sets up the internal structures, preparatory to reading in MIB modules. It should be called
    after all calls to <b>add_mibdir</b>, and before and calls to <b>read_module</b>. This is called automatically if
    <b>init_mib</b> is used.</p>

    <p><b>shutdown_mib</b> will clear the information that was gathered by <b>read_module</b>, <b>add_mibdir</b> and
    <b>add_module_replacement</b>. It is strongly recommended that one does not invoke <b>shutdown_mib</b> while there are SNMP
    sessions being actively managed. <a name="lbAF" id="lbAF"> </a></p>

    <h3>Reading and Parsing MIBs</h3><b>add_module_replacement</b> can be used to allow new MIB modules to obsolete older ones,
    without needing to amend the imports clauses of other modules. It takes the names of the old and new modules, together with
    an indication of which portions of the old module are affected.

    <dl compact="compact">
      <dd>
        <table>
          <tr valign="top">
            <td><b>tag</b></td>

            <td><b>len</b></td>

            <td><b>load the new module when:</b><br /></td>
          </tr>

          <tr valign="top">
            <td>NULL</td>

            <td>0</td>

            <td>always (the old module is a strict subset of the new)<br /></td>
          </tr>

          <tr valign="top">
            <td>name</td>

            <td>0</td>

            <td>for the given tag only<br /></td>
          </tr>

          <tr valign="top">
            <td>name</td>

            <td>non-0</td>

            <td>for any identifier with this prefix<br /></td>
          </tr>
        </table>
      </dd>
    </dl>It can also be used to handle errors in the module identifiers used in MIB import clauses (such as referring to
    <i>RFC1213</i> instead of <i>RFC1213-MIB</i>).

    <p><b>read_module</b> locates and parses the module specified, together with any modules that it imports from, and adds the
    contents of these modules to the active MIB tree. Note that <b>add_mibdir</b> must first be called to add the directory
    containing the file with the module definition, if this is not in the standard path.<br />
    By default, the following MIB modules will be loaded: IP-MIB, IF-MIB, TCP-MIB, UDP-MIB, SNMPv2-MIB, RFC1213-MIB,
    UCD-SNMP-MIB. This can be overridden by setting the environment variable <i>MIBS</i> to a (colon-separated) list of modules
    to load. If this variable starts with a plus character, then the specified modules are added to the default list. Otherwise
    only those modules listed are loaded (together with any others they import from). If <i>MIBS</i> is set to <i>ALL</i>,
    <b>read_all_mibs</b> is called to load all the MIB files found in all the specified <i>MIBDIRS</i>.</p>

    <p><b>read_mib</b> parses the file specified, together with any modules that it imports from, and adds the contents to the
    active MIB tree. Such a file can contain more then one module, though care must be taken that any imports occur earlier in
    the file, if they are not to be read from the installed modules. Note that the file specified does not need to be in any of
    the directories initialised by <b>add_mibdir</b> (or the default setup), though any imported modules do.<br />
    The environment variable <i>MIBFILES</i> can be set to a (colon-separated) list of files containing MIBs to load.</p>

    <p><b>read_objid</b> takes a string containing a textual version of an object identifier (in either numeric or descriptor
    form), and transforms this into the corresponding list of sub-identifiers. This is returned in the <i>output</i> parameter,
    with the number of sub-identifiers returned via <i>out_len</i>. When called, <i>out_len</i> must hold the maximum length of
    the <i>output</i> array. This function returns a value of 1 if it succeeds in parsing the string and 0 otherwise. <a name=
    "lbAG" id="lbAG"> </a></p>

    <h3>Searching the MIB Tree</h3><b>get_module_node</b> takes a descriptor and the name of a module, and returns the
    corresponding oid list, in the same way as <b>read_objid</b> above.<br />
    If the module name is specified as "ANY", then this routine will assume that the descriptor given is unique within the tree,
    and will return the matching entry. If this assumption is invalid, then the behaviour as to which variable is returned is
    implementation dependent. <a name="lbAH" id="lbAH"> </a>

    <h3>Output</h3><b>print_mib</b> will print out a representation of the currently active MIB tree to the specified FILE
    pointer.

    <p><b>print_variable</b> will take an object identifier (as returned by <b>read_objid</b> or <b>get_module_node</b>) and an
    instance of such a variable, and prints to the standard output the textual form of the object identifier together with the
    value of the variable. <b>fprint_variable</b> does the same, but prints to the FILE pointer specified by the initial
    parameter.<br />
    <b>snprint_variable</b> prints the same information into the buffer pointed to by <i>buf</i> which is of length <i>len</i>
    and returns either the number of characters printed, or -1 if the buffer was not large enough. In the latter case, <i>buf</i>
    will typically contained a truncated version of the information (but this behaviour is not guaranteed). This function
    replaces the obsolete function <b>sprint_variable</b>.<br />
    <b>sprint_realloc_variable</b> is the low-level function used to implement all these functions. It prints to a specified
    offset in a string buffer. The <i>buf</i> parameter points to a pointer to that buffer; <i>buf_len</i> points to a variable
    holding the current size of that buffer, and <i>out_len</i> points to a variable holding the offset to which to print.
    <i>out_len</i> will be updated to hold the offset of the character following the last one added to the buffer. If
    <i>allow_realloc</i> is 1, the buffer will be dynamically expanded, as necessary, to hold the output; the variables pointed
    to by <i>buf</i> and <i>buf_len</i> will be updated. If <i>allow_realloc</i> is 0, the buffer will not be dynamically
    expanded. <b>sprint_realloc_variable</b> returns 0 if <i>allow_realloc</i> is 1 and an attempt to allocate memory to expand
    the buffer fails, or if <i>allow_realloc</i> is 0 and the output wouldn't fit in the buffer. Otherwise it returns 1. When
    using this function you should be careful to call <b><a href="free.html">free</a></b>(3) on <i>*buf</i> when you have
    finished with it.</p>

    <p><b>print_value</b>, <b>fprint_value</b>, <b>snprint_value</b> and <b>sprint_realloc_value</b> do the same as the
    equivalent <b>print_variable</b> routines, but only displaying the value of the variable, without the corresponding object
    identifier.</p>

    <p><b>print_objid</b>, <b>fprint_objid</b>, <b>snprint_objid</b>, and <b>sprint_realloc_objid</b> take an object identifier
    (without an accompanying variable instance) and print out the textual representation.</p>

    <p><b>print_description</b> and <b>fprint_description</b> take an object identifier (as for <b>print_objid</b> above) and
    print out the associated DESCRIPTION clause. The <i>width</i> argument gives the number of subidentifiers of an OID, e.g.,
    .1.3.6 is composed of 3 subidentifiers.</p>

    <p>Note that there are no corresponding routines <b>snprint_description</b> or <b>sprint_realloc_description</b>. By default
    the parser does not save descriptions since they may be huge. In order to be able to print them, you must call <b><a href=
    "snmp_set_save_descriptions.html">snmp_set_save_descriptions</a>(1)</b>.</p>

    <p>In general the parser is silent about what strangenesses it sees in the MIB files. To get warnings reported, call
    <b>snmp_set_mib_warnings</b> with a <i>level</i> of 1 (or 2 for even more warnings). <a name="lbAI" id="lbAI"> </a></p>

    <h2>ENVIRONMENT VARIABLES</h2>

    <dl compact="compact">
      <dt>MIBDIRS</dt>

      <dd>A colon separated list of directories to search for MIB modules. Default: /usr/local/share/snmp/mibs</dd>

      <dt>MIBFILES</dt>

      <dd>A colon separated list of files to load. Default: (none)</dd>

      <dt>MIBS</dt>

      <dd>A colon separated list of MIB modules to load. Default:
      IP-MIB:IF-MIB:TCP-MIB:UDP-MIB:SNMPv2-MIB:RFC1213-MIB:UCD-SNMP-MIB.</dd>
    </dl><a name="lbAJ" id="lbAJ"> </a>

    <h2>SEE ALSO</h2><b><a href="snmp_api.html">snmp_api</a></b>(3)
    <hr />
    <a name="index" id="index"> </a>

    <h2>Index</h2>

    <dl>
      <dt><a href="#lbAB">NAME</a></dt>

      <dt><a href="#lbAC">SYNOPSIS</a></dt>

      <dt><a href="#lbAD">DESCRIPTION</a></dt>

      <dd>
        <dl>
          <dt><a href="#lbAE">Initialisation and Shutdown</a></dt>

          <dt><a href="#lbAF">Reading and Parsing MIBs</a></dt>

          <dt><a href="#lbAG">Searching the MIB Tree</a></dt>

          <dt><a href="#lbAH">Output</a></dt>
        </dl>
      </dd>

      <dt><a href="#lbAI">ENVIRONMENT VARIABLES</a></dt>

      <dt><a href="#lbAJ">SEE ALSO</a></dt>
    </dl>
    <hr />
    This document was created by <a href="http://localhost/cgi-bin/man/man2html">man2html</a>, using the manual pages.<br />
    Time: 01:51:45 GMT, October 29, 2004
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

