<!--#set var="section" value="documentation" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
    <h1>SNMPUSM</h1>Section: Net-SNMP (1)<br />
    Updated: 22 Oct 2005<br />
    <a href="#index">Index</a> <a href="../index.html">Return to Main Contents</a>
    <hr />
    <a name="lbAB" id="lbAB"> </a>

    <h2>NAME</h2>snmpusm - creates and maintains SNMPv3 users on a network entity <a name="lbAC" id="lbAC"> </a>

    <h2>SYNOPSIS</h2><b>snmpusm</b> [COMMON OPTIONS] [-CE ENGINE-ID] <b>create</b> USER [CLONEFROM-USER]<br />
    <b>snmpusm</b> [COMMON OPTIONS] [-CE ENGINE-ID] <b>delete</b> USER<br />
    <b>snmpusm</b> [COMMON OPTIONS] [-CE ENGINE-ID] <b>cloneFrom</b> USER CLONEFROM-USER<br />
    <b>snmpusm</b> [COMMON OPTIONS] [-CE ENGINE-ID] [-Ca] [-Cx] <b>passwd</b> OLD-PASSPHRASE NEW-PASSPHRASE [USER]<br />
    <b>snmpusm</b> [COMMON OPTIONS] [-CE ENGINE-ID] &lt;-Ca | -Cx&gt; -Ck <b>passwd</b> OLD-KEY-OR-PASSPHRASE
    NEW-KEY-OR-PASSPHRASE [USER]<br />
    <b>snmpusm</b> [COMMON OPTIONS] [-CE ENGINE-ID] [-Ca] [-Cx] <b>changekey [USER]</b>

    <p><a name="lbAD" id="lbAD"> </a></p>

    <h2>DESCRIPTION</h2><b>snmpusm</b> is an SNMP application that can be used to do simple maintenance on the users known to an
    SNMP agent, by manipulating the agent's User-based Security Module (USM) table. The user needs write access to the
    usmUserTable MIB table. This tool can be used to create, delete, clone, and change the passphrase of users configured on a
    running SNMP agent.

    <p><a name="lbAE" id="lbAE"> </a></p>

    <h2>OPTIONS</h2>

    <dl compact="compact">
      <dt><b>-CE</b> <i>ENGINE-ID</i></dt>

      <dd>Set usmUserEngineID to be used as part of the index of the usmUserTable. Default is to use the contextEngineID (set via
      -E or probed) as the usmUserEngineID.</dd>

      <dt><b>-Ca</b></dt>

      <dd>Change the authentication key.</dd>

      <dt><b>-Cx</b></dt>

      <dd>Change the privacy key.</dd>

      <dt><b>-Ck</b></dt>

      <dd>Allows to use localized key (must start with 0x) instead of passphrase. When this option is used, either the -Ca or -Cx
      (but not both) option must also be used.</dd>
    </dl><a name="lbAF" id="lbAF"> </a>

    <h2>CREATING USERS</h2>

    <p>An unauthenticated SNMPv3 user can be created using the command</p>

    <dl compact="compact">
      <dd><b>snmpusm</b> [-CE ENGINE-ID] create USER</dd>
    </dl>

    <p>This constructs an (inactive) entry in the usmUserTable, with no authentication or privacy settings. In principle, this
    user should be useable for 'noAuthNoPriv' requests, but in practise the Net-SNMP agent will not allow such an entry to be
    made active.</p>

    <p>In order to activate this entry, it is necessary to "clone" an existing user, using the command</p>

    <dl compact="compact">
      <dd><b>snmpusm</b> [-CE ENGINE-ID] cloneFrom USER CLONEFROM-USER</dd>
    </dl>

    <p>The USER entry then inherits the same authentication and privacy settings (including pass phrases) as the CLONEFROM
    user.</p>

    <p>These two steps can be combined into one, by using the command</p>

    <dl compact="compact">
      <dd><b>snmpusm</b> [-CE ENGINE-ID] create USER CLONEFROM-USER</dd>
    </dl>

    <p>The two forms of the <b>create</b> sub-command require that the user being created does not already exist. The
    <b>cloneFrom</b> sub-command requires that the user being cloned to <i>does</i> already exist.</p>

    <p>Cloning is the only way to specify which authentication and privacy protocols to use for a given user, and it is only
    possible to do this once. Subsequent attempts to reclone onto the same user will appear to succeed, but will be silently
    ignored. This (somewhat unexpected) behaviour is mandated by the SNMPv3 USM specifications (RFC 3414). To change the
    authentication and privacy settings for a given user, it is necessary to delete and recreate the user entry. This is
    <i>not</i> necessary for simply changing the pass phrases (see below). This means that the agent must be initialized with at
    least one user for each combination of authentication and privacy protocols. See the <i><a href=
    "snmpd.conf.html">snmpd.conf</a>(5)</i> manual page for details of the <b>createUser</b> configuration directive.</p>

    <p><a name="lbAG" id="lbAG"> </a></p>

    <h2>DELETING USERS</h2>A user can be deleted from the usmUserTable using the command

    <dl compact="compact">
      <dd><b>snmpusm</b> [-CE ENGINE-ID] delete USER</dd>
    </dl><a name="lbAH" id="lbAH"> </a>

    <h2>CHANGING PASS PHRASES</h2>User profiles contain private keys that are never transmitted over the wire in clear text
    (regardless of whether the administration requests are encrypted or not). To change the secret key for a user, it is
    necessary to specify the user's old passphrase as well as the new one. This uses the command

    <dl compact="compact">
      <dd><b>snmpusm</b> [-CE ENGINE-ID] [-Ca] [-Cx] passwd OLD-PASSPHRASE NEW-PASSPHRASE [USER]</dd>
    </dl>

    <p>After cloning a new user entry from the appropriate template, you should immediately change the new user's passphrase.</p>

    <p>If USER is not specified, this command will change the passphrase of the (SNMPv3) user issuing the command. If the -Ca or
    -Cx options are specified, then only the authentication or privacy keys are changed. If these options are not specified, then
    both the authentication and privacy keys are changed.</p>

    <dl compact="compact">
      <dd><b>snmpusm</b> [-CE ENGINE-ID] [-Ca] [-Cx] changekey [USER]</dd>
    </dl>

    <p>This command changes the key in a perfect-forward-secrecy compliant way through a diffie-helman exchange. The remote agent
    must support the SNMP-USM-DH-OBJECTS-MIB for this command to work. The resulting keys are printed to the console and may be
    then set in future command invocations using the --defAuthLocalizedKey and --defPrivLocalizedKey options or in your snmp.conf
    file using the defAuthLocalizedKey and defPrivLocalizedKey keywords.</p>

    <p>Note that since these keys are randomly generated based on a diffie helman exchange, they are no longer derived from a
    more easily typed password. They are, however, much more secure.</p>

    <p>To change from a localized key back to a password, the following variant of the <b>passwd</b> sub-command is used:</p>

    <dl compact="compact">
      <dd><b>snmpusm</b> [-CE ENGINE-ID] &lt;-Ca | -Cx&gt; -Ck passwd OLD-KEY-OR-PASSPHRASE NEW-KEY-OR-PASSPHRASE [USER]</dd>
    </dl>

    <p>Either the -Ca or the -Cx option must be specified. The OLD-KEY-OR-PASSPHRASE and/or NEW-KEY-OR-PASSPHRASE arguments can
    either be a passphrase or a localized key starting with "0x", e.g. as printed out by the <b>changekey</b> sub-command.</p>

    <p><a name="lbAI" id="lbAI"> </a></p>

    <h2>EXAMPLES</h2>

    <p>Let's assume for our examples that the following VACM and USM configurations lines were in the snmpd.conf file for a
    Net-SNMP agent. These lines set up a default user called "initial" with the authentication passphrase "setup_passphrase" so
    that we can perform the initial setup of an agent:</p>

    <dl compact="compact">
      <dd>
        <pre>
# VACM configuration entries
rwuser initial
# lets add the new user we'll create too:
rwuser wes
# USM configuration entries
createUser initial MD5 setup_passphrase DES
</pre>
      </dd>
    </dl>

    <p>Note: the "initial" user's setup should be removed after creating a real user that you grant administrative privileges to
    (like the user "wes" we'll be creating in this example.</p>

    <p>Note: passphrases must be 8 characters <i>minimum</i> in length. <a name="lbAJ" id="lbAJ"> </a></p>

    <h3>Create a new user</h3>

    <p>snmpusm -v3 -u initial -n "" -l authNoPriv -a MD5 -A setup_passphrase localhost create wes initial</p>

    <dl compact="compact">
      <dd>Creates a new user, here named "wes" using the user "initial" to do it. "wes" is cloned from "initial" in the process,
      so he inherits that user's passphrase ("setup_passphrase").</dd>
    </dl><a name="lbAK" id="lbAK"> </a>

    <h3>Change the user's passphrase</h3>

    <p>snmpusm -v 3 -u wes -n "" -l authNoPriv -a MD5 -A setup_passphrase localhost passwd setup_passphrase new_passphrase</p>

    <dl compact="compact">
      <dd>After creating the user "wes" with the same passphrase as the "initial" user, we need to change his passphrase for him.
      The above command changes it from "setup_passphrase", which was inherited from the initial user, to "new_passphrase".</dd>
    </dl><a name="lbAL" id="lbAL"> </a>

    <h3>Test the new user</h3>

    <p>snmpget -v 3 -u wes -n "" -l authNoPriv -a MD5 -A new_passphrase localhost sysUpTime.0</p>

    <dl compact="compact">
      <dd>If the above commands were successful, this command should have properly performed an authenticated SNMPv3 GET request
      to the agent.</dd>
    </dl>

    <p>Now, go remove the vacm "group" snmpd.conf entry for the "initial" user and you have a valid user 'wes' that you can use
    for future transactions instead of initial.</p>

    <p><a name="lbAM" id="lbAM"> </a></p>

    <h2>WARNING</h2>Manipulating the usmUserTable using this command can <i>only</i> be done using SNMPv3. This command will not
    work with the community-based versions, even if they have write access to the table.

    <p><a name="lbAN" id="lbAN"> </a></p>

    <h2>SEE ALSO</h2><a href="snmpd.conf.html">snmpd.conf</a>(5), <a href="snmp.conf.html">snmp.conf</a>(5), RFC 3414
    <hr />
    <a name="index" id="index"> </a>

    <h2>Index</h2>

    <dl>
      <dt><a href="#lbAB">NAME</a></dt>

      <dt><a href="#lbAC">SYNOPSIS</a></dt>

      <dt><a href="#lbAD">DESCRIPTION</a></dt>

      <dt><a href="#lbAE">OPTIONS</a></dt>

      <dt><a href="#lbAF">CREATING USERS</a></dt>

      <dt><a href="#lbAG">DELETING USERS</a></dt>

      <dt><a href="#lbAH">CHANGING PASS PHRASES</a></dt>

      <dt><a href="#lbAI">EXAMPLES</a></dt>

      <dd>
        <dl>
          <dt><a href="#lbAJ">Create a new user</a></dt>

          <dt><a href="#lbAK">Change the user's passphrase</a></dt>

          <dt><a href="#lbAL">Test the new user</a></dt>
        </dl>
      </dd>

      <dt><a href="#lbAM">WARNING</a></dt>

      <dt><a href="#lbAN">SEE ALSO</a></dt>
    </dl>
    <hr />
    This document was created by <a href="http://localhost/cgi-bin/man/man2html">man2html</a>, using the manual pages.<br />
    Time: 17:34:32 GMT, December 30, 2005
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

