<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <div class="qindex">
    <a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class=
    "qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class=
    "qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class=
    "qindex" href="examples.html">Examples</a>
  </div>

  <div class="nav">
    <a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href=
    "dir_000001.html">net-snmp</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">agent</a>
  </div>

  <h1>snmp_agent.h</h1>

  <div class="fragment">
    <pre class="fragment">
00001 <span class="comment">/* Portions of this file are subject to the following copyright(s).  See</span>
00002 <span class="comment"> * the Net-SNMP's COPYING file for more details and other copyrights</span>
00003 <span class="comment"> * that may apply:</span>
00004 <span class="comment"> */</span>
00005 <span class="comment">/*</span>
00006 <span class="comment"> * Portions of this file are copyrighted by:</span>
00007 <span class="comment"> * Copyright &copy; 2003 Sun Microsystems, Inc. All rights reserved.</span>
00008 <span class="comment"> * Use is subject to license terms specified in the COPYING file</span>
00009 <span class="comment"> * distributed with the Net-SNMP package.</span>
00010 <span class="comment"> */</span>
00011 <span class="comment">/*</span>
00012 <span class="comment"> * @file snmp_agent.h</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * @addtogroup agent</span>
00015 <span class="comment"> * @addtogroup table</span>
00016 <span class="comment"> * External definitions for functions and variables in snmp_agent.c.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * @{</span>
00019 <span class="comment"> */</span>
00020 
00021 <span class="preprocessor">#ifndef SNMP_AGENT_H</span>
00022 <span class="preprocessor">#define SNMP_AGENT_H</span>
00023 
00024 <span class="preprocessor">#ifdef __cplusplus</span>
00025 <span class="keyword">extern</span>          <span class="stringliteral">"C"</span> {
00026 <span class="preprocessor">#endif</span>
00027 
00028 <span class="preprocessor">#include &lt;net-snmp/library/snmp_impl.h&gt;</span>
00029 <span class="preprocessor">#include &lt;net-snmp/library/tools.h&gt;</span>
00030 <span class="preprocessor">#include &lt;net-snmp/library/data_list.h&gt;</span>
00031 
00032 <span class="preprocessor">#define SNMP_MAX_PDU_SIZE 64000 </span><span class=
"comment">/* local constraint on PDU size sent by agent</span>
00033 <span class="comment">                                 * (see also SNMP_MAX_MSG_SIZE in snmp_api.h) */</span>
00034 
00035     <span class="comment">/*</span>
00036 <span class="comment">     * If non-zero, causes the addresses of peers to be logged when receptions</span>
00037 <span class="comment">     * occur.  </span>
00038 <span class="comment">     */</span>
00039 
00040     <span class="keyword">extern</span> <span class="keywordtype">int</span>      log_addresses;
00041 
00042     <span class="comment">/*</span>
00043 <span class="comment">     * How many ticks since we last aged the address cache entries.  </span>
00044 <span class="comment">     */</span>
00045 
00046     <span class="keyword">extern</span> <span class="keywordtype">int</span>      lastAddrAge;
00047 
<a name="l00054" id="l00054"></a><a class="code" href="structnetsnmp__request__info__s.html">00054</a>     <span class=
"keyword">typedef</span> <span class="keyword">struct </span><a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info_s</a> {
<a name="l00058" id="l00058"></a><a class="code" href="structnetsnmp__request__info__s.html#o0">00058</a>         <a class="code"
href="structvariable__list.html">netsnmp_variable_list</a> *requestvb;
00059 
<a name="l00064" id="l00064"></a><a class="code" href="structnetsnmp__request__info__s.html#o1">00064</a>         <a class="code"
href="structnetsnmp__data__list__s.html">netsnmp_data_list</a> *parent_data;
00065 
00066        <span class="comment">/*</span>
00067 <span class="comment">        * pointer to the agent_request_info for this request</span>
00068 <span class="comment">        */</span>
00069        <span class="keyword">struct </span><a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info_s</a> *agent_req_info;
00070 
<a name="l00072" id="l00072"></a><a class="code" href=
"structnetsnmp__request__info__s.html#o3">00072</a>         oid            *range_end;
00073         size_t          range_end_len;
00074 
00075        <span class="comment">/*</span>
00076 <span class="comment">        * flags</span>
00077 <span class="comment">        */</span>
00078         <span class="keywordtype">int</span>             delegated;
00079         <span class="keywordtype">int</span>             processed;
00080         <span class="keywordtype">int</span>             inclusive;
00081 
00082         <span class="keywordtype">int</span>             status;
<a name="l00084" id="l00084"></a><a class="code" href="structnetsnmp__request__info__s.html#o9">00084</a>         <span class=
"keywordtype">int</span>             index;
00085  
<a name="l00087" id="l00087"></a><a class="code" href="structnetsnmp__request__info__s.html#o10">00087</a>         <span class=
"keywordtype">int</span>             repeat;
00088         <span class="keywordtype">int</span>             orig_repeat;
00089         <a class="code" href="structvariable__list.html">netsnmp_variable_list</a> *requestvb_start;
00090 
00091        <span class="comment">/* internal use */</span>
00092         <span class="keyword">struct </span><a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info_s</a> *next;
00093         <span class="keyword">struct </span><a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info_s</a> *prev;
00094         <span class="keyword">struct </span>netsnmp_subtree_s      *subtree;
00095     } <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a>;
00096 
00097     <span class="keyword">typedef</span> <span class="keyword">struct </span>netsnmp_set_info_s {
00098         <span class="keywordtype">int</span>             action;
00099         <span class="keywordtype">void</span>           *stateRef;
00100 
00101         <span class="comment">/*</span>
00102 <span class="comment">         * don't use yet: </span>
00103 <span class="comment">         */</span>
00104         <span class="keywordtype">void</span>          **oldData;
00105         <span class="keywordtype">int</span>             setCleanupFlags;
00106 <span class="preprocessor">#define AUTO_FREE_STATEREF 0x01 </span><span class="comment">/* calls free(stateRef) */</span>
00107 <span class="preprocessor">#define AUTO_FREE_OLDDATA  0x02 </span><span class="comment">/* calls free(*oldData) */</span>
00108 <span class="preprocessor">#define AUTO_UNDO          0x03 </span><span class="comment">/* ... */</span>
00109     } netsnmp_set_info;
00110 
00111     <span class="keyword">typedef</span> <span class="keyword">struct </span>netsnmp_tree_cache_s {
00112         <span class="keyword">struct </span>netsnmp_subtree_s *subtree;
00113         <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests_begin;
00114         <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests_end;
00115     } netsnmp_tree_cache;
00116 
00117 <span class="preprocessor">#define MODE_GET              SNMP_MSG_GET</span>
00118 <span class="preprocessor">#define MODE_GETNEXT          SNMP_MSG_GETNEXT</span>
00119 <span class="preprocessor">#define MODE_GETBULK          SNMP_MSG_GETBULK</span>
00120 <span class="preprocessor">#define MODE_GET_STASH        SNMP_MSG_INTERNAL_GET_STASH</span>
00121 <span class=
"preprocessor">#define MODE_IS_GET(x)        ((x &gt;= 128) &amp;&amp; (x != -1)  &amp;&amp; (x != SNMP_MSG_SET))</span>
00122     <span class=
"comment">/* #define MODE_IS_GET(x)        ((x == SNMP_MSG_GET) || (x == SNMP_MSG_GETNEXT) || (x == SNMP_MSG_GETBULK) || (x == SNMP_MSG_INTERNAL_GET_STASH)) */</span>
00123 
00124 <span class="preprocessor">#define MODE_SET_BEGIN        SNMP_MSG_INTERNAL_SET_BEGIN</span>
00125 <span class="preprocessor">#define MODE_SET_RESERVE1     SNMP_MSG_INTERNAL_SET_RESERVE1</span>
00126 <span class="preprocessor">#define MODE_SET_RESERVE2     SNMP_MSG_INTERNAL_SET_RESERVE2</span>
00127 <span class="preprocessor">#define MODE_SET_ACTION       SNMP_MSG_INTERNAL_SET_ACTION</span>
00128 <span class="preprocessor">#define MODE_SET_COMMIT       SNMP_MSG_INTERNAL_SET_COMMIT</span>
00129 <span class="preprocessor">#define MODE_SET_FREE         SNMP_MSG_INTERNAL_SET_FREE</span>
00130 <span class="preprocessor">#define MODE_SET_UNDO         SNMP_MSG_INTERNAL_SET_UNDO</span>
00131 <span class="preprocessor">#define MODE_IS_SET(x)         ((x &lt; 128) || (x == -1) || (x == SNMP_MSG_SET))</span>
00132     <span class="comment">/* #define MODE_IS_SET(x)         (!MODE_IS_GET(x)) */</span>
00133 
00134 <span class="preprocessor">#define MODE_BSTEP_PRE_REQUEST   SNMP_MSG_INTERNAL_PRE_REQUEST</span>
00135 <span class="preprocessor">#define MODE_BSTEP_POST_REQUEST  SNMP_MSG_INTERNAL_POST_REQUEST</span>
00136 
00137 <span class="preprocessor">#define MODE_BSTEP_OBJECT_LOOKUP       SNMP_MSG_INTERNAL_OBJECT_LOOKUP</span>
00138 <span class="preprocessor">#define MODE_BSTEP_CHECK_VALUE         SNMP_MSG_INTERNAL_CHECK_VALUE</span>
00139 <span class="preprocessor">#define MODE_BSTEP_ROW_CREATE          SNMP_MSG_INTERNAL_ROW_CREATE</span>
00140 <span class="preprocessor">#define MODE_BSTEP_UNDO_SETUP          SNMP_MSG_INTERNAL_UNDO_SETUP</span>
00141 <span class="preprocessor">#define MODE_BSTEP_SET_VALUE           SNMP_MSG_INTERNAL_SET_VALUE</span>
00142 <span class="preprocessor">#define MODE_BSTEP_CHECK_CONSISTENCY   SNMP_MSG_INTERNAL_CHECK_CONSISTENCY</span>
00143 <span class="preprocessor">#define MODE_BSTEP_UNDO_SET            SNMP_MSG_INTERNAL_UNDO_SET</span>
00144 <span class="preprocessor">#define MODE_BSTEP_COMMIT              SNMP_MSG_INTERNAL_COMMIT</span>
00145 <span class="preprocessor">#define MODE_BSTEP_UNDO_COMMIT         SNMP_MSG_INTERNAL_UNDO_COMMIT</span>
00146 <span class="preprocessor">#define MODE_BSTEP_IRREVERSIBLE_COMMIT SNMP_MSG_INTERNAL_IRREVERSIBLE_COMMIT</span>
00147 <span class="preprocessor">#define MODE_BSTEP_UNDO_CLEANUP        SNMP_MSG_INTERNAL_UNDO_CLEANUP</span>
00148 
00149 
<a name="l00158" id="l00158"></a><a class="code" href="structnetsnmp__agent__request__info__s.html">00158</a>     <span class=
"keyword">typedef</span> <span class="keyword">struct </span><a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info_s</a> {
00159         <span class="keywordtype">int</span>             mode;
00161 <span class="comment">/*        netsnmp_pdu    *pdu;    */</span>
<a name="l00162" id="l00162"></a><a class="code" href=
"structnetsnmp__agent__request__info__s.html#o1">00162</a>         <span class=
"keyword">struct </span>netsnmp_agent_session_s *asp;    <span class="comment">/* may not be needed */</span>
00163         <span class="comment">/*</span>
00164 <span class="comment">         * can be used to pass information on a per-pdu basis from a</span>
00165 <span class="comment">         * helper to the later handlers </span>
00166 <span class="comment">         */</span>
00167         <a class="code" href="structnetsnmp__data__list__s.html">netsnmp_data_list</a> *agent_data;
00168     } <a class="code" href="structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a>;
00169 
00170     <span class="keyword">typedef</span> <span class="keyword">struct </span>netsnmp_cachemap_s {
00171         <span class="keywordtype">int</span>             globalid;
00172         <span class="keywordtype">int</span>             cacheid;
00173         <span class="keyword">struct </span>netsnmp_cachemap_s *next;
00174     } netsnmp_cachemap;
00175 
00176     <span class="keyword">typedef</span> <span class="keyword">struct </span>netsnmp_agent_session_s {
00177         <span class="keywordtype">int</span>             mode;
00178         <a class="code" href="structsnmp__session.html">netsnmp_session</a> *session;
00179         <a class="code" href="structsnmp__pdu.html">netsnmp_pdu</a>    *pdu;
00180         <a class="code" href="structsnmp__pdu.html">netsnmp_pdu</a>    *orig_pdu;
00181         <span class="keywordtype">int</span>             rw;
00182         <span class="keywordtype">int</span>             exact;
00183         <span class="keywordtype">int</span>             status;
00184         <span class="keywordtype">int</span>             index;
00185         <span class="keywordtype">int</span>             oldmode;
00186 
00187         <span class="keyword">struct </span>netsnmp_agent_session_s *next;
00188 
00189         <span class="comment">/*</span>
00190 <span class="comment">         * new API pointers </span>
00191 <span class="comment">         */</span>
00192         <a class="code" href="structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo;
00193         <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests;
00194         netsnmp_tree_cache *treecache;
00195         <a class="code" href="structvariable__list.html">netsnmp_variable_list</a> **bulkcache;
00196         <span class="keywordtype">int</span>             treecache_len;  <span class=
"comment">/* length of cache array */</span>
00197         <span class="keywordtype">int</span>             treecache_num;  <span class=
"comment">/* number of current cache entries */</span>
00198         netsnmp_cachemap *cache_store;
00199         <span class="keywordtype">int</span>             vbcount;
00200     } netsnmp_agent_session;
00201 
00202     <span class="comment">/*</span>
00203 <span class="comment">     * Address cache handling functions.  </span>
00204 <span class="comment">     */</span>
00205 
00206     <span class="keywordtype">void</span>            netsnmp_addrcache_initialise(<span class="keywordtype">void</span>);
00207     <span class="keywordtype">void</span>            netsnmp_addrcache_age(<span class="keywordtype">void</span>);
00208 
00209 
00210     <span class="comment">/*</span>
00211 <span class="comment">     * config file parsing routines </span>
00212 <span class="comment">     */</span>
00213     <span class="keywordtype">int</span>             <a class="code" href=
"group__snmp__agent.html#ga52">handle_snmp_packet</a>(<span class="keywordtype">int</span>, <a class="code" href=
"structsnmp__session.html">netsnmp_session</a> *, <span class="keywordtype">int</span>,
00214                                        <a class="code" href="structsnmp__pdu.html">netsnmp_pdu</a> *, <span class=
"keywordtype">void</span> *);
00215     <span class="keywordtype">void</span>            snmp_agent_parse_config(<span class=
"keywordtype">char</span> *, <span class="keywordtype">char</span> *);
00216     netsnmp_agent_session *init_agent_snmp_session(<a class="code" href="structsnmp__session.html">netsnmp_session</a> *,
00217                                                    <a class="code" href="structsnmp__pdu.html">netsnmp_pdu</a> *);
00218     <span class="keywordtype">void</span>            free_agent_snmp_session(netsnmp_agent_session *);
00219     <span class="keywordtype">void</span>           
00220         netsnmp_remove_and_free_agent_snmp_session(netsnmp_agent_session
00221                                                    *asp);
00222 <span class="preprocessor">#ifdef SNMP_NEED_REQUEST_LIST</span>
00223     <span class="keywordtype">void</span>           
00224         netsnmp_free_agent_snmp_session_by_session(<a class="code" href=
"structsnmp__session.html">netsnmp_session</a> * sess,
00225                                                    <span class="keywordtype">void</span> (*free_request)
00226                                                    (netsnmp_request_list
00227                                                     *));
00228 <span class="preprocessor">#endif</span>
00229     <span class="keywordtype">int</span>             getNextSessID(<span class="keywordtype">void</span>);
00230     <span class="keywordtype">void</span>            dump_sess_list(<span class="keywordtype">void</span>);
00231     <span class="keywordtype">int</span>             init_master_agent(<span class="keywordtype">void</span>);
00232     <span class="keywordtype">void</span>            shutdown_master_agent(<span class="keywordtype">void</span>);
00233     <span class="keywordtype">int</span>             <a class="code" href=
"group__snmp__agent.html#ga33">agent_check_and_process</a>(<span class="keywordtype">int</span> block);
00234     <span class="keywordtype">void</span>            netsnmp_check_outstanding_agent_requests(<span class=
"keywordtype">void</span>);
00235 
00236     <span class="keywordtype">int</span>             <a class="code" href=
"group__snmp__agent.html#ga68">netsnmp_request_set_error</a>(<a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *request,
00237                                               <span class="keywordtype">int</span> error_value);
00238     <span class="keywordtype">int</span>             netsnmp_check_requests_error(<a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *reqs);
00239     <span class="keywordtype">int</span>
00240         <a class="code" href="group__snmp__agent.html#ga81">netsnmp_set_all_requests_error</a>(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00241                                        <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests,
00242                                        <span class="keywordtype">int</span> error_value);
00243     <span class="keywordtype">int</span>
00244         <a class="code" href="group__snmp__agent.html#ga69">netsnmp_request_set_error_all</a>(<a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests,
00245                                        <span class="keywordtype">int</span> error_value);
00246     
00248     <span class="keywordtype">int</span>             <a class="code" href=
"group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a>
00249                                               *reqinfo,
00250                                               <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a>
00251                                               *request, <span class="keywordtype">int</span> error_value);
00253     <span class="keywordtype">int</span>             <a class="code" href=
"group__snmp__agent.html#ga80">netsnmp_set_mode_request_error</a>(<span class="keywordtype">int</span> mode,
00254                                                    <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a>
00255                                                    *request,
00256                                                    <span class="keywordtype">int</span> error_value);
00257 
00258     u_long          netsnmp_marker_uptime(marker_t pm);
00259     u_long          netsnmp_timeval_uptime(<span class="keyword">struct</span> timeval *tv);
00260     u_long          netsnmp_get_agent_uptime(<span class="keywordtype">void</span>);
00261     <span class="keywordtype">int</span>             <a class="code" href=
"group__snmp__agent.html#ga64">netsnmp_check_transaction_id</a>(<span class="keywordtype">int</span> transaction_id);
00262     <span class="keywordtype">int</span>             netsnmp_agent_check_packet(<a class="code" href=
"structsnmp__session.html">netsnmp_session</a> *,
00263                                                <span class="keyword">struct</span> netsnmp_transport_s
00264                                                *, <span class="keywordtype">void</span> *, <span class=
"keywordtype">int</span>);
00265     <span class="keywordtype">int</span>             netsnmp_agent_check_parse(<a class="code" href=
"structsnmp__session.html">netsnmp_session</a> *,
00266                                               <a class="code" href="structsnmp__pdu.html">netsnmp_pdu</a> *, <span class=
"keywordtype">int</span>);
00267     <span class="keywordtype">int</span>             netsnmp_allocate_globalcacheid(<span class="keywordtype">void</span>);
00268 
00269     <span class="keywordtype">int</span> netsnmp_remove_delegated_requests_for_session(<a class="code" href=
"structsnmp__session.html">netsnmp_session</a> *sess);
00270 
00271     <span class="comment">/*</span>
00272 <span class="comment">     * Register and de-register agent NSAPs.  </span>
00273 <span class="comment">     */</span>
00274 
00275     <span class="keyword">struct </span>netsnmp_transport_s;
00276 
00277     <span class="keywordtype">int</span>             netsnmp_register_agent_nsap(<span class=
"keyword">struct</span> netsnmp_transport_s
00278                                                 *t);
00279     <span class="keywordtype">void</span>            netsnmp_deregister_agent_nsap(<span class=
"keywordtype">int</span> handle);
00280 
00281     NETSNMP_INLINE <span class="keywordtype">void</span>
00282         netsnmp_agent_add_list_data(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *agent,
00283                                     <a class="code" href="structnetsnmp__data__list__s.html">netsnmp_data_list</a> *node);
00284 
00285     NETSNMP_INLINE <span class="keywordtype">int</span>
00286         netsnmp_agent_remove_list_data(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *ari,
00287                                        <span class="keyword">const</span> <span class="keywordtype">char</span> * name);
00288 
00289     NETSNMP_INLINE <span class="keywordtype">void</span> *
00290             netsnmp_agent_get_list_data(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a>
00291                                         *agent, <span class="keyword">const</span> <span class=
"keywordtype">char</span> *name);
00292 
00293     NETSNMP_INLINE <span class="keywordtype">void</span>
00294             netsnmp_free_agent_data_set(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *agent);
00295 
00296     NETSNMP_INLINE <span class="keywordtype">void</span>
00297            netsnmp_free_agent_data_sets(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *agent);
00298     NETSNMP_INLINE <span class="keywordtype">void</span>    
00299         netsnmp_free_agent_request_info(<a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *ari);
00300 
00301 <span class="preprocessor">#ifdef __cplusplus</span>
00302 }
00303 <span class="preprocessor">#endif</span>
00304 <span class="preprocessor">#endif</span>
00305 
</pre>
  </div>
  <hr size="1" />

  <address style="align: right;">
    <small><!--#include virtual="/sfbutton.html" --><br />
    Generated on Thu Oct 28 21:46:59 2004 for net-snmp by&nbsp; <a href="http://www.doxygen.org/index.html"><img src=
    "doxygen.png" alt="doxygen" align="middle" border="0" /></a> 1.3.9.1</small>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

