<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <!-- Generated by Doxygen 1.3.9.1 -->

  <div class="qindex">
    <a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class=
    "qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class=
    "qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class=
    "qindex" href="examples.html">Examples</a>
  </div>

  <div class="nav">
    <a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href=
    "dir_000001.html">net-snmp</a>&nbsp;/&nbsp;<a class="el" href="dir_000006.html">library</a>
  </div>

  <h1>winservice.h</h1>

  <div class="fragment">
    <pre class="fragment">
00001 <span class="preprocessor">#ifndef WINSERVICE_H</span>
00002 <span class="preprocessor">#define WINSERVICE_H</span>
00003 
00004     <span class="comment">/*</span>
00005 <span class="comment">     * </span>
00006 <span class="comment">     * Windows Service related functions declaration</span>
00007 <span class="comment">     * By Raju Krishanppa(raju_krishnappa@yahoo.com)</span>
00008 <span class="comment">     *</span>
00009 <span class="comment">     */</span>
00010 
00011 <span class="preprocessor">#ifdef __cplusplus</span>
00012 <span class="keyword">extern</span> <span class="stringliteral">"C"</span>
00013 {
00014 
00015 <span class="preprocessor">#endif                          </span><span class="comment">/*  */</span>
00016 
00017   <span class="comment">/*</span>
00018 <span class="comment">   * Define Constants for Register, De-register , Run As service or Console mode</span>
00019 <span class="comment">   */</span>
00020 <span class="preprocessor">#define REGISTER_SERVICE 0</span>
00021 <span class="preprocessor">#define UN_REGISTER_SERVICE 1</span>
00022 <span class="preprocessor">#define RUN_AS_SERVICE 2</span>
00023 <span class="preprocessor">#define RUN_AS_CONSOLE 3</span>
00024 
00025 
00026   <span class="comment">/*</span>
00027 <span class="comment">   * Error levels returned when registering or unregistering the service</span>
00028 <span class="comment">  */</span>
00029 <span class="preprocessor">#define SERVICE_ERROR_NONE 0            </span>
00030 <span class="preprocessor">#define SERVICE_ERROR_SCM_OPEN 1                </span><span class=
"comment">/* Can not open SCM */</span>
00031 <span class="preprocessor">#define SERVICE_ERROR_CREATE_SERVICE 2          </span><span class=
"comment">/* Can not create service */</span>
00032 <span class="preprocessor">#define SERVICE_ERROR_CREATE_REGISTRY_ENTRIES 3 </span><span class=
"comment">/* Can not create registry entries */</span>
00033 <span class="preprocessor">#define SERVICE_ERROR_OPEN_SERVICE 4            </span><span class=
"comment">/* Can not open service (service does not exist) */</span>
00034  
00035   <span class="comment">/*</span>
00036 <span class="comment">   * Define Message catalog ID</span>
00037 <span class="comment">   * MessageId: DISPLAY_MSG</span>
00038 <span class="comment">   * MessageText:  %1.</span>
00039 <span class="comment">   */</span>
00040 <span class="preprocessor">#define DISPLAY_MSG                      0x00000064L</span>
00041 
00042   <span class="comment">/*</span>
00043 <span class="comment">   * Hint Value to SCM to wait before sending successive commands to service</span>
00044 <span class="comment">   */</span>
00045 <span class="preprocessor">#define SCM_WAIT_INTERVAL 7000</span>
00046 
00047   <span class="comment">/*</span>
00048 <span class="comment">   * Define Generic String Size, to hold Error or Information</span>
00049 <span class="comment">   */</span>
00050 <span class="preprocessor">#define MAX_STR_SIZE  1024</span>
00051 
00052   <span class="comment">/*</span>
00053 <span class="comment">   * Delcare Global variables, which are visible to other modules </span>
00054 <span class="comment">   */</span>
00055   <span class="keyword">extern</span> BOOL g_fRunningAsService;
00056 
00057   <span class="comment">/*</span>
00058 <span class="comment">   * Input parameter structure to thread </span>
00059 <span class="comment">   */</span>
00060   <span class="keyword">typedef</span> <span class="keyword">struct </span>_InputParams
00061   {
00062     DWORD Argc;
00063     LPTSTR *Argv;
00064   } InputParams;
00065 
00066   <span class="comment">/*</span>
00067 <span class="comment">   * Define Service Related functions</span>
00068 <span class="comment">   */</span>
00069 
00070   <span class="comment">/*</span>
00071 <span class="comment">   * To register application as windows service with SCM </span>
00072 <span class="comment">   */</span>
00073   <span class="keywordtype">int</span> RegisterService (LPCTSTR lpszServiceName,
00074                         LPCTSTR lpszServiceDisplayName,
00075                         LPCTSTR lpszServiceDescription, InputParams * StartUpArg, <span class=
"keywordtype">int</span> quiet);
00076 
00077   <span class="comment">/*</span>
00078 <span class="comment">   * To unregister service </span>
00079 <span class="comment">   */</span>
00080   <span class="keywordtype">int</span> UnregisterService (LPCSTR lpszServiceName, <span class=
"keywordtype">int</span> quiet);
00081 
00082   <span class="comment">/*</span>
00083 <span class="comment">   * To parse command line for startup option </span>
00084 <span class="comment">   */</span>
00085   INT ParseCmdLineForServiceOption (INT argc, TCHAR * argv[], <span class="keywordtype">int</span> *quiet);
00086 
00087   <span class="comment">/*</span>
00088 <span class="comment">   * To write to windows event log </span>
00089 <span class="comment">   */</span>
00090   VOID WriteToEventLog (WORD wType, LPCTSTR pszFormat, ...);
00091 
00092   <span class="comment">/*</span>
00093 <span class="comment">   * To display generic windows error </span>
00094 <span class="comment">   */</span>
00095   VOID DisplayError (LPCTSTR pszTitle, <span class="keywordtype">int</span> quite);
00096 
00097   <span class="comment">/*</span>
00098 <span class="comment">   * To update windows service status to SCM </span>
00099 <span class="comment">   */</span>
00100   <span class="keyword">static</span> BOOL UpdateServiceStatus (DWORD dwStatus, DWORD dwErrorCode,
00101                                    DWORD dwWaitHint);
00102 
00103   <span class="comment">/*</span>
00104 <span class="comment">   * To Report current service status to SCM </span>
00105 <span class="comment">   */</span>
00106   <span class="keyword">static</span> BOOL ReportCurrentServiceStatus (VOID);
00107 
00108   <span class="comment">/*</span>
00109 <span class="comment">   * Service Main function,  Which will spawn a thread, and calls the</span>
00110 <span class="comment">   * Service run part</span>
00111 <span class="comment">   */</span>
00112   VOID WINAPI ServiceMain (DWORD argc, LPTSTR argv[]);
00113 
00114   <span class="comment">/*</span>
00115 <span class="comment">   * To start Service </span>
00116 <span class="comment">   */</span>
00117 
00118   BOOL RunAsService (INT (*ServiceFunction) (INT, LPTSTR *));
00119 
00120   <span class="comment">/*</span>
00121 <span class="comment">   * Call back function to process SCM Requests </span>
00122 <span class="comment">   */</span>
00123   VOID WINAPI ControlHandler (DWORD dwControl);
00124 
00125   <span class="comment">/*</span>
00126 <span class="comment">   * To Stop the service </span>
00127 <span class="comment">   */</span>
00128   VOID ProcessServiceStop (VOID);
00129 
00130   <span class="comment">/*</span>
00131 <span class="comment">   * To Pause service </span>
00132 <span class="comment">   */</span>
00133   VOID ProcessServicePause (VOID);
00134 
00135   <span class="comment">/*</span>
00136 <span class="comment">   * To Continue paused service </span>
00137 <span class="comment">   */</span>
00138   VOID ProcessServiceContinue (VOID);
00139 
00140   <span class="comment">/*</span>
00141 <span class="comment">   * To send Current Service status to SCM when INTERROGATE command is sent </span>
00142 <span class="comment">   */</span>
00143   VOID ProcessServiceInterrogate (VOID);
00144 
00145   <span class="comment">/*</span>
00146 <span class="comment">   * To allocate and Set security descriptor </span>
00147 <span class="comment">   */</span>
00148   BOOL SetSimpleSecurityAttributes (SECURITY_ATTRIBUTES * pSecurityAttr);
00149 
00150   <span class="comment">/*</span>
00151 <span class="comment">   * To free Security Descriptor </span>
00152 <span class="comment">   */</span>
00153   VOID FreeSecurityAttributes (SECURITY_ATTRIBUTES * pSecurityAttr);
00154 
00155   <span class="comment">/*</span>
00156 <span class="comment">   * TheadFunction - To spawan as thread - Invokes registered service function </span>
00157 <span class="comment">   */</span>
00158   DWORD WINAPI ThreadFunction (LPVOID lpParam);
00159 
00160   <span class="comment">/*</span>
00161 <span class="comment">   * Service STOP function registration with this framewrok</span>
00162 <span class="comment">   * * this function must be invoked before calling RunAsService</span>
00163 <span class="comment">   */</span>
00164   VOID RegisterStopFunction (VOID (*StopFunc) (VOID));
00165 
00166 <span class="preprocessor">#ifdef __cplusplus</span>
00167 }
00168 <span class="preprocessor">#endif                          </span><span class="comment">/*  */</span>
00169 <span class="preprocessor">#endif                          </span><span class="comment">/* WINSERVICE_H */</span>
00170 
</pre>
  </div>
  <hr size="1" />

  <address style="align: right;">
    <small>Generated on Fri Dec 30 13:47:51 2005 for net-snmp by&nbsp; <a href="http://www.doxygen.org/index.html"><img src=
    "doxygen.png" alt="doxygen" align="middle" border="0" /></a> 1.3.9.1</small>
  </address>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

