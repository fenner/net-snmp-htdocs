<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <!-- Generated by Doxygen 1.3.9.1 -->

  <div class="qindex">
    <a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class=
    "qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class=
    "qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class=
    "qindex" href="examples.html">Examples</a>
  </div>

  <div class="nav">
    <a class="el" href="dir_000005.html">snmplib</a>
  </div>

  <h1>snmp-tc.c</h1>

  <div class="fragment">
    <pre class="fragment">
00001 <span class="comment">/*</span>
00002 <span class="comment"> *  Host Resources MIB - utility functions - hr_utils.c</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> */</span>
00005 
00006 
00007 <span class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
00008 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00009 <span class="preprocessor">#if HAVE_NETINET_IN_H</span>
00010 <span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
00011 <span class="preprocessor">#endif</span>
00012 <span class="preprocessor">#if HAVE_STDLIB_H</span>
00013 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00014 <span class="preprocessor">#endif</span>
00015 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
00016 <span class="preprocessor">#if HAVE_STRING_H</span>
00017 <span class="preprocessor">#include &lt;string.h&gt;</span>
00018 <span class="preprocessor">#endif</span>
00019 <span class="preprocessor">#if HAVE_STDLIB_H</span>
00020 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00021 <span class="preprocessor">#endif</span>
00022 
00023 <span class="preprocessor">#if TIME_WITH_SYS_TIME</span>
00024 <span class="preprocessor">#ifdef WIN32</span>
00025 <span class="preprocessor"># include &lt;sys/timeb.h&gt;</span>
00026 <span class="preprocessor">#else</span>
00027 <span class="preprocessor"># include &lt;sys/time.h&gt;</span>
00028 <span class="preprocessor">#endif</span>
00029 <span class="preprocessor"># include &lt;time.h&gt;</span>
00030 <span class="preprocessor">#else</span>
00031 <span class="preprocessor"># if HAVE_SYS_TIME_H</span>
00032 <span class="preprocessor">#  include &lt;sys/time.h&gt;</span>
00033 <span class="preprocessor"># else</span>
00034 <span class="preprocessor">#  include &lt;time.h&gt;</span>
00035 <span class="preprocessor"># endif</span>
00036 <span class="preprocessor">#endif</span>
00037 
00038 <span class="preprocessor">#include &lt;net-snmp/types.h&gt;</span>
00039 <span class="preprocessor">#include &lt;net-snmp/library/snmp-tc.h&gt;</span>   <span class=
"comment">/* for "internal" definitions */</span>
00040 <span class="preprocessor">#include &lt;net-snmp/library/snmp_api.h&gt;</span>
00041 
00042 <span class="comment">/*</span>
00043 <span class="comment">  DateAndTime ::= TEXTUAL-CONVENTION</span>
00044 <span class="comment">    DISPLAY-HINT "2d-1d-1d,1d:1d:1d.1d,1a1d:1d"</span>
00045 <span class="comment">    STATUS       current</span>
00046 <span class="comment">    DESCRIPTION</span>
00047 <span class="comment">            "A date-time specification.</span>
00048 
00049 <span class="comment">            field  octets  contents                  range</span>
00050 <span class="comment">            -----  ------  --------                  -----</span>
00051 <span class="comment">              1      1-2   year*                     0..65536</span>
00052 <span class="comment">              2       3    month                     1..12</span>
00053 <span class="comment">              3       4    day                       1..31</span>
00054 <span class="comment">              4       5    hour                      0..23</span>
00055 <span class="comment">              5       6    minutes                   0..59</span>
00056 <span class="comment">              6       7    seconds                   0..60</span>
00057 <span class="comment">                           (use 60 for leap-second)</span>
00058 <span class="comment">              7       8    deci-seconds              0..9</span>
00059 <span class="comment">              8       9    direction from UTC        '+' / '-'</span>
00060 <span class="comment">              9      10    hours from UTC*           0..13</span>
00061 <span class="comment">             10      11    minutes from UTC          0..59</span>
00062 
00063 <span class="comment">            * Notes:</span>
00064 <span class="comment">            - the value of year is in network-byte order</span>
00065 <span class="comment">            - daylight saving time in New Zealand is +13</span>
00066 
00067 <span class="comment">            For example, Tuesday May 26, 1992 at 1:30:15 PM EDT would be</span>
00068 <span class="comment">            displayed as:</span>
00069 
00070 <span class="comment">                             1992-5-26,13:30:15.0,-4:0</span>
00071 
00072 <span class="comment">            Note that if only local time is known, then timezone</span>
00073 <span class="comment">            information (fields 8-10) is not present."</span>
00074 <span class="comment">    SYNTAX       OCTET STRING (SIZE (8 | 11))</span>
00075 <span class="comment">*/</span>
00076 
00077 <span class="keywordtype">int</span>
00078 netsnmp_dateandtime_set_buf_from_vars(u_char *buf, size_t *bufsize,
00079                                       u_short year, u_char month, u_char day,
00080                                       u_char hour, u_char minutes,
00081                                       u_char seconds, u_char deci_seconds,
00082                                       <span class="keywordtype">int</span> utc_offset_direction,
00083                                       u_char utc_offset_hours,
00084                                       u_char utc_offset_minutes)
00085 {
00086     u_short tmp_year = htons(year);
00087 
00088     <span class="comment">/*</span>
00089 <span class="comment">     * if we have a utc offset, need 11 bytes. Otherwise we</span>
00090 <span class="comment">     * just need 8 bytes.</span>
00091 <span class="comment">     */</span>
00092     <span class="keywordflow">if</span>(utc_offset_direction) {
00093         <span class="keywordflow">if</span>(*bufsize &lt; 11)
00094             <span class="keywordflow">return</span> SNMPERR_RANGE;
00095 
00096         <span class="comment">/*</span>
00097 <span class="comment">         * set utc offset data</span>
00098 <span class="comment">         */</span>
00099         buf[8] = (utc_offset_direction &lt; 0) ? <span class="charliteral">'-'</span> : <span class=
"charliteral">'+'</span>;
00100         buf[9] = utc_offset_hours;
00101         buf[10] = utc_offset_minutes;
00102         *bufsize = 11;
00103     }
00104     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(*bufsize &lt; 8)
00105         <span class="keywordflow">return</span> SNMPERR_RANGE;
00106     <span class="keywordflow">else</span>
00107         *bufsize = 8;
00108 
00109     <span class="comment">/*</span>
00110 <span class="comment">     * set basic date/time data</span>
00111 <span class="comment">     */</span>
00112     memcpy(buf, &amp;tmp_year, <span class="keyword">sizeof</span>(tmp_year));
00113     buf[2] = month;
00114     buf[3] = day;
00115     buf[4] = hour;
00116     buf[5] = minutes;
00117     buf[6] = seconds;
00118     buf[7] = deci_seconds;
00119 
00120     <span class="keywordflow">return</span> SNMPERR_SUCCESS;
00121 }
00122 
00123 u_char         *
00124 date_n_time(time_t * when, size_t * length)
00125 {
00126     <span class="keyword">struct </span>tm      *tm_p;
00127     <span class="keyword">static</span> u_char   string[11];
00128     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> yauron;
00129 
00130     <span class="comment">/*</span>
00131 <span class="comment">     * Null time</span>
00132 <span class="comment">     */</span>
00133     <span class="keywordflow">if</span> (when == NULL || *when == 0 || *when == (time_t) - 1) {
00134         string[0] = 0;
00135         string[1] = 0;
00136         string[2] = 1;
00137         string[3] = 1;
00138         string[4] = 0;
00139         string[5] = 0;
00140         string[6] = 0;
00141         string[7] = 0;
00142         *length = 8;
00143         <span class="keywordflow">return</span> string;
00144     }
00145 
00146 
00147     <span class="comment">/*</span>
00148 <span class="comment">     * Basic 'local' time handling</span>
00149 <span class="comment">     */</span>
00150     tm_p = localtime(when);
00151     yauron = tm_p-&gt;tm_year + 1900;
00152     string[0] = (u_char)(yauron &gt;&gt; 8);
00153     string[1] = (u_char)yauron;
00154     string[2] = tm_p-&gt;tm_mon + 1;
00155     string[3] = tm_p-&gt;tm_mday;
00156     string[4] = tm_p-&gt;tm_hour;
00157     string[5] = tm_p-&gt;tm_min;
00158     string[6] = tm_p-&gt;tm_sec;
00159     string[7] = 0;
00160     *length = 8;
00161 
00162 <span class="preprocessor">#ifndef cygwin</span>
00163     <span class="comment">/*</span>
00164 <span class="comment">     * Timezone offset</span>
00165 <span class="comment">     */</span>
00166     {
00167 <span class="preprocessor">#ifdef STRUCT_TM_HAS_TM_GMTOFF</span>
00168     <span class="keyword">const</span> <span class="keywordtype">int</span> tzoffset = tm_p-&gt;tm_gmtoff;
00169 <span class="preprocessor">#else</span>
00170     <span class="keyword">const</span> <span class="keywordtype">int</span> tzoffset = timezone;
00171 <span class="preprocessor">#endif</span>
00172     <span class="keywordflow">if</span> (tzoffset &gt; 0)
00173         string[8] = <span class="charliteral">'-'</span>;
00174     <span class="keywordflow">else</span>
00175         string[8] = <span class="charliteral">'+'</span>;
00176     string[9] = abs(tzoffset) / 3600;
00177     string[10] = (abs(tzoffset) - string[9] * 3600) / 60;
00178     *length = 11;
00179     }
00180 <span class="preprocessor">#endif</span>
00181 
00182 <span class="preprocessor">#ifdef SYSV</span>
00183     <span class="comment">/*</span>
00184 <span class="comment">     * Daylight saving time</span>
00185 <span class="comment">     */</span>
00186     <span class="keywordflow">if</span> (tm_p-&gt;tm_isdst &gt; 0) {
00187         <span class="comment">/*</span>
00188 <span class="comment">         * Assume add one hour </span>
00189 <span class="comment">         */</span>
00190         <span class="keywordflow">if</span> (string[8] == <span class="charliteral">'-'</span>)
00191             --string[9];
00192         <span class="keywordflow">else</span>
00193             ++string[9];
00194 
00195         <span class="keywordflow">if</span> (string[9] == 0)
00196             string[8] = <span class="charliteral">'+'</span>;
00197     }
00198 <span class="preprocessor">#endif</span>
00199 
00200     <span class="keywordflow">return</span> string;
00201 }
00202 
00203 
00204 time_t
00205 ctime_to_timet(<span class="keywordtype">char</span> *str)
00206 {
00207     <span class="keyword">struct </span>tm       tm;
00208 
00209     <span class="keywordflow">if</span> (strlen(str) &lt; 24)
00210         <span class="keywordflow">return</span> 0;
00211 
00212     <span class="comment">/*</span>
00213 <span class="comment">     * Month </span>
00214 <span class="comment">     */</span>
00215     <span class="keywordflow">if</span> (!strncmp(str + 4, <span class="stringliteral">"Jan"</span>, 3))
00216         tm.tm_mon = 0;
00217     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Feb"</span>, 3))
00218         tm.tm_mon = 1;
00219     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Mar"</span>, 3))
00220         tm.tm_mon = 2;
00221     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Apr"</span>, 3))
00222         tm.tm_mon = 3;
00223     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"May"</span>, 3))
00224         tm.tm_mon = 4;
00225     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Jun"</span>, 3))
00226         tm.tm_mon = 5;
00227     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Jul"</span>, 3))
00228         tm.tm_mon = 6;
00229     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Aug"</span>, 3))
00230         tm.tm_mon = 7;
00231     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Sep"</span>, 3))
00232         tm.tm_mon = 8;
00233     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Oct"</span>, 3))
00234         tm.tm_mon = 9;
00235     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Nov"</span>, 3))
00236         tm.tm_mon = 10;
00237     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(str + 4, <span class=
"stringliteral">"Dec"</span>, 3))
00238         tm.tm_mon = 11;
00239     <span class="keywordflow">else</span>
00240         <span class="keywordflow">return</span> 0;
00241 
00242     tm.tm_mday = atoi(str + 8);
00243     tm.tm_hour = atoi(str + 11);
00244     tm.tm_min = atoi(str + 14);
00245     tm.tm_sec = atoi(str + 17);
00246     tm.tm_year = atoi(str + 20) - 1900;
00247 
00248     <span class="comment">/*</span>
00249 <span class="comment">     *  Cope with timezone and DST</span>
00250 <span class="comment">     */</span>
00251 
00252 <span class="preprocessor">#ifdef SYSV</span>
00253     <span class="keywordflow">if</span> (daylight)
00254         tm.tm_isdst = 1;
00255 
00256     tm.tm_sec -= timezone;
00257 <span class="preprocessor">#endif</span>
00258 
00259     <span class="keywordflow">return</span> (mktime(&amp;tm));
00260 }
00261 
00262 <span class="comment">/*</span>
00263 <span class="comment"> * blatantly lifted from opensmp </span>
00264 <span class="comment"> */</span>
00265 <span class="keywordtype">char</span>
00266 check_rowstatus_transition(<span class="keywordtype">int</span> oldValue, <span class="keywordtype">int</span> newValue)
00267 {
00268     <span class="comment">/*</span>
00269 <span class="comment">     * From the SNMPv2-TC MIB:</span>
00270 <span class="comment">     *                                          STATE</span>
00271 <span class="comment">     *               +--------------+-----------+-------------+-------------</span>
00272 <span class="comment">     *               |      A       |     B     |      C      |      D</span>
00273 <span class="comment">     *               |              |status col.|status column|</span>
00274 <span class="comment">     *               |status column |    is     |      is     |status column</span>
00275 <span class="comment">     *     ACTION    |does not exist|  notReady | notInService|  is active</span>
00276 <span class="comment">     * --------------+--------------+-----------+-------------+-------------</span>
00277 <span class="comment">     * set status    |noError    -&gt;D|inconsist- |inconsistent-|inconsistent-</span>
00278 <span class="comment">     * column to     |       or     |   entValue|        Value|        Value</span>
00279 <span class="comment">     * createAndGo   |inconsistent- |           |             |</span>
00280 <span class="comment">     *               |         Value|           |             |</span>
00281 <span class="comment">     * --------------+--------------+-----------+-------------+-------------</span>
00282 <span class="comment">     * set status    |noError  see 1|inconsist- |inconsistent-|inconsistent-</span>
00283 <span class="comment">     * column to     |       or     |   entValue|        Value|        Value</span>
00284 <span class="comment">     * createAndWait |wrongValue    |           |             |</span>
00285 <span class="comment">     * --------------+--------------+-----------+-------------+-------------</span>
00286 <span class="comment">     * set status    |inconsistent- |inconsist- |noError      |noError</span>
00287 <span class="comment">     * column to     |         Value|   entValue|             |</span>
00288 <span class="comment">     * active        |              |           |             |</span>
00289 <span class="comment">     *               |              |     or    |             |</span>
00290 <span class="comment">     *               |              |           |             |</span>
00291 <span class="comment">     *               |              |see 2   -&gt;D|see 8     -&gt;D|          -&gt;D</span>
00292 <span class="comment">     * --------------+--------------+-----------+-------------+-------------</span>
00293 <span class="comment">     * set status    |inconsistent- |inconsist- |noError      |noError   -&gt;C</span>
00294 <span class="comment">     * column to     |         Value|   entValue|             |</span>
00295 <span class="comment">     * notInService  |              |           |             |</span>
00296 <span class="comment">     *               |              |     or    |             |      or</span>
00297 <span class="comment">     *               |              |           |             |</span>
00298 <span class="comment">     *               |              |see 3   -&gt;C|          -&gt;C|see 6</span>
00299 <span class="comment">     * --------------+--------------+-----------+-------------+-------------</span>
00300 <span class="comment">     * set status    |noError       |noError    |noError      |noError   -&gt;A</span>
00301 <span class="comment">     * column to     |              |           |             |      or</span>
00302 <span class="comment">     * destroy       |           -&gt;A|        -&gt;A|          -&gt;A|see 7</span>
00303 <span class="comment">     * --------------+--------------+-----------+-------------+-------------</span>
00304 <span class="comment">     * set any other |see 4         |noError    |noError      |see 5</span>
00305 <span class="comment">     * column to some|              |           |             |</span>
00306 <span class="comment">     * value         |              |      see 1|          -&gt;C|          -&gt;D</span>
00307 <span class="comment">     * --------------+--------------+-----------+-------------+-------------</span>
00308 <span class="comment">     </span>
00309 <span class="comment">     *             (1) goto B or C, depending on information available to the</span>
00310 <span class="comment">     *             agent.</span>
00311 <span class="comment">     </span>
00312 <span class="comment">     *             (2) if other variable bindings included in the same PDU,</span>
00313 <span class="comment">     *             provide values for all columns which are missing but</span>
00314 <span class="comment">     *             required, and all columns have acceptable values, then</span>
00315 <span class="comment">     *             return noError and goto D.</span>
00316 <span class="comment">     </span>
00317 <span class="comment">     *             (3) if other variable bindings included in the same PDU,</span>
00318 <span class="comment">     *             provide legal values for all columns which are missing but</span>
00319 <span class="comment">     *             required, then return noError and goto C.</span>
00320 <span class="comment">     </span>
00321 <span class="comment">     *             (4) at the discretion of the agent, the return value may be</span>
00322 <span class="comment">     *             either:</span>
00323 <span class="comment">     </span>
00324 <span class="comment">     *                  inconsistentName:  because the agent does not choose to</span>
00325 <span class="comment">     *                  create such an instance when the corresponding</span>
00326 <span class="comment">     *                  RowStatus instance does not exist, or</span>
00327 <span class="comment">     </span>
00328 <span class="comment">     *                  inconsistentValue:  if the supplied value is</span>
00329 <span class="comment">     *                  inconsistent with the state of some other MIB object's</span>
00330 <span class="comment">     *                  value, or</span>
00331 <span class="comment">     </span>
00332 <span class="comment">     *                  noError: because the agent chooses to create the</span>
00333 <span class="comment">     *                  instance.</span>
00334 <span class="comment">     </span>
00335 <span class="comment">     *             If noError is returned, then the instance of the status</span>
00336 <span class="comment">     *             column must also be created, and the new state is B or C,</span>
00337 <span class="comment">     *             depending on the information available to the agent.  If</span>
00338 <span class="comment">     *             inconsistentName or inconsistentValue is returned, the row</span>
00339 <span class="comment">     *             remains in state A.</span>
00340 <span class="comment">     </span>
00341 <span class="comment">     *             (5) depending on the MIB definition for the column/table,</span>
00342 <span class="comment">     *             either noError or inconsistentValue may be returned.</span>
00343 <span class="comment">     </span>
00344 <span class="comment">     *             (6) the return value can indicate one of the following</span>
00345 <span class="comment">     *             errors:</span>
00346 <span class="comment">     </span>
00347 <span class="comment">     *                  wrongValue: because the agent does not support</span>
00348 <span class="comment">     *                  notInService (e.g., an agent which does not support</span>
00349 <span class="comment">     *                  createAndWait), or</span>
00350 <span class="comment">     </span>
00351 <span class="comment">     *                  inconsistentValue: because the agent is unable to take</span>
00352 <span class="comment">     *                  the row out of service at this time, perhaps because it</span>
00353 <span class="comment">     *                  is in use and cannot be de-activated.</span>
00354 <span class="comment">     </span>
00355 <span class="comment">     *             (7) the return value can indicate the following error:</span>
00356 <span class="comment">     </span>
00357 <span class="comment">     *                  inconsistentValue: because the agent is unable to</span>
00358 <span class="comment">     *                  remove the row at this time, perhaps because it is in</span>
00359 <span class="comment">     *                  use and cannot be de-activated.</span>
00360 <span class="comment">     </span>
00361 <span class="comment">     *             (8) the transition to D can fail, e.g., if the values of the</span>
00362 <span class="comment">     *             conceptual row are inconsistent, then the error code would</span>
00363 <span class="comment">     *             be inconsistentValue.</span>
00364 <span class="comment">     </span>
00365 <span class="comment">     *             NOTE: Other processing of (this and other varbinds of) the</span>
00366 <span class="comment">     *             set request may result in a response other than noError</span>
00367 <span class="comment">     *             being returned, e.g., wrongValue, noCreation, etc.</span>
00368 <span class="comment">     */</span>
00369 
00370     <span class="keywordflow">switch</span> (newValue) {
00371         <span class="comment">/*</span>
00372 <span class="comment">         * these two end up being equivelent as far as checking the </span>
00373 <span class="comment">         */</span>
00374         <span class="comment">/*</span>
00375 <span class="comment">         * status goes, although the final states are based on the </span>
00376 <span class="comment">         */</span>
00377         <span class="comment">/*</span>
00378 <span class="comment">         * newValue. </span>
00379 <span class="comment">         */</span>
00380     <span class="keywordflow">case</span> RS_ACTIVE:
00381     <span class="keywordflow">case</span> RS_NOTINSERVICE:
00382         <span class="keywordflow">if</span> (oldValue == RS_NOTINSERVICE || oldValue == RS_ACTIVE);
00383         <span class="keywordflow">else</span>
00384             <span class="keywordflow">return</span> SNMP_ERR_INCONSISTENTVALUE;
00385         <span class="keywordflow">break</span>;
00386 
00387     <span class="keywordflow">case</span> RS_NOTREADY:
00388         <span class="comment">/*</span>
00389 <span class="comment">         * Illegal set value. </span>
00390 <span class="comment">         */</span>
00391         <span class="keywordflow">return</span> SNMP_ERR_WRONGVALUE;
00392         <span class="keywordflow">break</span>;
00393 
00394     <span class="keywordflow">case</span> RS_CREATEANDGO:
00395         <span class="keywordflow">if</span> (oldValue != RS_NONEXISTENT)
00396             <span class="comment">/*</span>
00397 <span class="comment">             * impossible, we already exist. </span>
00398 <span class="comment">             */</span>
00399             <span class="keywordflow">return</span> SNMP_ERR_INCONSISTENTVALUE;
00400         <span class="keywordflow">break</span>;
00401 
00402     <span class="keywordflow">case</span> RS_CREATEANDWAIT:
00403         <span class="keywordflow">if</span> (oldValue != RS_NONEXISTENT)
00404             <span class="comment">/*</span>
00405 <span class="comment">             * impossible, we already exist. </span>
00406 <span class="comment">             */</span>
00407             <span class="keywordflow">return</span> SNMP_ERR_INCONSISTENTVALUE;
00408         <span class="keywordflow">break</span>;
00409 
00410     <span class="keywordflow">case</span> RS_DESTROY:
00411         <span class="keywordflow">break</span>;
00412 
00413     <span class="keywordflow">default</span>:
00414         <span class="keywordflow">return</span> SNMP_ERR_WRONGVALUE;
00415         <span class="keywordflow">break</span>;
00416     }
00417 
00418     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00419 }
00420 
00421 <span class="keywordtype">char</span>
00422 check_storage_transition(<span class="keywordtype">int</span> oldValue, <span class="keywordtype">int</span> newValue)
00423 {
00424     <span class="comment">/*</span>
00425 <span class="comment">     * From the SNMPv2-TC MIB:</span>
00426 <span class="comment">     </span>
00427 <span class="comment">     *             "Describes the memory realization of a conceptual row.  A</span>
00428 <span class="comment">     *             row which is volatile(2) is lost upon reboot.  A row which</span>
00429 <span class="comment">     *             is either nonVolatile(3), permanent(4) or readOnly(5), is</span>
00430 <span class="comment">     *             backed up by stable storage.  A row which is permanent(4)</span>
00431 <span class="comment">     *             can be changed but not deleted.  A row which is readOnly(5)</span>
00432 <span class="comment">     *             cannot be changed nor deleted.</span>
00433 <span class="comment">     </span>
00434 <span class="comment">     *             If the value of an object with this syntax is either</span>
00435 <span class="comment">     *             permanent(4) or readOnly(5), it cannot be written.</span>
00436 <span class="comment">     *             Conversely, if the value is either other(1), volatile(2) or</span>
00437 <span class="comment">     *             nonVolatile(3), it cannot be modified to be permanent(4) or</span>
00438 <span class="comment">     *             readOnly(5).  (All illegal modifications result in a</span>
00439 <span class="comment">     *             'wrongValue' error.)</span>
00440 <span class="comment">     </span>
00441 <span class="comment">     *             Every usage of this textual convention is required to</span>
00442 <span class="comment">     *             specify the columnar objects which a permanent(4) row must</span>
00443 <span class="comment">     *             at a minimum allow to be writable."</span>
00444 <span class="comment">     */</span>
00445     <span class="keywordflow">switch</span> (oldValue) {
00446     <span class="keywordflow">case</span> SNMP_STORAGE_PERMANENT:
00447     <span class="keywordflow">case</span> SNMP_STORAGE_READONLY:
00448         <span class="keywordflow">return</span> SNMP_ERR_INCONSISTENTVALUE;
00449 
00450     <span class="keywordflow">case</span> SNMP_STORAGE_NONE:
00451     <span class="keywordflow">case</span> SNMP_STORAGE_OTHER:
00452     <span class="keywordflow">case</span> SNMP_STORAGE_VOLATILE:
00453     <span class="keywordflow">case</span> SNMP_STORAGE_NONVOLATILE:
00454         <span class="keywordflow">if</span> (newValue == SNMP_STORAGE_PERMANENT ||
00455             newValue == SNMP_STORAGE_READONLY)
00456             <span class="keywordflow">return</span> SNMP_ERR_INCONSISTENTVALUE;
00457     }
00458 
00459     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00460 }
</pre>
  </div>
  <hr size="1" />

  <address style="align: right;">
    <small>Generated on Fri Dec 30 13:47:47 2005 for net-snmp by&nbsp; <a href="http://www.doxygen.org/index.html"><img src=
    "doxygen.png" alt="doxygen" align="middle" border="0" /></a> 1.3.9.1</small>
  </address>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

