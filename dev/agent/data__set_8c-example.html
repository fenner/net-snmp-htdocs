<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <div class="qindex">
    <a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class=
    "qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class=
    "qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class=
    "qindex" href="examples.html">Examples</a>
  </div>

  <h1>data_set.c</h1>This example creates a table full of information and stores all that information within the agent's memory.
  The "table_dataset" helper routines take care of handling all aspects of SNMP requests as they come in (yay!).

  <p>The exmaple we are instrumenting is an otherwise-useless table containing the names of IETF working group chairs. Obviously,
  this data isn't all that useful from a network management point of view but this example only demonstrates how to use and store
  data. For more useful examples (but more complex), check out the apps/notification_log.c file which implements parts of the
  NOTIFICATION-LOG-MIB for logging incoming SNMP notifications.</p>

  <p>Much of this code could be automatically generated by running mib2c as follows:</p>

  <ul>
    <li>mib2c -c mib2c.create-dataset.conf netSnmpIETFWGTable</li>
  </ul>

  <p>The table is defined roughly as follows:</p>
  <pre>
     snmptranslate -m NET-SNMP-EXAMPLES-MIB -Tp -IR netSnmpIETFWGTable
    |+--netSnmpIETFWGTable(1)
    |   |
    |   +--netSnmpIETFWGEntry(1)
    |      |  Index: nsIETFWGName
    |      |
    |      +-- ---- String    nsIETFWGName(1)
    |      |        Size: 1..32
    |      +-- CR-- String    nsIETFWGChair1(2)
    |      +-- CR-- String    nsIETFWGChair2(3)
  
</pre>

  <p>If this module is compiled into an agent, you should be able to issue snmp commands that look something like (valid
  authentication information not shown in these commands):</p>
  <pre>
       snmpwalk localhost netSnmpIETFWGTable
      nsIETFWGChair1."snmpv3" = "Russ Mundy"
      nsIETFWGChair2."snmpv3" = "David Harrington"
</pre>
  <pre>
       snmpset localhost nsIETFWGChair1.\"sming\" = "David Durham"
      nsIETFWGChair1."sming" = "David Durham"
</pre>
  <pre>
       snmpwalk localhost netSnmpIETFWGTable
      nsIETFWGChair1."sming" = "David Durham"
      nsIETFWGChair1."snmpv3" = "Russ Mundy"
      nsIETFWGChair2."snmpv3" = "David Harrington"
</pre>
  <pre>
      In your snmpd.conf file, put the following line:
      add_row netSnmpIETFWGTable eos "Glenn Waters" "Dale Francisco"
</pre>
  <pre>
       snmpwalk localhost netSnmpIETFWGTable
      nsIETFWGChair1.\"eos\" = "Glenn Waters"
      nsIETFWGChair1.\"snmpv3\" = "Russ Mundy"
      nsIETFWGChair2.\"eos\" = "Dale Francisco"
      nsIETFWGChair2.\"snmpv3\" = "David Harrington"
  
</pre>

  <div class="fragment">
    <pre class="fragment">
<span class="comment">/*</span>
<span class="comment"> * start be including the appropriate header files </span>
<span class="comment"> */</span>
<span class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
<span class="preprocessor">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
<span class="preprocessor">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</span>

<span class="comment">/*</span>
<span class="comment"> * our initialization routine, automatically called by the agent </span>
<span class="comment"> */</span>
<span class="comment">/*</span>
<span class="comment"> * (to get called, the function name must match init_FILENAME() </span>
<span class="comment"> */</span>
<span class="keywordtype">void</span>
init_data_set(<span class="keywordtype">void</span>)
{
    netsnmp_table_data_set *table_set;
    netsnmp_table_row *row;

    <span class="comment">/*</span>
<span class="comment">     * the OID we want to register our integer at.  This should be the</span>
<span class="comment">     * * OID node for the entire table.  In our case this is the</span>
<span class="comment">     * * netSnmpIETFWGTable oid definition </span>
<span class="comment">     */</span>
    oid             my_registration_oid[] =
        { 1, 3, 6, 1, 4, 1, 8072, 2, 2, 1 };

    <span class="comment">/*</span>
<span class="comment">     * a debugging statement.  Run the agent with -Dexample_data_set to see</span>
<span class="comment">     * * the output of this debugging statement. </span>
<span class="comment">     */</span>
    DEBUGMSGTL((<span class="stringliteral">"example_data_set"</span>,
                <span class="stringliteral">"Initalizing example dataset table\n"</span>));

    <span class="comment">/*</span>
<span class="comment">     * It's going to be the "working group chairs" table, since I'm</span>
<span class="comment">     * * sitting at an IETF convention while I'm writing this.</span>
<span class="comment">     * *</span>
<span class="comment">     * *  column 1 = index = string = WG name</span>
<span class="comment">     * *  column 2 = string = chair #1</span>
<span class="comment">     * *  column 3 = string = chair #2  (most WGs have 2 chairs now)</span>
<span class="comment">     */</span>

    table_set = <a name="a0" id="a0"></a><a class="code" href=
"group__table__dataset.html#ga1">netsnmp_create_table_data_set</a>(<span class="stringliteral">"netSnmpIETFWGTable"</span>);

    <span class="comment">/*</span>
<span class="comment">     * allow the creation of new rows via SNMP SETs </span>
<span class="comment">     */</span>
    table_set-&gt;allow_creation = 1;

    <span class="comment">/*</span>
<span class="comment">     * set up what a row "should" look like, starting with the index </span>
<span class="comment">     */</span>
    <a name="a1" id="a1"></a><a class="code" href=
"group__table__dataset.html#ga17">netsnmp_table_dataset_add_index</a>(table_set, ASN_OCTET_STR);

    <span class="comment">/*</span>
<span class="comment">     * define what the columns should look like.  both are octet strings here </span>
<span class="comment">     */</span>
    <a class="code" href="group__table__dataset.html#ga25">netsnmp_table_set_multi_add_default_row</a>(table_set,
                                            <span class="comment">/*</span>
<span class="comment">                                             * column 2 = OCTET STRING,</span>
<span class="comment">                                             * writable = 1,</span>
<span class="comment">                                             * default value = NULL,</span>
<span class="comment">                                             * default value len = 0 </span>
<span class="comment">                                             */</span>
                                            2, ASN_OCTET_STR, 1, NULL, 0,
                                            <span class="comment">/*</span>
<span class="comment">                                             * similar </span>
<span class="comment">                                             */</span>
                                            3, ASN_OCTET_STR, 1, NULL, 0,
                                            0 <span class="comment">/* done */</span> );

    <span class="comment">/*</span>
<span class="comment">     * register the table </span>
<span class="comment">     */</span>
    <span class="comment">/*</span>
<span class="comment">     * if we wanted to handle specific data in a specific way, or note</span>
<span class="comment">     * * when requests came in we could change the NULL below to a valid</span>
<span class="comment">     * * handler method in which we could over ride the default</span>
<span class="comment">     * * behaviour of the table_dataset helper </span>
<span class="comment">     */</span>
    <a name="a2" id="a2"></a><a class="code" href=
"group__table__dataset.html#ga3">netsnmp_register_table_data_set</a>(netsnmp_create_handler_registration
                                    (<span class="stringliteral">"netSnmpIETFWGTable"</span>, NULL,
                                     my_registration_oid,
                                     OID_LENGTH(my_registration_oid),
                                     HANDLER_CAN_RWRITE), table_set, NULL);


    <span class="comment">/*</span>
<span class="comment">     * create the a row for the table, and add the data </span>
<span class="comment">     */</span>
    row = <a name="a3" id="a3"></a><a class="code" href="group__table__data.html#ga13">netsnmp_create_table_data_row</a>();
    <span class="comment">/*</span>
<span class="comment">     * set the index to the IETF WG name "snmpv3" </span>
<span class="comment">     */</span>
    netsnmp_table_row_add_index(row, ASN_OCTET_STR, <span class="stringliteral">"snmpv3"</span>,
                                strlen(<span class="stringliteral">"snmpv3"</span>));


    <span class="comment">/*</span>
<span class="comment">     * set column 2 to be the WG chair name "Russ Mundy" </span>
<span class="comment">     */</span>
    <a name="a4" id="a4"></a><a class="code" href=
"group__table__dataset.html#ga8">netsnmp_set_row_column</a>(row, 2, ASN_OCTET_STR,
                           <span class="stringliteral">"Russ Mundy"</span>, strlen(<span class=
"stringliteral">"Russ Mundy"</span>));
    <a name="a5" id="a5"></a><a class="code" href=
"group__table__dataset.html#ga7">netsnmp_mark_row_column_writable</a>(row, 2, 1);        <span class=
"comment">/* make writable via SETs */</span>

    <span class="comment">/*</span>
<span class="comment">     * set column 3 to be the WG chair name "David Harrington" </span>
<span class="comment">     */</span>
    <a class="code" href="group__table__dataset.html#ga8">netsnmp_set_row_column</a>(row, 3, ASN_OCTET_STR, <span class=
"stringliteral">"David Harrington"</span>,
                           strlen(<span class="stringliteral">"David Harrington"</span>));
    <a class="code" href="group__table__dataset.html#ga7">netsnmp_mark_row_column_writable</a>(row, 3, 1);        <span class=
"comment">/* make writable via SETs */</span>

    <span class="comment">/*</span>
<span class="comment">     * add the row to the table </span>
<span class="comment">     */</span>
    <a name="a6" id="a6"></a><a class="code" href=
"group__table__dataset.html#ga18">netsnmp_table_dataset_add_row</a>(table_set, row);

<span class="preprocessor">#ifdef ADD_MORE_DATA</span>
    <span class="comment">/*</span>
<span class="comment">     * add the data, for the second row </span>
<span class="comment">     */</span>
    row = <a class="code" href="group__table__data.html#ga13">netsnmp_create_table_data_row</a>();
    netsnmp_table_row_add_index(row, ASN_OCTET_STR, <span class="stringliteral">"snmpconf"</span>,
                                strlen(<span class="stringliteral">"snmpconf"</span>));
    <a class="code" href="group__table__dataset.html#ga8">netsnmp_set_row_column</a>(row, 2, ASN_OCTET_STR, <span class=
"stringliteral">"David Partain"</span>,
                           strlen(<span class="stringliteral">"David Partain"</span>));
    <a class="code" href="group__table__dataset.html#ga7">netsnmp_mark_row_column_writable</a>(row, 2, 1);        <span class=
"comment">/* make writable */</span>
    <a class="code" href="group__table__dataset.html#ga8">netsnmp_set_row_column</a>(row, 3, ASN_OCTET_STR, <span class=
"stringliteral">"Jon Saperia"</span>,
                           strlen(<span class="stringliteral">"Jon Saperia"</span>));
    <a class="code" href="group__table__dataset.html#ga7">netsnmp_mark_row_column_writable</a>(row, 3, 1);        <span class=
"comment">/* make writable */</span>
    <a class="code" href="group__table__dataset.html#ga18">netsnmp_table_dataset_add_row</a>(table_set, row);
<span class="preprocessor">#endif</span>

    <span class="comment">/*</span>
<span class="comment">     * Finally, this actually allows the "add_row" token it the</span>
<span class="comment">     * * snmpd.conf file to add rows to this table.</span>
<span class="comment">     * * Example snmpd.conf line:</span>
<span class="comment">     * *   add_row netSnmpIETFWGTable eos "Glenn Waters" "Dale Francisco"</span>
<span class="comment">     */</span>
    <a name="a7" id="a7"></a><a class="code" href=
"group__table__dataset.html#ga14">netsnmp_register_auto_data_table</a>(table_set, NULL);

    DEBUGMSGTL((<span class="stringliteral">"example_data_set"</span>, <span class=
"stringliteral">"Done initializing.\n"</span>));
}
</pre>
  </div>
  <hr size="1" />

  <address style="align: right;">
    <small><!--#include virtual="/sfbutton.html" --><br />
    Generated on Thu Oct 28 21:46:55 2004 for net-snmp by  <a href="http://www.doxygen.org/index.html"><img src="doxygen.png"
    alt="doxygen" align="middle" border="0" /></a> 1.3.9.1</small>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

