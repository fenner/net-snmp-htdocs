<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <div class="qindex">
    <a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class=
    "qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class=
    "qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class=
    "qindex" href="examples.html">Examples</a>
  </div>

  <div class="nav">
    <a class="el" href="dir_000003.html">agent</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">helpers</a>
  </div>

  <h1>instance.c</h1>

  <div class="fragment">
    <pre class="fragment">
00001 <span class="comment">/* Portions of this file are subject to the following copyright(s).  See</span>
00002 <span class="comment"> * the Net-SNMP's COPYING file for more details and other copyrights</span>
00003 <span class="comment"> * that may apply:</span>
00004 <span class="comment"> */</span>
00005 <span class="comment">/*</span>
00006 <span class="comment"> * Portions of this file are copyrighted by:</span>
00007 <span class="comment"> * Copyright &copy; 2003 Sun Microsystems, Inc. All rights reserved.</span>
00008 <span class="comment"> * Use is subject to license terms specified in the COPYING file</span>
00009 <span class="comment"> * distributed with the Net-SNMP package.</span>
00010 <span class="comment"> */</span>
00011 <span class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
00012 
00013 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00014 <span class="preprocessor">#if HAVE_STRING_H</span>
00015 <span class="preprocessor">#include &lt;string.h&gt;</span>
00016 <span class="preprocessor">#else</span>
00017 <span class="preprocessor">#include &lt;strings.h&gt;</span>
00018 <span class="preprocessor">#endif</span>
00019 
00020 <span class="preprocessor">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
00021 <span class="preprocessor">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</span>
00022 
00023 <span class="preprocessor">#include &lt;net-snmp/agent/instance.h&gt;</span>
00024 <span class="preprocessor">#include &lt;net-snmp/agent/serialize.h&gt;</span>
00025 <span class="preprocessor">#include &lt;net-snmp/agent/read_only.h&gt;</span>
00026 
00027 <span class="preprocessor">#if HAVE_DMALLOC_H</span>
00028 <span class="preprocessor">#include &lt;dmalloc.h&gt;</span>
00029 <span class="preprocessor">#endif</span>
00030 
00045 <a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *
<a name="l00046" id="l00046"></a><a class="code" href="group__instance.html#ga0">00046</a> <a class="code" href=
"group__instance.html#ga0">netsnmp_get_instance_handler</a>(<span class="keywordtype">void</span>)
00047 {
00048     <span class="keywordflow">return</span> <a class="code" href=
"group__handler.html#ga7">netsnmp_create_handler</a>(<span class="stringliteral">"instance"</span>,
00049                                   netsnmp_instance_helper_handler);
00050 }
00051 
00070 <span class="keywordtype">int</span>
<a name="l00071" id="l00071"></a><a class="code" href="group__instance.html#ga1">00071</a> <a class="code" href=
"group__instance.html#ga1">netsnmp_register_instance</a>(<a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo)
00072 {
00073     <a class="code" href="group__handler.html#ga14">netsnmp_inject_handler</a>(reginfo, <a class="code" href=
"group__instance.html#ga0">netsnmp_get_instance_handler</a>());
00074     <span class="keywordflow">return</span> <a class="code" href=
"group__serialize.html#ga1">netsnmp_register_serialize</a>(reginfo);
00075 }
00076 
00095 <span class="keywordtype">int</span>
<a name="l00096" id="l00096"></a><a class="code" href="group__instance.html#ga2">00096</a> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(<a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo)
00097 {
00098     <a class="code" href="group__handler.html#ga14">netsnmp_inject_handler</a>(reginfo, <a class="code" href=
"group__instance.html#ga0">netsnmp_get_instance_handler</a>());
00099     <a class="code" href="group__handler.html#ga14">netsnmp_inject_handler</a>(reginfo, <a class="code" href=
"group__read__only.html#ga0">netsnmp_get_read_only_handler</a>());
00100     <span class="keywordflow">return</span> <a class="code" href=
"group__serialize.html#ga1">netsnmp_register_serialize</a>(reginfo);
00101 }
00102 
00103 <span class="keyword">static</span>
00104 <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *
00105 get_reg(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00106         <span class="keyword">const</span> <span class="keywordtype">char</span> *ourname,
00107         oid * reg_oid, size_t reg_oid_len,
00108         <span class="keywordtype">void</span> *it,
00109         <span class="keywordtype">int</span> modes,
00110         Netsnmp_Node_Handler * scalarh, Netsnmp_Node_Handler * subhandler,
00111         <span class="keyword">const</span> <span class="keywordtype">char</span> *contextName)
00112 {
00113     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00114     <a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *myhandler;
00115 
00116     <span class="keywordflow">if</span> (subhandler) {
00117         myreg =
00118             netsnmp_create_handler_registration(name,
00119                                                 subhandler,
00120                                                 reg_oid, reg_oid_len,
00121                                                 modes);
00122         myhandler = <a class="code" href="group__handler.html#ga7">netsnmp_create_handler</a>(ourname, scalarh);
00123         myhandler-&gt;<a class="code" href="structnetsnmp__mib__handler__s.html#o1">myvoid</a> = (<span class=
"keywordtype">void</span> *) it;
00124         <a class="code" href="group__handler.html#ga14">netsnmp_inject_handler</a>(myreg, myhandler);
00125     } <span class="keywordflow">else</span> {
00126         myreg =
00127             netsnmp_create_handler_registration(name,
00128                                                 scalarh,
00129                                                 reg_oid, reg_oid_len,
00130                                                 modes);
00131         myreg-&gt;<a class="code" href="structnetsnmp__handler__registration__s.html#o4">handler</a>-&gt;<a class="code"
href="structnetsnmp__mib__handler__s.html#o1">myvoid</a> = (<span class="keywordtype">void</span> *) it;
00132     }
00133     <span class="keywordflow">if</span> (contextName)
00134         myreg-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o1">contextName</a> = strdup(contextName);
00135     <span class="keywordflow">return</span> myreg;
00136 }
00137 
00138 <span class="keywordtype">int</span>
00139 netsnmp_register_read_only_ulong_instance(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00140                                           oid * reg_oid,
00141                                           size_t reg_oid_len, u_long * it,
00142                                           Netsnmp_Node_Handler *
00143                                           subhandler)
00144 {
00145     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00146 
00147     myreg = get_reg(name, <span class="stringliteral">"ulong_handler"</span>, reg_oid, reg_oid_len, it,
00148                     HANDLER_CAN_RONLY, netsnmp_instance_ulong_handler,
00149                     subhandler, NULL);
00150     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00151 }
00152 
00153 <span class="keywordtype">int</span>
00154 netsnmp_register_ulong_instance(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00155                                 oid * reg_oid, size_t reg_oid_len,
00156                                 u_long * it,
00157                                 Netsnmp_Node_Handler * subhandler)
00158 {
00159     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00160 
00161     myreg = get_reg(name, <span class="stringliteral">"ulong_handler"</span>, reg_oid, reg_oid_len, it,
00162                     HANDLER_CAN_RWRITE, netsnmp_instance_ulong_handler,
00163                     subhandler, NULL);
00164     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga1">netsnmp_register_instance</a>(myreg);
00165 }
00166 
00167 <span class="keywordtype">int</span>
00168 netsnmp_register_read_only_counter32_instance(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *name,
00169                                               oid * reg_oid,
00170                                               size_t reg_oid_len,
00171                                               u_long * it,
00172                                               Netsnmp_Node_Handler *
00173                                               subhandler)
00174 {
00175     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00176 
00177     myreg = get_reg(name, <span class="stringliteral">"counter32_handler"</span>, reg_oid, reg_oid_len, it,
00178                     HANDLER_CAN_RWRITE, netsnmp_instance_counter32_handler,
00179                     subhandler, NULL);
00180     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00181 }
00182 
00183 <span class="keywordtype">int</span>
00184 netsnmp_register_read_only_long_instance(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00185                                          oid * reg_oid, size_t reg_oid_len,
00186                                          <span class="keywordtype">long</span> *it,
00187                                          Netsnmp_Node_Handler * subhandler)
00188 {
00189     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00190 
00191     myreg = get_reg(name, <span class="stringliteral">"long_handler"</span>, reg_oid, reg_oid_len, it,
00192                     HANDLER_CAN_RONLY, netsnmp_instance_long_handler,
00193                     subhandler, NULL);
00194     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00195 }
00196 
00197 <span class="keywordtype">int</span>
00198 netsnmp_register_long_instance(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00199                                oid * reg_oid, size_t reg_oid_len,
00200                                <span class="keywordtype">long</span> *it, Netsnmp_Node_Handler * subhandler)
00201 {
00202     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00203 
00204     myreg = get_reg(name, <span class="stringliteral">"long_handler"</span>, reg_oid, reg_oid_len, it,
00205                     HANDLER_CAN_RWRITE, netsnmp_instance_long_handler,
00206                     subhandler, NULL);
00207     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga1">netsnmp_register_instance</a>(myreg);
00208 }
00209 
00210 <span class="keywordtype">int</span>
00211 netsnmp_register_read_only_int_instance(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00212                                 oid * reg_oid, size_t reg_oid_len,
00213                                 <span class="keywordtype">int</span> *it, Netsnmp_Node_Handler * subhandler)
00214 {
00215     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00216 
00217     myreg = get_reg(name, <span class="stringliteral">"int_handler"</span>, reg_oid, reg_oid_len, it,
00218                     HANDLER_CAN_RONLY, netsnmp_instance_int_handler,
00219                     subhandler, NULL);
00220     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00221 }
00222 
00223   <span class="comment">/*</span>
00224 <span class="comment">   * Compatibility with earlier (inconsistently named) routine</span>
00225 <span class="comment">   */</span>
00226 <span class="keywordtype">int</span>
00227 register_read_only_int_instance(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00228                                 oid * reg_oid, size_t reg_oid_len,
00229                                 <span class="keywordtype">int</span> *it, Netsnmp_Node_Handler * subhandler)
00230 {
00231   <span class="keywordflow">return</span> netsnmp_register_read_only_int_instance(name,
00232                                 reg_oid, reg_oid_len,
00233                                 it, subhandler);
00234 }
00235 
00236 <span class="comment">/*</span>
00237 <span class="comment"> * Context registrations</span>
00238 <span class="comment"> */</span>
00239 
00240 <span class="keywordtype">int</span>
00241 netsnmp_register_read_only_ulong_instance_context(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *name,
00242                                                   oid * reg_oid,
00243                                                   size_t reg_oid_len,
00244                                                   u_long * it,
00245                                                   Netsnmp_Node_Handler *
00246                                                   subhandler,
00247                                                   <span class="keyword">const</span> <span class=
"keywordtype">char</span> *contextName)
00248 {
00249     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00250 
00251     myreg = get_reg(name, <span class="stringliteral">"ulong_handler"</span>, reg_oid, reg_oid_len, it,
00252                     HANDLER_CAN_RONLY, netsnmp_instance_ulong_handler,
00253                     subhandler, contextName);
00254     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00255 }
00256 
00257 <span class="keywordtype">int</span>
00258 netsnmp_register_ulong_instance_context(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00259                                         oid * reg_oid, size_t reg_oid_len,
00260                                         u_long * it,
00261                                         Netsnmp_Node_Handler * subhandler,
00262                                         <span class="keyword">const</span> <span class=
"keywordtype">char</span> *contextName)
00263 {
00264     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00265 
00266     myreg = get_reg(name, <span class="stringliteral">"ulong_handler"</span>, reg_oid, reg_oid_len, it,
00267                     HANDLER_CAN_RWRITE, netsnmp_instance_ulong_handler,
00268                     subhandler, contextName);
00269     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga1">netsnmp_register_instance</a>(myreg);
00270 }
00271 
00272 <span class="keywordtype">int</span>
00273 netsnmp_register_read_only_counter32_instance_context(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *name,
00274                                                       oid * reg_oid,
00275                                                       size_t reg_oid_len,
00276                                                       u_long * it,
00277                                                       Netsnmp_Node_Handler *
00278                                                       subhandler,
00279                                                       <span class="keyword">const</span> <span class=
"keywordtype">char</span> *contextName)
00280 {
00281     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00282 
00283     myreg = get_reg(name, <span class="stringliteral">"counter32_handler"</span>, reg_oid, reg_oid_len, it,
00284                     HANDLER_CAN_RWRITE, netsnmp_instance_counter32_handler,
00285                     subhandler, contextName);
00286     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00287 }
00288 
00289 <span class="keywordtype">int</span>
00290 netsnmp_register_read_only_long_instance_context(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *name,
00291                                                  oid * reg_oid,
00292                                                  size_t reg_oid_len,
00293                                                  <span class="keywordtype">long</span> *it,
00294                                                  Netsnmp_Node_Handler
00295                                                  *subhandler,
00296                                                  <span class="keyword">const</span> <span class=
"keywordtype">char</span> *contextName)
00297 {
00298     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00299 
00300     myreg = get_reg(name, <span class="stringliteral">"long_handler"</span>, reg_oid, reg_oid_len, it,
00301                     HANDLER_CAN_RONLY, netsnmp_instance_long_handler,
00302                     subhandler, contextName);
00303     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00304 }
00305 
00306 <span class="keywordtype">int</span>
00307 netsnmp_register_long_instance_context(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00308                                        oid * reg_oid, size_t reg_oid_len,
00309                                        <span class="keywordtype">long</span> *it,
00310                                        Netsnmp_Node_Handler * subhandler,
00311                                        <span class="keyword">const</span> <span class=
"keywordtype">char</span> *contextName)
00312 {
00313     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00314 
00315     myreg = get_reg(name, <span class="stringliteral">"long_handler"</span>, reg_oid, reg_oid_len, it,
00316                     HANDLER_CAN_RWRITE, netsnmp_instance_long_handler,
00317                     subhandler, contextName);
00318     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga1">netsnmp_register_instance</a>(myreg);
00319 }
00320 
00321 <span class="keywordtype">int</span>
00322 netsnmp_register_read_only_int_instance_context(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *name,
00323                                                 oid * reg_oid,
00324                                                 size_t reg_oid_len,
00325                                                 <span class="keywordtype">int</span> *it,
00326                                                 Netsnmp_Node_Handler * subhandler,
00327                                                 <span class="keyword">const</span> <span class=
"keywordtype">char</span> *contextName)
00328 {
00329     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00330 
00331     myreg = get_reg(name, <span class="stringliteral">"int_handler"</span>, reg_oid, reg_oid_len, it,
00332                     HANDLER_CAN_RONLY, netsnmp_instance_int_handler,
00333                     subhandler, contextName);
00334     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga2">netsnmp_register_read_only_instance</a>(myreg);
00335 }
00336 
00337 <span class="comment">/*</span>
00338 <span class="comment"> * Compatibility with earlier (inconsistently named) routine</span>
00339 <span class="comment"> */</span>
00340 <span class="keywordtype">int</span>
00341 register_read_only_int_instance_context(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00342                                         oid * reg_oid, size_t reg_oid_len,
00343                                         <span class="keywordtype">int</span> *it,
00344                                         Netsnmp_Node_Handler * subhandler,
00345                                         <span class="keyword">const</span> <span class=
"keywordtype">char</span> *contextName)
00346 {
00347     <span class="keywordflow">return</span> netsnmp_register_read_only_int_instance_context(name,
00348                                                            reg_oid, reg_oid_len,
00349                                                            it, subhandler,
00350                                                            contextName);
00351 }
00352 
00371 <span class="keywordtype">int</span>
<a name="l00372" id="l00372"></a><a class="code" href="group__instance.html#ga18">00372</a> <a class="code" href=
"group__instance.html#ga18">netsnmp_register_int_instance</a>(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *name,
00373                               oid * reg_oid, size_t reg_oid_len,
00374                               <span class="keywordtype">int</span> *it, Netsnmp_Node_Handler * subhandler)
00375 {
00376     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *myreg;
00377 
00378     myreg = get_reg(name, <span class="stringliteral">"int_handler"</span>, reg_oid, reg_oid_len, it,
00379                     HANDLER_CAN_RWRITE, netsnmp_instance_int_handler,
00380                     subhandler, NULL);
00381     <span class="keywordflow">return</span> <a class="code" href=
"group__instance.html#ga1">netsnmp_register_instance</a>(myreg);
00382 }
00383 
00384 <span class="keywordtype">int</span>
00385 netsnmp_instance_ulong_handler(<a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler,
00386                                <a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo,
00387                                <a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00388                                <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests)
00389 {
00390 
00391     u_long         *it = (u_long *) handler-&gt;<a class="code" href="structnetsnmp__mib__handler__s.html#o1">myvoid</a>;
00392     u_long         *it_save;
00393 
00394     DEBUGMSGTL((<span class="stringliteral">"netsnmp_instance_ulong_handler"</span>, <span class=
"stringliteral">"Got request:  %d\n"</span>,
00395                 reqinfo-&gt;<a class="code" href="structnetsnmp__agent__request__info__s.html#o0">mode</a>));
00396 
00397     <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00398         <span class="comment">/*</span>
00399 <span class="comment">         * data requests </span>
00400 <span class="comment">         */</span>
00401     <span class="keywordflow">case</span> MODE_GET:
00402         <a class="code" href="group__snmp__client.html#ga18">snmp_set_var_typed_value</a>(requests-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#o0">requestvb</a>, ASN_UNSIGNED,
00403                                  (u_char *) it, <span class="keyword">sizeof</span>(*it));
00404         <span class="keywordflow">break</span>;
00405 
00406         <span class="comment">/*</span>
00407 <span class="comment">         * SET requests.  Should only get here if registered RWRITE </span>
00408 <span class="comment">         */</span>
00409     <span class="keywordflow">case</span> MODE_SET_RESERVE1:
00410         <span class="keywordflow">if</span> (requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href=
"structvariable__list.html#o3">type</a> != ASN_UNSIGNED)
00411             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00412                                       SNMP_ERR_WRONGTYPE);
00413         <span class="keywordflow">break</span>;
00414 
00415     <span class="keywordflow">case</span> MODE_SET_RESERVE2:
00416         <span class="comment">/*</span>
00417 <span class="comment">         * store old info for undo later </span>
00418 <span class="comment">         */</span>
00419         <a class="code" href="group__util.html#ga5">memdup</a>((u_char **) &amp; it_save, (u_char *) it, <span class=
"keyword">sizeof</span>(u_long));
00420         <span class="keywordflow">if</span> (it_save == NULL) {
00421             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00422                                       SNMP_ERR_RESOURCEUNAVAILABLE);
00423             <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00424         }
00425         <a class="code" href="group__handler.html#ga27">netsnmp_request_add_list_data</a>(requests,
00426                                       netsnmp_create_data_list
00427                                       (INSTANCE_HANDLER_NAME, it_save,
00428                                        free));
00429         <span class="keywordflow">break</span>;
00430 
00431     <span class="keywordflow">case</span> MODE_SET_ACTION:
00432         <span class="comment">/*</span>
00433 <span class="comment">         * update current </span>
00434 <span class="comment">         */</span>
00435         DEBUGMSGTL((<span class="stringliteral">"testhandler"</span>, <span class=
"stringliteral">"updated u_long %ul -&gt; %ul\n"</span>, *it,
00436                     *(requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href=
"structvariable__list.html#o4">val</a>.integer)));
00437         *it = *(requests-&gt;<a class="code" href="structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class=
"code" href="structvariable__list.html#o4">val</a>.integer);
00438         <span class="keywordflow">break</span>;
00439 
00440     <span class="keywordflow">case</span> MODE_SET_UNDO:
00441         *it =
00442             *((u_long *) <a class="code" href="group__handler.html#ga29">netsnmp_request_get_list_data</a>(requests,
00443                                                        INSTANCE_HANDLER_NAME));
00444         <span class="keywordflow">break</span>;
00445 
00446     <span class="keywordflow">case</span> MODE_SET_COMMIT:
00447     <span class="keywordflow">case</span> MODE_SET_FREE:
00448         <span class="comment">/*</span>
00449 <span class="comment">         * nothing to do </span>
00450 <span class="comment">         */</span>
00451         <span class="keywordflow">break</span>;
00452     }
00453 
00454     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a> &amp;&amp; handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a>-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o3">access_method</a>)
00455         <span class="keywordflow">return</span> <a class="code" href=
"group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo,
00456                                          requests);
00457 
00458     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00459 }
00460 
00461 <span class="keywordtype">int</span>
00462 netsnmp_instance_counter32_handler(<a class="code" href=
"structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler,
00463                                    <a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo,
00464                                    <a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00465                                    <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests)
00466 {
00467 
00468     u_long         *it = (u_long *) handler-&gt;<a class="code" href="structnetsnmp__mib__handler__s.html#o1">myvoid</a>;
00469 
00470     DEBUGMSGTL((<span class="stringliteral">"netsnmp_instance_counter32_handler"</span>,
00471                 <span class="stringliteral">"Got request:  %d\n"</span>, reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>));
00472 
00473     <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00474         <span class="comment">/*</span>
00475 <span class="comment">         * data requests </span>
00476 <span class="comment">         */</span>
00477     <span class="keywordflow">case</span> MODE_GET:
00478         <a class="code" href="group__snmp__client.html#ga18">snmp_set_var_typed_value</a>(requests-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#o0">requestvb</a>, ASN_COUNTER,
00479                                  (u_char *) it, <span class="keyword">sizeof</span>(*it));
00480         <span class="keywordflow">break</span>;
00481 
00482         <span class="comment">/*</span>
00483 <span class="comment">         * SET requests.  Should only get here if registered RWRITE </span>
00484 <span class="comment">         */</span>
00485     <span class="keywordflow">default</span>:
00486         <a class="code" href="group__snmp__logging.html#ga39">snmp_log</a>(LOG_ERR,
00487                  <span class="stringliteral">"netsnmp_instance_counter32_handler: illegal mode\n"</span>);
00488         <a class="code" href=
"group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests, SNMP_ERR_GENERR);
00489         <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00490     }
00491     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a> &amp;&amp; handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a>-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o3">access_method</a>)
00492         <span class="keywordflow">return</span> <a class="code" href=
"group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo,
00493                                          requests);
00494     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00495 }
00496 
00497 <span class="keywordtype">int</span>
00498 netsnmp_instance_long_handler(<a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler,
00499                               <a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo,
00500                               <a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00501                               <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests)
00502 {
00503 
00504     <span class="keywordtype">long</span>           *it = (u_long *) handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o1">myvoid</a>;
00505     <span class="keywordtype">long</span>           *it_save;
00506 
00507     DEBUGMSGTL((<span class="stringliteral">"netsnmp_instance_long_handler"</span>, <span class=
"stringliteral">"Got request:  %d\n"</span>,
00508                 reqinfo-&gt;<a class="code" href="structnetsnmp__agent__request__info__s.html#o0">mode</a>));
00509 
00510     <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00511         <span class="comment">/*</span>
00512 <span class="comment">         * data requests </span>
00513 <span class="comment">         */</span>
00514     <span class="keywordflow">case</span> MODE_GET:
00515         <a class="code" href="group__snmp__client.html#ga18">snmp_set_var_typed_value</a>(requests-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#o0">requestvb</a>, ASN_INTEGER,
00516                                  (u_char *) it, <span class="keyword">sizeof</span>(*it));
00517         <span class="keywordflow">break</span>;
00518 
00519         <span class="comment">/*</span>
00520 <span class="comment">         * SET requests.  Should only get here if registered RWRITE </span>
00521 <span class="comment">         */</span>
00522     <span class="keywordflow">case</span> MODE_SET_RESERVE1:
00523         <span class="keywordflow">if</span> (requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href=
"structvariable__list.html#o3">type</a> != ASN_INTEGER)
00524             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00525                                       SNMP_ERR_WRONGTYPE);
00526         <span class="keywordflow">break</span>;
00527 
00528     <span class="keywordflow">case</span> MODE_SET_RESERVE2:
00529         <span class="comment">/*</span>
00530 <span class="comment">         * store old info for undo later </span>
00531 <span class="comment">         */</span>
00532         <a class="code" href="group__util.html#ga5">memdup</a>((u_char **) &amp; it_save, (u_char *) it, <span class=
"keyword">sizeof</span>(u_long));
00533         <span class="keywordflow">if</span> (it_save == NULL) {
00534             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00535                                       SNMP_ERR_RESOURCEUNAVAILABLE);
00536             <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00537         }
00538         <a class="code" href="group__handler.html#ga27">netsnmp_request_add_list_data</a>(requests,
00539                                       netsnmp_create_data_list
00540                                       (INSTANCE_HANDLER_NAME, it_save,
00541                                        free));
00542         <span class="keywordflow">break</span>;
00543 
00544     <span class="keywordflow">case</span> MODE_SET_ACTION:
00545         <span class="comment">/*</span>
00546 <span class="comment">         * update current </span>
00547 <span class="comment">         */</span>
00548         DEBUGMSGTL((<span class="stringliteral">"testhandler"</span>, <span class=
"stringliteral">"updated u_long %ul -&gt; %ul\n"</span>, *it,
00549                     *(requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href=
"structvariable__list.html#o4">val</a>.integer)));
00550         *it = *(requests-&gt;<a class="code" href="structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class=
"code" href="structvariable__list.html#o4">val</a>.integer);
00551         <span class="keywordflow">break</span>;
00552 
00553     <span class="keywordflow">case</span> MODE_SET_UNDO:
00554         *it =
00555             *((u_long *) <a class="code" href="group__handler.html#ga29">netsnmp_request_get_list_data</a>(requests,
00556                                                        INSTANCE_HANDLER_NAME));
00557         <span class="keywordflow">break</span>;
00558 
00559     <span class="keywordflow">case</span> MODE_SET_COMMIT:
00560     <span class="keywordflow">case</span> MODE_SET_FREE:
00561         <span class="comment">/*</span>
00562 <span class="comment">         * nothing to do </span>
00563 <span class="comment">         */</span>
00564         <span class="keywordflow">break</span>;
00565     }
00566     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a> &amp;&amp; handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a>-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o3">access_method</a>)
00567         <span class="keywordflow">return</span> <a class="code" href=
"group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo,
00568                                          requests);
00569     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00570 }
00571 
00572 <span class="keywordtype">int</span>
00573 netsnmp_instance_int_handler(<a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler,
00574                              <a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo,
00575                              <a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00576                              <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests)
00577 {
00578 
00579     <span class="keywordtype">int</span> *it = (<span class="keywordtype">int</span> *) handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o1">myvoid</a>;
00580     <span class="keywordtype">int</span> *it_save;
00581     <span class="keywordtype">long</span> tmp_it;
00582     
00583     DEBUGMSGTL((<span class="stringliteral">"netsnmp_instance_int_handler"</span>, <span class=
"stringliteral">"Got request:  %d\n"</span>,
00584                 reqinfo-&gt;<a class="code" href="structnetsnmp__agent__request__info__s.html#o0">mode</a>));
00585 
00586     <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00587         <span class="comment">/*</span>
00588 <span class="comment">         * data requests </span>
00589 <span class="comment">         */</span>
00590     <span class="keywordflow">case</span> MODE_GET:
00591         <span class="comment">/*</span>
00592 <span class="comment">         * Use a long here, otherwise on 64 bit use of an int would fail</span>
00593 <span class="comment">         */</span>
00594         tmp_it = *it;
00595         <a class="code" href="group__snmp__client.html#ga18">snmp_set_var_typed_value</a>(requests-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#o0">requestvb</a>, ASN_INTEGER,
00596                                  (u_char *) &amp;tmp_it, <span class="keyword">sizeof</span>(<span class=
"keywordtype">long</span>));
00597         <span class="keywordflow">break</span>;
00598 
00599         <span class="comment">/*</span>
00600 <span class="comment">         * SET requests.  Should only get here if registered RWRITE </span>
00601 <span class="comment">         */</span>
00602     <span class="keywordflow">case</span> MODE_SET_RESERVE1:
00603         <span class="keywordflow">if</span> (requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href=
"structvariable__list.html#o3">type</a> != ASN_INTEGER)
00604             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00605                                       SNMP_ERR_WRONGTYPE);
00606         <span class="keywordflow">break</span>;
00607 
00608     <span class="keywordflow">case</span> MODE_SET_RESERVE2:
00609         <span class="comment">/*</span>
00610 <span class="comment">         * store old info for undo later </span>
00611 <span class="comment">         */</span>
00612         <a class="code" href="group__util.html#ga5">memdup</a>((u_char **) &amp; it_save, (u_char *) it, <span class=
"keyword">sizeof</span>(u_long));
00613         <span class="keywordflow">if</span> (it_save == NULL) {
00614             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00615                                       SNMP_ERR_RESOURCEUNAVAILABLE);
00616             <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00617         }
00618         <a class="code" href="group__handler.html#ga27">netsnmp_request_add_list_data</a>(requests,
00619                                       netsnmp_create_data_list
00620                                       (INSTANCE_HANDLER_NAME, it_save,
00621                                        free));
00622         <span class="keywordflow">break</span>;
00623 
00624     <span class="keywordflow">case</span> MODE_SET_ACTION:
00625         <span class="comment">/*</span>
00626 <span class="comment">         * update current </span>
00627 <span class="comment">         */</span>
00628         DEBUGMSGTL((<span class="stringliteral">"testhandler"</span>, <span class=
"stringliteral">"updated int %d -&gt; %l\n"</span>, *it,
00629                     *(requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href=
"structvariable__list.html#o4">val</a>.integer)));
00630         *it = (int) *(requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#o4">val</a>.integer);
00631         <span class="keywordflow">break</span>;
00632 
00633     <span class="keywordflow">case</span> MODE_SET_UNDO:
00634         *it =
00635             *((u_int *) <a class="code" href="group__handler.html#ga29">netsnmp_request_get_list_data</a>(requests,
00636                                                       INSTANCE_HANDLER_NAME));
00637         <span class="keywordflow">break</span>;
00638 
00639     <span class="keywordflow">case</span> MODE_SET_COMMIT:
00640     <span class="keywordflow">case</span> MODE_SET_FREE:
00641         <span class="comment">/*</span>
00642 <span class="comment">         * nothing to do </span>
00643 <span class="comment">         */</span>
00644         <span class="keywordflow">break</span>;
00645     }
00646     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a> &amp;&amp; handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o4">next</a>-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o3">access_method</a>)
00647         <span class="keywordflow">return</span> <a class="code" href=
"group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo,
00648                                          requests);
00649     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00650 }
00651 
00652 <span class="keywordtype">int</span>
00653 netsnmp_instance_helper_handler(<a class="code" href=
"structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler,
00654                                 <a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo,
00655                                 <a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00656                                 <a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests)
00657 {
00658 
00659     <a class="code" href="structvariable__list.html">netsnmp_variable_list</a> *var = requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>;
00660 
00661     <span class="keywordtype">int</span>             ret, cmp;
00662 
00663     DEBUGMSGTL((<span class="stringliteral">"helper:instance"</span>, <span class=
"stringliteral">"Got request:\n"</span>));
00664     cmp = <a class="code" href="group__library.html#ga98">snmp_oid_compare</a>(requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#o1">name</a>,
00665                            requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#o2">name_length</a>,
00666                            reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o2">rootoid</a>, reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o3">rootoid_len</a>);
00667 
00668     DEBUGMSGTL((<span class="stringliteral">"helper:instance"</span>, <span class="stringliteral">"  oid:"</span>, cmp));
00669     DEBUGMSGOID((<span class="stringliteral">"helper:instance"</span>, var-&gt;<a class="code" href=
"structvariable__list.html#o1">name</a>, var-&gt;<a class="code" href="structvariable__list.html#o2">name_length</a>));
00670     DEBUGMSG((<span class="stringliteral">"helper:instance"</span>, <span class="stringliteral">"\n"</span>));
00671 
00672     <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00673     <span class="keywordflow">case</span> MODE_GET:
00674         <span class="keywordflow">if</span> (cmp != 0) {
00675             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00676                                       SNMP_NOSUCHINSTANCE);
00677             <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00678         } <span class="keywordflow">else</span> {
00679             <span class="keywordflow">return</span> <a class="code" href=
"group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo,
00680                                              requests);
00681         }
00682         <span class="keywordflow">break</span>;
00683 
00684     <span class="keywordflow">case</span> MODE_SET_RESERVE1:
00685     <span class="keywordflow">case</span> MODE_SET_RESERVE2:
00686     <span class="keywordflow">case</span> MODE_SET_ACTION:
00687     <span class="keywordflow">case</span> MODE_SET_COMMIT:
00688     <span class="keywordflow">case</span> MODE_SET_UNDO:
00689     <span class="keywordflow">case</span> MODE_SET_FREE:
00690         <span class="keywordflow">if</span> (cmp != 0) {
00691             <a class="code" href="group__snmp__agent.html#ga79">netsnmp_set_request_error</a>(reqinfo, requests,
00692                                       SNMP_ERR_NOCREATION);
00693             <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00694         } <span class="keywordflow">else</span> {
00695             <span class="keywordflow">return</span> <a class="code" href=
"group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo,
00696                                              requests);
00697         }
00698         <span class="keywordflow">break</span>;
00699 
00700     <span class="keywordflow">case</span> MODE_GETNEXT:
00701         <span class="keywordflow">if</span> (cmp &lt; 0 || (cmp == 0 &amp;&amp; requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o7">inclusive</a>)) {
00702             reqinfo-&gt;<a class="code" href="structnetsnmp__agent__request__info__s.html#o0">mode</a> = MODE_GET;
00703             snmp_set_var_objid(requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>, reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o2">rootoid</a>,
00704                                reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o3">rootoid_len</a>);
00705             ret =
00706                 <a class="code" href="group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo,
00707                                           requests);
00708             reqinfo-&gt;<a class="code" href="structnetsnmp__agent__request__info__s.html#o0">mode</a> = MODE_GETNEXT;
00709             <span class="keywordflow">return</span> ret;
00710         } <span class="keywordflow">else</span> {
00711             <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00712         }
00713         <span class="keywordflow">break</span>;
00714     }
00715     <span class="comment">/*</span>
00716 <span class="comment">     * got here only if illegal mode found </span>
00717 <span class="comment">     */</span>
00718     <span class="keywordflow">return</span> SNMP_ERR_GENERR;
00719 }
00720 
00721 <span class="comment">/*</span>
00722 <span class="comment"> * @} </span>
00723 <span class="comment"> */</span>
</pre>
  </div>
  <hr size="1" />

  <address style="align: right;">
    <small><!--#include virtual="/sfbutton.html" --><br />
    Generated on Thu Oct 28 21:46:57 2004 for net-snmp by&nbsp; <a href="http://www.doxygen.org/index.html"><img src=
    "doxygen.png" alt="doxygen" align="middle" border="0" /></a> 1.3.9.1</small>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

