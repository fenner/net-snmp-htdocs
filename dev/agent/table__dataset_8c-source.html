<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <!-- Generated by Doxygen 1.5.7.1 -->

  <div class="navigation" id="top">
    <div class="tabs">
      <ul>
        <li><a href="index.html"><span>Main Page</span></a></li>

        <li><a href="pages.html"><span>Related Pages</span></a></li>

        <li><a href="modules.html"><span>Modules</span></a></li>

        <li><a href="annotated.html"><span>Data Structures</span></a></li>

        <li class="current"><a href="files.html"><span>Files</span></a></li>

        <li><a href="examples.html"><span>Examples</span></a></li>
      </ul>
    </div>

    <div class="tabs">
      <ul>
        <li><a href="files.html"><span>File List</span></a></li>

        <li><a href="globals.html"><span>Globals</span></a></li>
      </ul>
    </div>

    <h1>table_dataset.c</h1>

    <div class="fragment">
      <pre class="fragment">
<a name="l00001" id="l00001"></a>00001 <span class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
<a name="l00002" id="l00002"></a>00002 
<a name="l00003" id="l00003"></a>00003 <span class="preprocessor">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
<a name="l00004" id="l00004"></a>00004 <span class=
"preprocessor">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</span>
<a name="l00005" id="l00005"></a>00005 
<a name="l00006" id="l00006"></a>00006 <span class="preprocessor">#include &lt;net-snmp/agent/table_dataset.h&gt;</span>
<a name="l00007" id="l00007"></a>00007 
<a name="l00008" id="l00008"></a>00008 <span class="preprocessor">#if HAVE_STRING_H</span>
<a name="l00009" id="l00009"></a>00009 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00010" id="l00010"></a>00010 <span class="preprocessor">#else</span>
<a name="l00011" id="l00011"></a>00011 <span class="preprocessor">#include &lt;strings.h&gt;</span>
<a name="l00012" id="l00012"></a>00012 <span class="preprocessor">#endif</span>
<a name="l00013" id="l00013"></a>00013 
<a name="l00014" id="l00014"></a>00014 <span class="keyword">static</span> <a class="code" href=
"structnetsnmp__data__list__s.html" title="used to iterate through lists of data">netsnmp_data_list</a> *auto_tables;
<a name="l00015" id="l00015"></a>00015 
<a name="l00016" id="l00016"></a>00016 <span class="keyword">typedef</span> <span class=
"keyword">struct </span>data_set_tables_s {
<a name="l00017" id="l00017"></a>00017     netsnmp_table_data_set *table_set;
<a name="l00018" id="l00018"></a>00018 } data_set_tables;
<a name="l00019" id="l00019"></a>00019 
<a name="l00020" id="l00020"></a>00020 <span class="keyword">typedef</span> <span class=
"keyword">struct </span>data_set_cache_s {
<a name="l00021" id="l00021"></a>00021     <span class="keywordtype">void</span>           *data;
<a name="l00022" id="l00022"></a>00022     <span class="keywordtype">size_t</span>          data_len;
<a name="l00023" id="l00023"></a>00023 } data_set_cache;
<a name="l00024" id="l00024"></a>00024 
<a name="l00025" id="l00025"></a>00025 <span class="preprocessor">#define STATE_ACTION   1</span>
<a name="l00026" id="l00026"></a>00026 <span class="preprocessor">#define STATE_COMMIT   2</span>
<a name="l00027" id="l00027"></a>00027 <span class="preprocessor">#define STATE_UNDO     3</span>
<a name="l00028" id="l00028"></a>00028 <span class="preprocessor">#define STATE_FREE     4</span>
<a name="l00029" id="l00029"></a>00029 
<a name="l00030" id="l00030"></a>00030 <span class="keyword">typedef</span> <span class="keyword">struct </span>newrow_stash_s {
<a name="l00031" id="l00031"></a>00031     netsnmp_table_row *newrow;
<a name="l00032" id="l00032"></a>00032     <span class="keywordtype">int</span>             state;
<a name="l00033" id="l00033"></a>00033     <span class="keywordtype">int</span>             created;
<a name="l00034" id="l00034"></a>00034     <span class="keywordtype">int</span>             deleted;
<a name="l00035" id="l00035"></a>00035 } newrow_stash;
<a name="l00036" id="l00036"></a>00036 
<a name="l00063" id="l00063"></a>00063 <span class="keywordtype">void</span>
<a name="l00064" id="l00064"></a>00064 netsnmp_init_table_dataset(<span class="keywordtype">void</span>) {
<a name="l00065" id="l00065"></a>00065 <span class="preprocessor">#ifndef NETSNMP_DISABLE_MIB_LOADING</span>
<a name="l00066" id="l00066"></a>00066     register_app_config_handler(<span class="stringliteral">"table"</span>,
<a name="l00067" id="l00067"></a>00067                                 netsnmp_config_parse_table_set, NULL,
<a name="l00068" id="l00068"></a>00068                                 <span class="stringliteral">"tableoid"</span>);
<a name="l00069" id="l00069"></a>00069 <span class="preprocessor">#endif </span><span class=
"comment">/* NETSNMP_DISABLE_MIB_LOADING */</span>
<a name="l00070" id="l00070"></a>00070     register_app_config_handler(<span class=
"stringliteral">"add_row"</span>, netsnmp_config_parse_add_row,
<a name="l00071" id="l00071"></a>00071                                 NULL, <span class=
"stringliteral">"table_name indexes... values..."</span>);
<a name="l00072" id="l00072"></a>00072 }
<a name="l00073" id="l00073"></a>00073 
<a name="l00074" id="l00074"></a>00074 <span class="comment">/* ==================================</span>
<a name="l00075" id="l00075"></a>00075 <span class="comment"> *</span>
<a name="l00076" id="l00076"></a>00076 <span class="comment"> * Data Set API: Table maintenance</span>
<a name="l00077" id="l00077"></a>00077 <span class="comment"> *</span>
<a name="l00078" id="l00078"></a>00078 <span class="comment"> * ================================== */</span>
<a name="l00079" id="l00079"></a>00079 
<a name="l00083" id="l00083"></a>00083 NETSNMP_INLINE netsnmp_table_data_set_storage *
<a name="l00084" id="l00084"></a><a class="code" href=
"group__table__dataset.html#g6b9f1f2244716eb1b63f4c7f0af022b4">00084</a> <a class="code" href=
"group__table__dataset.html#g6b9f1f2244716eb1b63f4c7f0af022b4" title=
"deletes a single dataset table data.">netsnmp_table_dataset_delete_data</a>(netsnmp_table_data_set_storage *data)
<a name="l00085" id="l00085"></a>00085 {
<a name="l00086" id="l00086"></a>00086     netsnmp_table_data_set_storage *nextPtr = NULL;
<a name="l00087" id="l00087"></a>00087     <span class="keywordflow">if</span> (data) {
<a name="l00088" id="l00088"></a>00088         nextPtr = data-&gt;next;
<a name="l00089" id="l00089"></a>00089         <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6" title=
"Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a>(data-&gt;data.voidp);
<a name="l00090" id="l00090"></a>00090     }
<a name="l00091" id="l00091"></a>00091     <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6" title=
"Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a>(data);
<a name="l00092" id="l00092"></a>00092     <span class="keywordflow">return</span> nextPtr;
<a name="l00093" id="l00093"></a>00093 }
<a name="l00094" id="l00094"></a>00094 
<a name="l00096" id="l00096"></a>00096 NETSNMP_INLINE <span class="keywordtype">void</span>
<a name="l00097" id="l00097"></a><a class="code" href=
"group__table__dataset.html#g21022de69a50530dd300fcc0c26bc6e7">00097</a> <a class="code" href=
"group__table__dataset.html#g21022de69a50530dd300fcc0c26bc6e7" title=
"deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_all_data</a>(netsnmp_table_data_set_storage *data)
<a name="l00098" id="l00098"></a>00098 {
<a name="l00099" id="l00099"></a>00099 
<a name="l00100" id="l00100"></a>00100     <span class="keywordflow">while</span> (data) {
<a name="l00101" id="l00101"></a>00101         data = <a class="code" href=
"group__table__dataset.html#g6b9f1f2244716eb1b63f4c7f0af022b4" title=
"deletes a single dataset table data.">netsnmp_table_dataset_delete_data</a>(data);
<a name="l00102" id="l00102"></a>00102     }
<a name="l00103" id="l00103"></a>00103 }
<a name="l00104" id="l00104"></a>00104 
<a name="l00106" id="l00106"></a>00106 NETSNMP_INLINE <span class="keywordtype">void</span>
<a name="l00107" id="l00107"></a><a class="code" href=
"group__table__dataset.html#gf44422bf337cbbd7d95a1b107d4e8971">00107</a> <a class="code" href=
"group__table__dataset.html#gf44422bf337cbbd7d95a1b107d4e8971" title=
"deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_row</a>(netsnmp_table_row *row)
<a name="l00108" id="l00108"></a>00108 {
<a name="l00109" id="l00109"></a>00109     netsnmp_table_data_set_storage *data;
<a name="l00110" id="l00110"></a>00110 
<a name="l00111" id="l00111"></a>00111     <span class="keywordflow">if</span> (!row)
<a name="l00112" id="l00112"></a>00112         <span class="keywordflow">return</span>;
<a name="l00113" id="l00113"></a>00113 
<a name="l00114" id="l00114"></a>00114     data = <a class="code" href=
"group__table__data.html#g4f84f680e50132cb614f5152db053bd0" title=
"deletes a row&amp;#39;s memory.">netsnmp_table_data_delete_row</a>(row);
<a name="l00115" id="l00115"></a>00115     <a class="code" href="group__table__dataset.html#g21022de69a50530dd300fcc0c26bc6e7"
title="deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_all_data</a>(data);
<a name="l00116" id="l00116"></a>00116 }
<a name="l00117" id="l00117"></a>00117 
<a name="l00119" id="l00119"></a>00119 NETSNMP_INLINE <span class="keywordtype">void</span>
<a name="l00120" id="l00120"></a><a class="code" href=
"group__table__dataset.html#gcaa808db27144a4f967024bd7c9b6b25">00120</a> <a class="code" href=
"group__table__dataset.html#gcaa808db27144a4f967024bd7c9b6b25" title=
"adds a new row to a dataset table">netsnmp_table_dataset_add_row</a>(netsnmp_table_data_set *table,
<a name="l00121" id="l00121"></a>00121                               netsnmp_table_row *row)
<a name="l00122" id="l00122"></a>00122 {
<a name="l00123" id="l00123"></a>00123     <span class="keywordflow">if</span> (!table)
<a name="l00124" id="l00124"></a>00124         <span class="keywordflow">return</span>;
<a name="l00125" id="l00125"></a>00125     <a class="code" href="group__table__data.html#gfa6a070da8369ec7a3c87e4fdcd014de"
title="Adds a row of data to a given table (stored in proper lexographical order).">netsnmp_table_data_add_row</a>(table-&gt;table, row);
<a name="l00126" id="l00126"></a>00126 }
<a name="l00127" id="l00127"></a>00127 
<a name="l00129" id="l00129"></a>00129 NETSNMP_INLINE <span class="keywordtype">void</span>
<a name="l00130" id="l00130"></a><a class="code" href=
"group__table__dataset.html#gbccec67ba904c7cda380ca95596317c0">00130</a> <a class="code" href=
"group__table__dataset.html#gbccec67ba904c7cda380ca95596317c0" title=
"adds a new row to a dataset table">netsnmp_table_dataset_replace_row</a>(netsnmp_table_data_set *table,
<a name="l00131" id="l00131"></a>00131                                   netsnmp_table_row *origrow,
<a name="l00132" id="l00132"></a>00132                                   netsnmp_table_row *newrow)
<a name="l00133" id="l00133"></a>00133 {
<a name="l00134" id="l00134"></a>00134     <span class="keywordflow">if</span> (!table)
<a name="l00135" id="l00135"></a>00135         <span class="keywordflow">return</span>;
<a name="l00136" id="l00136"></a>00136     <a class="code" href="group__table__data.html#gc54daadf206eda5d207a9484d0732921"
title="swaps out origrow with newrow.">netsnmp_table_data_replace_row</a>(table-&gt;table, origrow, newrow);
<a name="l00137" id="l00137"></a>00137 }
<a name="l00138" id="l00138"></a>00138 
<a name="l00140" id="l00140"></a>00140 NETSNMP_INLINE <span class="keywordtype">void</span>
<a name="l00141" id="l00141"></a><a class="code" href=
"group__table__dataset.html#g46bf89f819af6fc2baf18324e162ff0e">00141</a> <a class="code" href=
"group__table__dataset.html#g46bf89f819af6fc2baf18324e162ff0e" title=
"removes a row from the table, but doesn&amp;#39;t delete/free the column values">netsnmp_table_dataset_remove_row</a>(netsnmp_table_data_set *table,
<a name="l00142" id="l00142"></a>00142                                  netsnmp_table_row *row)
<a name="l00143" id="l00143"></a>00143 {
<a name="l00144" id="l00144"></a>00144     <span class="keywordflow">if</span> (!table)
<a name="l00145" id="l00145"></a>00145         <span class="keywordflow">return</span>;
<a name="l00146" id="l00146"></a>00146 
<a name="l00147" id="l00147"></a>00147     <a class="code" href="group__table__data.html#g5339c8a53e8462d692bd8c63d8f50a41"
title="removes and frees a row of data to a given table and returns the void *">netsnmp_table_data_remove_and_delete_row</a>(table-&gt;table, row);
<a name="l00148" id="l00148"></a>00148 }
<a name="l00149" id="l00149"></a>00149 
<a name="l00151" id="l00151"></a>00151 NETSNMP_INLINE <span class="keywordtype">void</span>
<a name="l00152" id="l00152"></a><a class="code" href=
"group__table__dataset.html#g227574752f88882185e1a97a85f10765">00152</a> <a class="code" href=
"group__table__dataset.html#g227574752f88882185e1a97a85f10765" title=
"removes a row from the table and then deletes it (and all its data)">netsnmp_table_dataset_remove_and_delete_row</a>(netsnmp_table_data_set *table,
<a name="l00153" id="l00153"></a>00153                                             netsnmp_table_row *row)
<a name="l00154" id="l00154"></a>00154 {
<a name="l00155" id="l00155"></a>00155     netsnmp_table_data_set_storage *data;
<a name="l00156" id="l00156"></a>00156 
<a name="l00157" id="l00157"></a>00157     <span class="keywordflow">if</span> (!table)
<a name="l00158" id="l00158"></a>00158         <span class="keywordflow">return</span>;
<a name="l00159" id="l00159"></a>00159 
<a name="l00160" id="l00160"></a>00160     data = (netsnmp_table_data_set_storage *)
<a name="l00161" id="l00161"></a>00161         <a class="code" href="group__table__data.html#g5339c8a53e8462d692bd8c63d8f50a41"
title=
"removes and frees a row of data to a given table and returns the void *">netsnmp_table_data_remove_and_delete_row</a>(table-&gt;table, row);
<a name="l00162" id="l00162"></a>00162 
<a name="l00163" id="l00163"></a>00163     <a class="code" href="group__table__dataset.html#g21022de69a50530dd300fcc0c26bc6e7"
title="deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_all_data</a>(data);
<a name="l00164" id="l00164"></a>00164 }
<a name="l00165" id="l00165"></a>00165 
<a name="l00167" id="l00167"></a>00167 netsnmp_table_data_set *
<a name="l00168" id="l00168"></a><a class="code" href=
"group__table__dataset.html#gb523c6783716afd206f0512f93ef6503">00168</a> <a class="code" href=
"group__table__dataset.html#gb523c6783716afd206f0512f93ef6503" title=
"Create a netsnmp_table_data_set structure given a table_data definition.">netsnmp_create_table_data_set</a>(<span class=
"keyword">const</span> <span class="keywordtype">char</span> *table_name)
<a name="l00169" id="l00169"></a>00169 {
<a name="l00170" id="l00170"></a>00170     netsnmp_table_data_set *table_set =
<a name="l00171" id="l00171"></a>00171         <a class="code" href="group__util.html#g9cd013bb193de5048149afeb9d94e424" title=
"Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(netsnmp_table_data_set);
<a name="l00172" id="l00172"></a>00172     <span class="keywordflow">if</span> (!table_set)
<a name="l00173" id="l00173"></a>00173         <span class="keywordflow">return</span> NULL;
<a name="l00174" id="l00174"></a>00174     table_set-&gt;table = <a class="code" href=
"group__table__data.html#gc0cc1567de4c67a31b398a145de6d5b1" title=
"creates and returns a pointer to table data set">netsnmp_create_table_data</a>(table_name);
<a name="l00175" id="l00175"></a>00175     <span class="keywordflow">return</span> table_set;
<a name="l00176" id="l00176"></a>00176 }
<a name="l00177" id="l00177"></a>00177 
<a name="l00179" id="l00179"></a>00179 netsnmp_table_row *
<a name="l00180" id="l00180"></a><a class="code" href=
"group__table__dataset.html#g28d4cc5c7b860b9f77725572986e081b">00180</a> <a class="code" href=
"group__table__dataset.html#g28d4cc5c7b860b9f77725572986e081b" title=
"clones a dataset row, including all data.">netsnmp_table_data_set_clone_row</a>(netsnmp_table_row *row)
<a name="l00181" id="l00181"></a>00181 {
<a name="l00182" id="l00182"></a>00182     netsnmp_table_data_set_storage *data, **newrowdata;
<a name="l00183" id="l00183"></a>00183     netsnmp_table_row *newrow;
<a name="l00184" id="l00184"></a>00184 
<a name="l00185" id="l00185"></a>00185     <span class="keywordflow">if</span> (!row)
<a name="l00186" id="l00186"></a>00186         <span class="keywordflow">return</span> NULL;
<a name="l00187" id="l00187"></a>00187 
<a name="l00188" id="l00188"></a>00188     newrow = <a class="code" href=
"group__table__data.html#g255af6ddcb7eea49cfe00de56bd87f37" title="clones a data row.">netsnmp_table_data_clone_row</a>(row);
<a name="l00189" id="l00189"></a>00189     <span class="keywordflow">if</span> (!newrow)
<a name="l00190" id="l00190"></a>00190         <span class="keywordflow">return</span> NULL;
<a name="l00191" id="l00191"></a>00191 
<a name="l00192" id="l00192"></a>00192     data = (netsnmp_table_data_set_storage *) row-&gt;data;
<a name="l00193" id="l00193"></a>00193 
<a name="l00194" id="l00194"></a>00194     if (data) {
<a name="l00195" id="l00195"></a>00195         <span class="keywordflow">for</span> (newrowdata =
<a name="l00196" id="l00196"></a>00196              (netsnmp_table_data_set_storage **) &amp;(newrow-&gt;data); data;
<a name="l00197" id="l00197"></a>00197              newrowdata = &amp;((*newrowdata)-&gt;next), data = data-&gt;next) {
<a name="l00198" id="l00198"></a>00198 
<a name="l00199" id="l00199"></a>00199             <a class="code" href="group__util.html#ge28321822c83004ae8eedcc3de2b2fde"
title="Duplicates a memory block.">memdup</a>((u_char **) newrowdata, (u_char *) data,
<a name="l00200" id="l00200"></a>00200                    <span class="keyword">sizeof</span>(netsnmp_table_data_set_storage));
<a name="l00201" id="l00201"></a>00201             <span class="keywordflow">if</span> (!*newrowdata) {
<a name="l00202" id="l00202"></a>00202                 <a class="code" href=
"group__table__dataset.html#gf44422bf337cbbd7d95a1b107d4e8971" title=
"deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_row</a>(newrow);
<a name="l00203" id="l00203"></a>00203                 <span class="keywordflow">return</span> NULL;
<a name="l00204" id="l00204"></a>00204             }
<a name="l00205" id="l00205"></a>00205 
<a name="l00206" id="l00206"></a>00206             <span class="keywordflow">if</span> (data-&gt;data.voidp) {
<a name="l00207" id="l00207"></a>00207                 <a class="code" href="group__util.html#ge28321822c83004ae8eedcc3de2b2fde"
title="Duplicates a memory block.">memdup</a>((u_char **) &amp; ((*newrowdata)-&gt;data.voidp),
<a name="l00208" id="l00208"></a>00208                        (u_char *) data-&gt;data.voidp, data-&gt;data_len);
<a name="l00209" id="l00209"></a>00209                 <span class="keywordflow">if</span> (!(*newrowdata)-&gt;data.voidp) {
<a name="l00210" id="l00210"></a>00210                     <a class="code" href=
"group__table__dataset.html#gf44422bf337cbbd7d95a1b107d4e8971" title=
"deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_row</a>(newrow);
<a name="l00211" id="l00211"></a>00211                     <span class="keywordflow">return</span> NULL;
<a name="l00212" id="l00212"></a>00212                 }
<a name="l00213" id="l00213"></a>00213             }
<a name="l00214" id="l00214"></a>00214         }
<a name="l00215" id="l00215"></a>00215     }
<a name="l00216" id="l00216"></a>00216     <span class="keywordflow">return</span> newrow;
<a name="l00217" id="l00217"></a>00217 }
<a name="l00218" id="l00218"></a>00218 
<a name="l00219" id="l00219"></a>00219 <span class="comment">/* ==================================</span>
<a name="l00220" id="l00220"></a>00220 <span class="comment"> *</span>
<a name="l00221" id="l00221"></a>00221 <span class="comment"> * Data Set API: Default row operations</span>
<a name="l00222" id="l00222"></a>00222 <span class="comment"> *</span>
<a name="l00223" id="l00223"></a>00223 <span class="comment"> * ================================== */</span>
<a name="l00224" id="l00224"></a>00224 
<a name="l00226" id="l00226"></a>00226 netsnmp_table_row *
<a name="l00227" id="l00227"></a>00227 <a class="code" href="group__table__dataset.html#g360c4b8ffc98b495e195f987d39a69d2" title=
"creates a new row from an existing defined default set">netsnmp_table_data_set_create_row_from_defaults</a>
<a name="l00228" id="l00228"></a><a class="code" href=
"group__table__dataset.html#g360c4b8ffc98b495e195f987d39a69d2">00228</a>     (netsnmp_table_data_set_storage *defrow)
<a name="l00229" id="l00229"></a>00229 {
<a name="l00230" id="l00230"></a>00230     netsnmp_table_row *row;
<a name="l00231" id="l00231"></a>00231     row = <a class="code" href="group__table__data.html#gfdadce2dee8bc75b2b0dfd8e634e46a3"
title="creates and returns a pointer to table data set">netsnmp_create_table_data_row</a>();
<a name="l00232" id="l00232"></a>00232     <span class="keywordflow">if</span> (!row)
<a name="l00233" id="l00233"></a>00233         <span class="keywordflow">return</span> NULL;
<a name="l00234" id="l00234"></a>00234     <span class="keywordflow">for</span> (; defrow; defrow = defrow-&gt;next) {
<a name="l00235" id="l00235"></a>00235         <a class="code" href=
"group__table__dataset.html#gaa497e6eec3b370c5901905696bc78af" title=
"sets a given column in a row with data given a type, value, and length.">netsnmp_set_row_column</a>(row, defrow-&gt;column, defrow-&gt;type,
<a name="l00236" id="l00236"></a>00236                                defrow-&gt;data.voidp, defrow-&gt;data_len);
<a name="l00237" id="l00237"></a>00237         <span class="keywordflow">if</span> (defrow-&gt;writable)
<a name="l00238" id="l00238"></a>00238             <a class="code" href=
"group__table__dataset.html#g5dce210cd4d59eb8b01478ee5d0dc348" title=
"marks a given column in a row as writable or not.">netsnmp_mark_row_column_writable</a>(row, defrow-&gt;column, 1);
<a name="l00239" id="l00239"></a>00239 
<a name="l00240" id="l00240"></a>00240     }
<a name="l00241" id="l00241"></a>00241     <span class="keywordflow">return</span> row;
<a name="l00242" id="l00242"></a>00242 }
<a name="l00243" id="l00243"></a>00243 
<a name="l00253" id="l00253"></a>00253 <span class="keywordtype">int</span>
<a name="l00254" id="l00254"></a><a class="code" href=
"group__table__dataset.html#g856fae0cafd9c19a1d856ad6f892c13e">00254</a> <a class="code" href=
"group__table__dataset.html#g856fae0cafd9c19a1d856ad6f892c13e" title=
"adds a new default row to a table_set.">netsnmp_table_set_add_default_row</a>(netsnmp_table_data_set *table_set,
<a name="l00255" id="l00255"></a>00255                                   <span class="keywordtype">unsigned</span> <span class=
"keywordtype">int</span> column,
<a name="l00256" id="l00256"></a>00256                                   <span class="keywordtype">int</span> type, <span class=
"keywordtype">int</span> writable,
<a name="l00257" id="l00257"></a>00257                                   <span class="keywordtype">void</span> *default_value,
<a name="l00258" id="l00258"></a>00258                                   <span class=
"keywordtype">size_t</span> default_value_len)
<a name="l00259" id="l00259"></a>00259 {
<a name="l00260" id="l00260"></a>00260     netsnmp_table_data_set_storage *new_col, *ptr, *pptr;
<a name="l00261" id="l00261"></a>00261 
<a name="l00262" id="l00262"></a>00262     <span class="keywordflow">if</span> (!table_set)
<a name="l00263" id="l00263"></a>00263         <span class="keywordflow">return</span> SNMPERR_GENERR;
<a name="l00264" id="l00264"></a>00264 
<a name="l00265" id="l00265"></a>00265     <span class="comment">/*</span>
<a name="l00266" id="l00266"></a>00266 <span class="comment">     * double check </span>
<a name="l00267" id="l00267"></a>00267 <span class="comment">     */</span>
<a name="l00268" id="l00268"></a>00268     new_col =
<a name="l00269" id="l00269"></a>00269         <a class="code" href=
"group__table__dataset.html#g415b0d8045da228d63325800cc6af88d" title=
"Finds a column within a given storage set, given the pointer to the start of the...">netsnmp_table_data_set_find_column</a>(table_set-&gt;default_row, column);
<a name="l00270" id="l00270"></a>00270     <span class="keywordflow">if</span> (new_col != NULL) {
<a name="l00271" id="l00271"></a>00271         <span class=
"keywordflow">if</span> (new_col-&gt;type == type &amp;&amp; new_col-&gt;writable == writable)
<a name="l00272" id="l00272"></a>00272             <span class="keywordflow">return</span> SNMPERR_SUCCESS;
<a name="l00273" id="l00273"></a>00273         <span class="keywordflow">return</span> SNMPERR_GENERR;
<a name="l00274" id="l00274"></a>00274     }
<a name="l00275" id="l00275"></a>00275 
<a name="l00276" id="l00276"></a>00276     new_col = <a class="code" href="group__util.html#g9cd013bb193de5048149afeb9d94e424"
title=
"Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(netsnmp_table_data_set_storage);
<a name="l00277" id="l00277"></a>00277     <span class="keywordflow">if</span> (new_col == NULL)
<a name="l00278" id="l00278"></a>00278         <span class="keywordflow">return</span> SNMPERR_GENERR;
<a name="l00279" id="l00279"></a>00279     new_col-&gt;type = type;
<a name="l00280" id="l00280"></a>00280     new_col-&gt;writable = writable;
<a name="l00281" id="l00281"></a>00281     new_col-&gt;column = column;
<a name="l00282" id="l00282"></a>00282     <span class="keywordflow">if</span> (default_value) {
<a name="l00283" id="l00283"></a>00283         <a class="code" href="group__util.html#ge28321822c83004ae8eedcc3de2b2fde" title=
"Duplicates a memory block.">memdup</a>((u_char **) &amp; (new_col-&gt;data.voidp),
<a name="l00284" id="l00284"></a>00284                (u_char *) default_value, default_value_len);
<a name="l00285" id="l00285"></a>00285         new_col-&gt;data_len = default_value_len;
<a name="l00286" id="l00286"></a>00286     }
<a name="l00287" id="l00287"></a>00287     <span class="keywordflow">if</span> (table_set-&gt;default_row == NULL)
<a name="l00288" id="l00288"></a>00288         table_set-&gt;default_row = new_col;
<a name="l00289" id="l00289"></a>00289     <span class="keywordflow">else</span> {
<a name="l00290" id="l00290"></a>00290         <span class=
"comment">/* sort in order just because (needed for add_row support) */</span>
<a name="l00291" id="l00291"></a>00291         <span class=
"keywordflow">for</span> (ptr = table_set-&gt;default_row, pptr = NULL;
<a name="l00292" id="l00292"></a>00292              ptr;
<a name="l00293" id="l00293"></a>00293              pptr = ptr, ptr = ptr-&gt;next) {
<a name="l00294" id="l00294"></a>00294             <span class="keywordflow">if</span> (ptr-&gt;column &gt; column) {
<a name="l00295" id="l00295"></a>00295                 new_col-&gt;next = ptr;
<a name="l00296" id="l00296"></a>00296                 <span class="keywordflow">if</span> (pptr)
<a name="l00297" id="l00297"></a>00297                     pptr-&gt;next = new_col;
<a name="l00298" id="l00298"></a>00298                 <span class="keywordflow">else</span>
<a name="l00299" id="l00299"></a>00299                     table_set-&gt;default_row = new_col;
<a name="l00300" id="l00300"></a>00300                 <span class="keywordflow">return</span> SNMPERR_SUCCESS;
<a name="l00301" id="l00301"></a>00301             }
<a name="l00302" id="l00302"></a>00302         }
<a name="l00303" id="l00303"></a>00303         <span class="keywordflow">if</span> (pptr)
<a name="l00304" id="l00304"></a>00304             pptr-&gt;next = new_col;
<a name="l00305" id="l00305"></a>00305         <span class="keywordflow">else</span>
<a name="l00306" id="l00306"></a>00306             <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_ERR,<span class=
"stringliteral">"Shouldn't have gotten here: table_dataset/add_row"</span>);
<a name="l00307" id="l00307"></a>00307     }
<a name="l00308" id="l00308"></a>00308     <span class="keywordflow">return</span> SNMPERR_SUCCESS;
<a name="l00309" id="l00309"></a>00309 }
<a name="l00310" id="l00310"></a>00310 
<a name="l00315" id="l00315"></a>00315 <span class="keywordtype">void</span>
<a name="l00316" id="l00316"></a><a class="code" href=
"group__table__dataset.html#g26ffb5722ae066cfbcfe1f0f37bc072e">00316</a> <a class="code" href=
"group__table__dataset.html#g26ffb5722ae066cfbcfe1f0f37bc072e" title=
"adds multiple data column definitions to each row.">netsnmp_table_set_multi_add_default_row</a>(netsnmp_table_data_set *tset, ...)
<a name="l00317" id="l00317"></a>00317 {
<a name="l00318" id="l00318"></a>00318     va_list         debugargs;
<a name="l00319" id="l00319"></a>00319     <span class="keywordtype">unsigned</span> <span class=
"keywordtype">int</span>    column;
<a name="l00320" id="l00320"></a>00320     <span class="keywordtype">int</span>             type, writable;
<a name="l00321" id="l00321"></a>00321     <span class="keywordtype">void</span>           *data;
<a name="l00322" id="l00322"></a>00322     <span class="keywordtype">size_t</span>          data_len;
<a name="l00323" id="l00323"></a>00323 
<a name="l00324" id="l00324"></a>00324     va_start(debugargs, tset);
<a name="l00325" id="l00325"></a>00325 
<a name="l00326" id="l00326"></a>00326     <span class="keywordflow">while</span> ((column = va_arg(debugargs, <span class=
"keywordtype">unsigned</span> <span class="keywordtype">int</span>)) != 0) {
<a name="l00327" id="l00327"></a>00327         type = va_arg(debugargs, <span class="keywordtype">int</span>);
<a name="l00328" id="l00328"></a>00328         writable = va_arg(debugargs, <span class="keywordtype">int</span>);
<a name="l00329" id="l00329"></a>00329         data = va_arg(debugargs, <span class="keywordtype">void</span> *);
<a name="l00330" id="l00330"></a>00330         data_len = va_arg(debugargs, <span class="keywordtype">size_t</span>);
<a name="l00331" id="l00331"></a>00331         <a class="code" href=
"group__table__dataset.html#g856fae0cafd9c19a1d856ad6f892c13e" title=
"adds a new default row to a table_set.">netsnmp_table_set_add_default_row</a>(tset, column, type, writable,
<a name="l00332" id="l00332"></a>00332                                           data, data_len);
<a name="l00333" id="l00333"></a>00333     }
<a name="l00334" id="l00334"></a>00334 
<a name="l00335" id="l00335"></a>00335     va_end(debugargs);
<a name="l00336" id="l00336"></a>00336 }
<a name="l00337" id="l00337"></a>00337 
<a name="l00338" id="l00338"></a>00338 
<a name="l00339" id="l00339"></a>00339 <span class="comment">/* ==================================</span>
<a name="l00340" id="l00340"></a>00340 <span class="comment"> *</span>
<a name="l00341" id="l00341"></a>00341 <span class="comment"> * Data Set API: MIB maintenance</span>
<a name="l00342" id="l00342"></a>00342 <span class="comment"> *</span>
<a name="l00343" id="l00343"></a>00343 <span class="comment"> * ================================== */</span>
<a name="l00344" id="l00344"></a>00344 
<a name="l00346" id="l00346"></a>00346 <a class="code" href="structnetsnmp__mib__handler__s.html" title=
"the mib handler structure to be registered">netsnmp_mib_handler</a> *
<a name="l00347" id="l00347"></a><a class="code" href=
"group__table__dataset.html#gd3e939f5e63b3ba7de4eb86f99915fca">00347</a> <a class="code" href=
"group__table__dataset.html#gd3e939f5e63b3ba7de4eb86f99915fca" title=
"Given a netsnmp_table_data_set definition, create a handler for it.">netsnmp_get_table_data_set_handler</a>(netsnmp_table_data_set *data_set)
<a name="l00348" id="l00348"></a>00348 {
<a name="l00349" id="l00349"></a>00349     <a class="code" href="structnetsnmp__mib__handler__s.html" title=
"the mib handler structure to be registered">netsnmp_mib_handler</a> *ret = NULL;
<a name="l00350" id="l00350"></a>00350 
<a name="l00351" id="l00351"></a>00351     <span class="keywordflow">if</span> (!data_set) {
<a name="l00352" id="l00352"></a>00352         <a class="code" href="group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2"
title="This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_INFO,
<a name="l00353" id="l00353"></a>00353                  <span class=
"stringliteral">"netsnmp_get_table_data_set_handler(NULL) called\n"</span>);
<a name="l00354" id="l00354"></a>00354         <span class="keywordflow">return</span> NULL;
<a name="l00355" id="l00355"></a>00355     }
<a name="l00356" id="l00356"></a>00356 
<a name="l00357" id="l00357"></a>00357     ret =
<a name="l00358" id="l00358"></a>00358         <a class="code" href="group__handler.html#g169c1653d481ed3d7df0c1795d99ca0c"
title="creates a netsnmp_mib_handler structure given a name and a access method.">netsnmp_create_handler</a>(TABLE_DATA_SET_NAME,
<a name="l00359" id="l00359"></a>00359                                netsnmp_table_data_set_helper_handler);
<a name="l00360" id="l00360"></a>00360     <span class="keywordflow">if</span> (ret) {
<a name="l00361" id="l00361"></a>00361         ret-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#320fa53cc0c6edac56c54d6dcf17dfe9" title=
"for agent_handler&amp;#39;s internal use">flags</a> |= MIB_HANDLER_AUTO_NEXT;
<a name="l00362" id="l00362"></a>00362         ret-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#74067d02cea4a059cd0fce7790b77b18" title=
"for handler&amp;#39;s internal use">myvoid</a> = (<span class="keywordtype">void</span> *) data_set;
<a name="l00363" id="l00363"></a>00363     }
<a name="l00364" id="l00364"></a>00364     <span class="keywordflow">return</span> ret;
<a name="l00365" id="l00365"></a>00365 }
<a name="l00366" id="l00366"></a>00366 
<a name="l00372" id="l00372"></a>00372 <span class="keywordtype">int</span>
<a name="l00373" id="l00373"></a><a class="code" href=
"group__table__dataset.html#gc3daf62b5ff07dd03bc5b993e93ab103">00373</a> <a class="code" href=
"group__table__dataset.html#gc3daf62b5ff07dd03bc5b993e93ab103" title=
"register a given data_set at a given oid (specified in the netsnmp_handler_registration...">netsnmp_register_table_data_set</a>(<a class="code"
href="structnetsnmp__handler__registration__s.html" title="Root registration info.">netsnmp_handler_registration</a> *reginfo,
<a name="l00374" id="l00374"></a>00374                                 netsnmp_table_data_set *data_set,
<a name="l00375" id="l00375"></a>00375                                 <a class="code" href=
"structnetsnmp__table__registration__info__s.html" title=
"Table registration structure.">netsnmp_table_registration_info</a> *table_info)
<a name="l00376" id="l00376"></a>00376 {
<a name="l00377" id="l00377"></a>00377     <span class="keywordflow">if</span> (NULL == table_info) {
<a name="l00378" id="l00378"></a>00378         <span class="comment">/*</span>
<a name="l00379" id="l00379"></a>00379 <span class="comment">         * allocate the table if one wasn't allocated </span>
<a name="l00380" id="l00380"></a>00380 <span class="comment">         */</span>
<a name="l00381" id="l00381"></a>00381         table_info = <a class="code" href=
"group__util.html#g9cd013bb193de5048149afeb9d94e424" title=
"Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(<a class="code" href=
"structnetsnmp__table__registration__info__s.html" title="Table registration structure.">netsnmp_table_registration_info</a>);
<a name="l00382" id="l00382"></a>00382         <span class="keywordflow">if</span> (table_info == NULL)
<a name="l00383" id="l00383"></a>00383             <span class="keywordflow">return</span> SNMP_ERR_GENERR;
<a name="l00384" id="l00384"></a>00384     }
<a name="l00385" id="l00385"></a>00385 
<a name="l00386" id="l00386"></a>00386     <span class="keywordflow">if</span> (NULL == table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#3045fe8e402e974d840af4084b88dc2a" title=
"list of varbinds with only &amp;#39;type&amp;#39; set">indexes</a> &amp;&amp; data_set-&gt;table-&gt;indexes_template) {
<a name="l00387" id="l00387"></a>00387         <span class="comment">/*</span>
<a name="l00388" id="l00388"></a>00388 <span class="comment">         * copy the indexes in </span>
<a name="l00389" id="l00389"></a>00389 <span class="comment">         */</span>
<a name="l00390" id="l00390"></a>00390         table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#3045fe8e402e974d840af4084b88dc2a" title=
"list of varbinds with only &amp;#39;type&amp;#39; set">indexes</a> =
<a name="l00391" id="l00391"></a>00391             snmp_clone_varbind(data_set-&gt;table-&gt;indexes_template);
<a name="l00392" id="l00392"></a>00392     }
<a name="l00393" id="l00393"></a>00393 
<a name="l00394" id="l00394"></a>00394     <span class="keywordflow">if</span> ((!table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#e48fd51376f573a4c4e5aede809f7092" title=
"the minimum columns number.">min_column</a> || !table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#4b7f37faafced959b943e974ba58e008" title=
"the maximum columns number">max_column</a>) &amp;&amp;
<a name="l00395" id="l00395"></a>00395         (data_set-&gt;default_row)) {
<a name="l00396" id="l00396"></a>00396         <span class="comment">/*</span>
<a name="l00397" id="l00397"></a>00397 <span class="comment">         * determine min/max columns </span>
<a name="l00398" id="l00398"></a>00398 <span class="comment">         */</span>
<a name="l00399" id="l00399"></a>00399         <span class="keywordtype">unsigned</span> <span class=
"keywordtype">int</span>    mincol = 0xffffffff, maxcol = 0;
<a name="l00400" id="l00400"></a>00400         netsnmp_table_data_set_storage *row;
<a name="l00401" id="l00401"></a>00401 
<a name="l00402" id="l00402"></a>00402         <span class=
"keywordflow">for</span> (row = data_set-&gt;default_row; row; row = row-&gt;next) {
<a name="l00403" id="l00403"></a>00403             mincol = <a class="code" href=
"group__util.html#gd1976dec11cfd62abaa4ecedad948f18" title=
"Computers the minimum of a and b.">SNMP_MIN</a>(mincol, row-&gt;column);
<a name="l00404" id="l00404"></a>00404             maxcol = <a class="code" href=
"group__util.html#ga70d7b83d1001df95cf64280e9545564" title=
"Computers the maximum of a and b.">SNMP_MAX</a>(maxcol, row-&gt;column);
<a name="l00405" id="l00405"></a>00405         }
<a name="l00406" id="l00406"></a>00406         <span class="keywordflow">if</span> (!table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#e48fd51376f573a4c4e5aede809f7092" title=
"the minimum columns number.">min_column</a>)
<a name="l00407" id="l00407"></a>00407             table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#e48fd51376f573a4c4e5aede809f7092" title=
"the minimum columns number.">min_column</a> = mincol;
<a name="l00408" id="l00408"></a>00408         <span class="keywordflow">if</span> (!table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#4b7f37faafced959b943e974ba58e008" title=
"the maximum columns number">max_column</a>)
<a name="l00409" id="l00409"></a>00409             table_info-&gt;<a class="code" href=
"structnetsnmp__table__registration__info__s.html#4b7f37faafced959b943e974ba58e008" title=
"the maximum columns number">max_column</a> = maxcol;
<a name="l00410" id="l00410"></a>00410     }
<a name="l00411" id="l00411"></a>00411 
<a name="l00412" id="l00412"></a>00412     <a class="code" href="group__handler.html#g6649d75b3eaf98d70704754d3d8235f3" title=
"inject a new handler into the calling chain of the handlers definedy by the netsnmp_handler_registra...">netsnmp_inject_handler</a>(reginfo,
<a name="l00413" id="l00413"></a>00413                            <a class="code" href=
"group__table__dataset.html#gd3e939f5e63b3ba7de4eb86f99915fca" title=
"Given a netsnmp_table_data_set definition, create a handler for it.">netsnmp_get_table_data_set_handler</a>(data_set));
<a name="l00414" id="l00414"></a>00414     <span class="keywordflow">return</span> <a class="code" href=
"group__table__data.html#g9c5f1d84e2c7f625e786667a2ef1f0b5" title=
"registers a handler as a data table.">netsnmp_register_table_data</a>(reginfo, data_set-&gt;table,
<a name="l00415" id="l00415"></a>00415                                        table_info);
<a name="l00416" id="l00416"></a>00416 }
<a name="l00417" id="l00417"></a>00417 
<a name="l00418" id="l00418"></a>00418 newrow_stash   *
<a name="l00419" id="l00419"></a>00419 netsnmp_table_data_set_create_newrowstash
<a name="l00420" id="l00420"></a>00420     (netsnmp_table_data_set     *datatable,
<a name="l00421" id="l00421"></a>00421      <a class="code" href="structnetsnmp__table__request__info__s.html" title=
"The table request info structure.">netsnmp_table_request_info</a> *table_info)
<a name="l00422" id="l00422"></a>00422 {
<a name="l00423" id="l00423"></a>00423     newrow_stash   *newrowstash = NULL;
<a name="l00424" id="l00424"></a>00424     netsnmp_table_row *newrow   = NULL;
<a name="l00425" id="l00425"></a>00425 
<a name="l00426" id="l00426"></a>00426     newrowstash = <a class="code" href=
"group__util.html#g9cd013bb193de5048149afeb9d94e424" title=
"Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(newrow_stash);
<a name="l00427" id="l00427"></a>00427 
<a name="l00428" id="l00428"></a>00428     <span class="keywordflow">if</span> (newrowstash != NULL) {
<a name="l00429" id="l00429"></a>00429         newrowstash-&gt;created = 1;
<a name="l00430" id="l00430"></a>00430         newrow = <a class="code" href=
"group__table__dataset.html#g360c4b8ffc98b495e195f987d39a69d2" title=
"creates a new row from an existing defined default set">netsnmp_table_data_set_create_row_from_defaults</a>
<a name="l00431" id="l00431"></a>00431             (datatable-&gt;default_row);
<a name="l00432" id="l00432"></a>00432         newrow-&gt;indexes = snmp_clone_varbind(table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#585f93b117d282e0c857e7b3670f85af" title=
"contents freed by helper upon exit">indexes</a>);
<a name="l00433" id="l00433"></a>00433         newrowstash-&gt;newrow = newrow;
<a name="l00434" id="l00434"></a>00434     }
<a name="l00435" id="l00435"></a>00435 
<a name="l00436" id="l00436"></a>00436     <span class="keywordflow">return</span> newrowstash;
<a name="l00437" id="l00437"></a>00437 }
<a name="l00438" id="l00438"></a>00438 
<a name="l00439" id="l00439"></a>00439 <span class=
"comment">/* implements the table data helper.  This is the routine that takes</span>
<a name="l00440" id="l00440"></a>00440 <span class="comment"> *  care of all SNMP requests coming into the table. */</span>
<a name="l00441" id="l00441"></a>00441 <span class="keywordtype">int</span>
<a name="l00442" id="l00442"></a>00442 netsnmp_table_data_set_helper_handler(<a class="code" href=
"structnetsnmp__mib__handler__s.html" title="the mib handler structure to be registered">netsnmp_mib_handler</a> *handler,
<a name="l00443" id="l00443"></a>00443                                       <a class="code" href=
"structnetsnmp__handler__registration__s.html" title="Root registration info.">netsnmp_handler_registration</a>
<a name="l00444" id="l00444"></a>00444                                       *reginfo,
<a name="l00445" id="l00445"></a>00445                                       <a class="code" href=
"structnetsnmp__agent__request__info__s.html" title=
"The agent transaction request structure.">netsnmp_agent_request_info</a> *reqinfo,
<a name="l00446" id="l00446"></a>00446                                       <a class="code" href=
"structnetsnmp__request__info__s.html" title="The netsnmp request info structure.">netsnmp_request_info</a> *requests)
<a name="l00447" id="l00447"></a>00447 {
<a name="l00448" id="l00448"></a>00448     netsnmp_table_data_set_storage *data = NULL;
<a name="l00449" id="l00449"></a>00449     newrow_stash   *newrowstash = NULL;
<a name="l00450" id="l00450"></a>00450     netsnmp_table_row *row, *newrow = NULL;
<a name="l00451" id="l00451"></a>00451     <a class="code" href="structnetsnmp__table__request__info__s.html" title=
"The table request info structure.">netsnmp_table_request_info</a> *table_info;
<a name="l00452" id="l00452"></a>00452     <a class="code" href="structnetsnmp__request__info__s.html" title=
"The netsnmp request info structure.">netsnmp_request_info</a> *request;
<a name="l00453" id="l00453"></a>00453     netsnmp_oid_stash_node **stashp = NULL;
<a name="l00454" id="l00454"></a>00454 
<a name="l00455" id="l00455"></a>00455     <span class="keywordflow">if</span> (!handler)
<a name="l00456" id="l00456"></a>00456         <span class="keywordflow">return</span> SNMPERR_GENERR;
<a name="l00457" id="l00457"></a>00457         
<a name="l00458" id="l00458"></a>00458     DEBUGMSGTL((<span class="stringliteral">"netsnmp_table_data_set"</span>, <span class=
"stringliteral">"handler starting\n"</span>));
<a name="l00459" id="l00459"></a>00459     <span class=
"keywordflow">for</span> (request = requests; request; request = request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#13370798dcabf32289599250f1b91e6f">next</a>) {
<a name="l00460" id="l00460"></a>00460         netsnmp_table_data_set *datatable =
<a name="l00461" id="l00461"></a>00461             (netsnmp_table_data_set *) handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#74067d02cea4a059cd0fce7790b77b18" title="for handler&amp;#39;s internal use">myvoid</a>;
<a name="l00462" id="l00462"></a>00462         <span class="keyword">const</span> oid * <span class=
"keyword">const</span> suffix =
<a name="l00463" id="l00463"></a>00463             requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title="variable bindings">requestvb</a>-&gt;<a class=
"code" href="structvariable__list.html#7b5bdda01921550d24ea53033ce76146" title=
"Object identifier of variable.">name</a> + reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#093f0b5b2e79f8be1c90f821d4aad50b">rootoid_len</a> + 2;
<a name="l00464" id="l00464"></a>00464         <span class="keyword">const</span> <span class=
"keywordtype">size_t</span> suffix_len =
<a name="l00465" id="l00465"></a>00465             requests-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title="variable bindings">requestvb</a>-&gt;<a class=
"code" href="structvariable__list.html#089e5b1a422bf8e693510ff5408a57a7" title=
"number of subid&amp;#39;s in name">name_length</a> - (reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#093f0b5b2e79f8be1c90f821d4aad50b">rootoid_len</a> + 2);
<a name="l00466" id="l00466"></a>00466 
<a name="l00467" id="l00467"></a>00467         <span class="keywordflow">if</span> (request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#571c8d51fefe1fa86df9dcfb5c169a7d">processed</a>)
<a name="l00468" id="l00468"></a>00468             <span class="keywordflow">continue</span>;
<a name="l00469" id="l00469"></a>00469 
<a name="l00470" id="l00470"></a>00470         <span class="comment">/*</span>
<a name="l00471" id="l00471"></a>00471 <span class="comment">         * extract our stored data and table info </span>
<a name="l00472" id="l00472"></a>00472 <span class="comment">         */</span>
<a name="l00473" id="l00473"></a>00473         row = <a class="code" href=
"group__table__data.html#g0fae612cdbaef2df9006cc01a0c22c57" title=
"extracts the row being accessed passed from the table_data helper">netsnmp_extract_table_row</a>(request);
<a name="l00474" id="l00474"></a>00474         table_info = <a class="code" href=
"group__table.html#g0f2aa788814b909e3e3003b63b1dbd3a" title=
"Extracts the processed table information from a given request.">netsnmp_extract_table_info</a>(request);
<a name="l00475" id="l00475"></a>00475 
<a name="l00476" id="l00476"></a>00476         <span class="keywordflow">if</span> (MODE_IS_SET(reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#b6b03348cb57228f8d29c3281add02d8">mode</a>)) {
<a name="l00477" id="l00477"></a>00477 
<a name="l00478" id="l00478"></a>00478             <span class="keywordtype">char</span> buf[256]; <span class=
"comment">/* is this reasonable size?? */</span>
<a name="l00479" id="l00479"></a>00479             <span class="keywordtype">int</span>  rc;
<a name="l00480" id="l00480"></a>00480             <span class="keywordtype">size_t</span> len;
<a name="l00481" id="l00481"></a>00481 
<a name="l00482" id="l00482"></a>00482             <span class="comment">/*</span>
<a name="l00483" id="l00483"></a>00483 <span class="comment">             * use a cached copy of the row for modification </span>
<a name="l00484" id="l00484"></a>00484 <span class="comment">             */</span>
<a name="l00485" id="l00485"></a>00485 
<a name="l00486" id="l00486"></a>00486             <span class="comment">/*</span>
<a name="l00487" id="l00487"></a>00487 <span class=
"comment">             * cache location: may have been created already by other</span>
<a name="l00488" id="l00488"></a>00488 <span class="comment">             * SET requests in the same master request. </span>
<a name="l00489" id="l00489"></a>00489 <span class="comment">             */</span>
<a name="l00490" id="l00490"></a>00490             rc = snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class=
"stringliteral">"dataset_row_stash:%s:"</span>,
<a name="l00491" id="l00491"></a>00491                           datatable-&gt;table-&gt;name);
<a name="l00492" id="l00492"></a>00492             <span class="keywordflow">if</span> ((-1 == rc) || (rc &gt;= <span class=
"keyword">sizeof</span>(buf))) {
<a name="l00493" id="l00493"></a>00493                 <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_ERR,<span class=
"stringliteral">"%s handler name too long\n"</span>,
<a name="l00494" id="l00494"></a>00494                          datatable-&gt;table-&gt;name);
<a name="l00495" id="l00495"></a>00495                 <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00496" id="l00496"></a>00496                                           SNMP_ERR_GENERR);
<a name="l00497" id="l00497"></a>00497                 <span class="keywordflow">continue</span>;
<a name="l00498" id="l00498"></a>00498             }
<a name="l00499" id="l00499"></a>00499             len = <span class="keyword">sizeof</span>(buf) - rc;
<a name="l00500" id="l00500"></a>00500             rc = snprint_objid(&amp;buf[rc], len, table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#5b34351a0c9d62016682e2234a6ce52e">index_oid</a>,
<a name="l00501" id="l00501"></a>00501                                table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#ffd15d51f8aaf73ea587761b4a87e184">index_oid_len</a>);
<a name="l00502" id="l00502"></a>00502             <span class="keywordflow">if</span> (-1 == rc) {
<a name="l00503" id="l00503"></a>00503                 <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_ERR,<span class=
"stringliteral">"%s oid or name too long\n"</span>,
<a name="l00504" id="l00504"></a>00504                          datatable-&gt;table-&gt;name);
<a name="l00505" id="l00505"></a>00505                 <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00506" id="l00506"></a>00506                                           SNMP_ERR_GENERR);
<a name="l00507" id="l00507"></a>00507                 <span class="keywordflow">continue</span>;
<a name="l00508" id="l00508"></a>00508             }
<a name="l00509" id="l00509"></a>00509             stashp = (netsnmp_oid_stash_node **)
<a name="l00510" id="l00510"></a>00510                 netsnmp_table_get_or_create_row_stash(reqinfo, buf);
<a name="l00511" id="l00511"></a>00511 
<a name="l00512" id="l00512"></a>00512             newrowstash
<a name="l00513" id="l00513"></a>00513                 = <a class="code" href=
"group__oid__stash.html#g0e10dfa723e95153374b3b87f5a73934" title=
"returns a data pointer associated with a given OID.">netsnmp_oid_stash_get_data</a>(*stashp, suffix, suffix_len);
<a name="l00514" id="l00514"></a>00514 
<a name="l00515" id="l00515"></a>00515             <span class="keywordflow">if</span> (!newrowstash) {
<a name="l00516" id="l00516"></a>00516                 <span class="keywordflow">if</span> (!row) {
<a name="l00517" id="l00517"></a>00517                     <span class="keywordflow">if</span> (datatable-&gt;allow_creation) {
<a name="l00518" id="l00518"></a>00518                         <span class="comment">/*</span>
<a name="l00519" id="l00519"></a>00519 <span class=
"comment">                         * entirely new row.  Create the row from the template </span>
<a name="l00520" id="l00520"></a>00520 <span class="comment">                         */</span>
<a name="l00521" id="l00521"></a>00521                         newrowstash =
<a name="l00522" id="l00522"></a>00522                              netsnmp_table_data_set_create_newrowstash(
<a name="l00523" id="l00523"></a>00523                                                  datatable, table_info);
<a name="l00524" id="l00524"></a>00524                         newrow = newrowstash-&gt;newrow;
<a name="l00525" id="l00525"></a>00525                     } <span class="keywordflow">else</span> <span class=
"keywordflow">if</span> (datatable-&gt;rowstatus_column == 0) {
<a name="l00526" id="l00526"></a>00526                         <span class="comment">/*</span>
<a name="l00527" id="l00527"></a>00527 <span class=
"comment">                         * A RowStatus object may be used to control the</span>
<a name="l00528" id="l00528"></a>00528 <span class=
"comment">                         *  creation of a new row.  But if this object</span>
<a name="l00529" id="l00529"></a>00529 <span class=
"comment">                         *  isn't declared (and the table isn't marked as</span>
<a name="l00530" id="l00530"></a>00530 <span class=
"comment">                         *  'auto-create'), then we can't create a new row.</span>
<a name="l00531" id="l00531"></a>00531 <span class="comment">                         */</span>
<a name="l00532" id="l00532"></a>00532                         <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00533" id="l00533"></a>00533                                                   SNMP_ERR_NOCREATION);
<a name="l00534" id="l00534"></a>00534                         <span class="keywordflow">continue</span>;
<a name="l00535" id="l00535"></a>00535                     }
<a name="l00536" id="l00536"></a>00536                 } <span class="keywordflow">else</span> {
<a name="l00537" id="l00537"></a>00537                     <span class="comment">/*</span>
<a name="l00538" id="l00538"></a>00538 <span class=
"comment">                     * existing row that needs to be modified </span>
<a name="l00539" id="l00539"></a>00539 <span class="comment">                     */</span>
<a name="l00540" id="l00540"></a>00540                     newrowstash = <a class="code" href=
"group__util.html#g9cd013bb193de5048149afeb9d94e424" title=
"Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(newrow_stash);
<a name="l00541" id="l00541"></a>00541                     <span class="keywordflow">if</span> (newrowstash == NULL) {
<a name="l00542" id="l00542"></a>00542                         <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00543" id="l00543"></a>00543                                                   SNMP_ERR_GENERR);
<a name="l00544" id="l00544"></a>00544                         <span class="keywordflow">continue</span>;
<a name="l00545" id="l00545"></a>00545                     }
<a name="l00546" id="l00546"></a>00546                     newrow = <a class="code" href=
"group__table__dataset.html#g28d4cc5c7b860b9f77725572986e081b" title=
"clones a dataset row, including all data.">netsnmp_table_data_set_clone_row</a>(row);
<a name="l00547" id="l00547"></a>00547                     newrowstash-&gt;newrow = newrow;
<a name="l00548" id="l00548"></a>00548                 }
<a name="l00549" id="l00549"></a>00549                 <a class="code" href=
"group__oid__stash.html#g550530ef9aa07c3b1ae1c362b54d52ab" title=
"adds data to the stash at a given oid.">netsnmp_oid_stash_add_data</a>(stashp, suffix, suffix_len,
<a name="l00550" id="l00550"></a>00550                                            newrowstash);
<a name="l00551" id="l00551"></a>00551             } <span class="keywordflow">else</span> {
<a name="l00552" id="l00552"></a>00552                 newrow = newrowstash-&gt;newrow;
<a name="l00553" id="l00553"></a>00553             }
<a name="l00554" id="l00554"></a>00554             <span class="comment">/*</span>
<a name="l00555" id="l00555"></a>00555 <span class=
"comment">             * all future SET data modification operations use this</span>
<a name="l00556" id="l00556"></a>00556 <span class="comment">             * temp pointer </span>
<a name="l00557" id="l00557"></a>00557 <span class="comment">             */</span>
<a name="l00558" id="l00558"></a>00558             <span class="keywordflow">if</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#b6b03348cb57228f8d29c3281add02d8">mode</a> == MODE_SET_RESERVE1 ||
<a name="l00559" id="l00559"></a>00559                 reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#b6b03348cb57228f8d29c3281add02d8">mode</a> == MODE_SET_RESERVE2)
<a name="l00560" id="l00560"></a>00560                 row = newrow;
<a name="l00561" id="l00561"></a>00561         }
<a name="l00562" id="l00562"></a>00562 
<a name="l00563" id="l00563"></a>00563         <span class="keywordflow">if</span> (row)
<a name="l00564" id="l00564"></a>00564             data = (netsnmp_table_data_set_storage *) row-&gt;data;
<a name="l00565" id="l00565"></a>00565 
<a name="l00566" id="l00566"></a>00566         if (!row || !table_info || !data) {
<a name="l00567" id="l00567"></a>00567             <span class="keywordflow">if</span> (!MODE_IS_SET(reqinfo-&gt;<a class="code"
href="structnetsnmp__agent__request__info__s.html#b6b03348cb57228f8d29c3281add02d8">mode</a>) || !table_info) {
<a name="l00568" id="l00568"></a>00568                 <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00569" id="l00569"></a>00569                                           SNMP_NOSUCHINSTANCE);
<a name="l00570" id="l00570"></a>00570                 <span class="keywordflow">continue</span>;
<a name="l00571" id="l00571"></a>00571             }
<a name="l00572" id="l00572"></a>00572         }
<a name="l00573" id="l00573"></a>00573 
<a name="l00574" id="l00574"></a>00574         data =
<a name="l00575" id="l00575"></a>00575             <a class="code" href=
"group__table__dataset.html#g415b0d8045da228d63325800cc6af88d" title=
"Finds a column within a given storage set, given the pointer to the start of the...">netsnmp_table_data_set_find_column</a>(data, table_info-&gt;<a class="code"
href="structnetsnmp__table__request__info__s.html#fbed55ce9b6c75a98fafc84559462b34" title="0 if OID not long enough">colnum</a>);
<a name="l00576" id="l00576"></a>00576 
<a name="l00577" id="l00577"></a>00577         <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#b6b03348cb57228f8d29c3281add02d8">mode</a>) {
<a name="l00578" id="l00578"></a>00578         <span class="keywordflow">case</span> MODE_GET:
<a name="l00579" id="l00579"></a>00579         <span class="keywordflow">case</span> MODE_GETNEXT:
<a name="l00580" id="l00580"></a>00580         <span class="keywordflow">case</span> MODE_GETBULK:     <span class=
"comment">/* XXXWWW */</span>
<a name="l00581" id="l00581"></a>00581             <span class="keywordflow">if</span> (data &amp;&amp; data-&gt;data.voidp)
<a name="l00582" id="l00582"></a>00582                 netsnmp_table_data_build_result(reginfo, reqinfo, request,
<a name="l00583" id="l00583"></a>00583                                                 row,
<a name="l00584" id="l00584"></a>00584                                                 table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#fbed55ce9b6c75a98fafc84559462b34" title="0 if OID not long enough">colnum</a>,
<a name="l00585" id="l00585"></a>00585                                                 data-&gt;type,
<a name="l00586" id="l00586"></a>00586                                                 data-&gt;data.voidp,
<a name="l00587" id="l00587"></a>00587                                                 data-&gt;data_len);
<a name="l00588" id="l00588"></a>00588             <span class="keywordflow">break</span>;
<a name="l00589" id="l00589"></a>00589 
<a name="l00590" id="l00590"></a>00590         <span class="keywordflow">case</span> MODE_SET_RESERVE1:
<a name="l00591" id="l00591"></a>00591             <span class="keywordflow">if</span> (data) {
<a name="l00592" id="l00592"></a>00592                 <span class="comment">/*</span>
<a name="l00593" id="l00593"></a>00593 <span class="comment">                 * Can we modify the existing row?</span>
<a name="l00594" id="l00594"></a>00594 <span class="comment">                 */</span>
<a name="l00595" id="l00595"></a>00595                 <span class="keywordflow">if</span> (!data-&gt;writable) {
<a name="l00596" id="l00596"></a>00596                     <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00597" id="l00597"></a>00597                                               SNMP_ERR_NOTWRITABLE);
<a name="l00598" id="l00598"></a>00598                 } <span class="keywordflow">else</span> <span class=
"keywordflow">if</span> (request-&gt;<a class="code" href="structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f"
title="variable bindings">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#8bd719974b3554116631ea80dc88b6aa"
title="ASN type of variable.">type</a> != data-&gt;type) {
<a name="l00599" id="l00599"></a>00599                     <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00600" id="l00600"></a>00600                                               SNMP_ERR_WRONGTYPE);
<a name="l00601" id="l00601"></a>00601                 }
<a name="l00602" id="l00602"></a>00602             } <span class="keywordflow">else</span> <span class=
"keywordflow">if</span> (datatable-&gt;rowstatus_column == table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#fbed55ce9b6c75a98fafc84559462b34" title="0 if OID not long enough">colnum</a>) {
<a name="l00603" id="l00603"></a>00603                 <span class="comment">/*</span>
<a name="l00604" id="l00604"></a>00604 <span class=
"comment">                 * Otherwise, this is where we create a new row using</span>
<a name="l00605" id="l00605"></a>00605 <span class=
"comment">                 * the RowStatus object (essentially duplicating the</span>
<a name="l00606" id="l00606"></a>00606 <span class=
"comment">                 * steps followed earlier in the 'allow_creation' case)</span>
<a name="l00607" id="l00607"></a>00607 <span class="comment">                 */</span>
<a name="l00608" id="l00608"></a>00608                 <span class="keywordflow">switch</span> (*(request-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title=
"variable bindings">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#6ed7c00d712b83c174823b1cff6e9e29" title=
"value of variable">val</a>.integer)) {
<a name="l00609" id="l00609"></a>00609                 <span class="keywordflow">case</span> RS_CREATEANDGO:
<a name="l00610" id="l00610"></a>00610                 <span class="keywordflow">case</span> RS_CREATEANDWAIT:
<a name="l00611" id="l00611"></a>00611                     newrowstash =
<a name="l00612" id="l00612"></a>00612                              netsnmp_table_data_set_create_newrowstash(
<a name="l00613" id="l00613"></a>00613                                                  datatable, table_info);
<a name="l00614" id="l00614"></a>00614                     newrow = newrowstash-&gt;newrow;
<a name="l00615" id="l00615"></a>00615                     row    = newrow;
<a name="l00616" id="l00616"></a>00616                     <a class="code" href=
"group__oid__stash.html#g550530ef9aa07c3b1ae1c362b54d52ab" title=
"adds data to the stash at a given oid.">netsnmp_oid_stash_add_data</a>(stashp, suffix, suffix_len,
<a name="l00617" id="l00617"></a>00617                                                newrowstash);
<a name="l00618" id="l00618"></a>00618                 }
<a name="l00619" id="l00619"></a>00619             }
<a name="l00620" id="l00620"></a>00620             <span class="keywordflow">break</span>;
<a name="l00621" id="l00621"></a>00621 
<a name="l00622" id="l00622"></a>00622         <span class="keywordflow">case</span> MODE_SET_RESERVE2:
<a name="l00623" id="l00623"></a>00623             <span class="comment">/*</span>
<a name="l00624" id="l00624"></a>00624 <span class=
"comment">             * If the agent receives a SET request for an object in a non-existant</span>
<a name="l00625" id="l00625"></a>00625 <span class=
"comment">             *  row, then the RESERVE1 pass will create the row automatically.</span>
<a name="l00626" id="l00626"></a>00626 <span class="comment">             *</span>
<a name="l00627" id="l00627"></a>00627 <span class=
"comment">             * But since the row doesn't exist at that point, the test for whether</span>
<a name="l00628" id="l00628"></a>00628 <span class=
"comment">             *  the object is writable or not will be skipped.  So we need to check</span>
<a name="l00629" id="l00629"></a>00629 <span class="comment">             *  for this possibility again here.</span>
<a name="l00630" id="l00630"></a>00630 <span class="comment">             *</span>
<a name="l00631" id="l00631"></a>00631 <span class=
"comment">             * Similarly, if row creation is under the control of the RowStatus</span>
<a name="l00632" id="l00632"></a>00632 <span class=
"comment">             *  object (i.e. allow_creation == 0), but this particular request</span>
<a name="l00633" id="l00633"></a>00633 <span class=
"comment">             *  doesn't include such an object, then the row won't have been created,</span>
<a name="l00634" id="l00634"></a>00634 <span class=
"comment">             *  and the writable check will also have been skipped.  Again - check here.</span>
<a name="l00635" id="l00635"></a>00635 <span class="comment">             */</span>
<a name="l00636" id="l00636"></a>00636             <span class="keywordflow">if</span> (data &amp;&amp; data-&gt;writable == 0) {
<a name="l00637" id="l00637"></a>00637                 <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00638" id="l00638"></a>00638                                           SNMP_ERR_NOTWRITABLE);
<a name="l00639" id="l00639"></a>00639                 <span class="keywordflow">continue</span>;
<a name="l00640" id="l00640"></a>00640             }
<a name="l00641" id="l00641"></a>00641             <span class=
"keywordflow">if</span> (datatable-&gt;rowstatus_column == table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#fbed55ce9b6c75a98fafc84559462b34" title="0 if OID not long enough">colnum</a>) {
<a name="l00642" id="l00642"></a>00642                 <span class="keywordflow">switch</span> (*(request-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title=
"variable bindings">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#6ed7c00d712b83c174823b1cff6e9e29" title=
"value of variable">val</a>.integer)) {
<a name="l00643" id="l00643"></a>00643                 <span class="keywordflow">case</span> RS_ACTIVE:
<a name="l00644" id="l00644"></a>00644                 <span class="keywordflow">case</span> RS_NOTINSERVICE:
<a name="l00645" id="l00645"></a>00645                     <span class="comment">/*</span>
<a name="l00646" id="l00646"></a>00646 <span class="comment">                     * Can only operate on pre-existing rows.</span>
<a name="l00647" id="l00647"></a>00647 <span class="comment">                     */</span>
<a name="l00648" id="l00648"></a>00648                     <span class=
"keywordflow">if</span> (!newrowstash || newrowstash-&gt;created) {
<a name="l00649" id="l00649"></a>00649                         <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00650" id="l00650"></a>00650                                                   SNMP_ERR_INCONSISTENTVALUE);
<a name="l00651" id="l00651"></a>00651                         <span class="keywordflow">continue</span>;
<a name="l00652" id="l00652"></a>00652                     }
<a name="l00653" id="l00653"></a>00653                     <span class="keywordflow">break</span>;
<a name="l00654" id="l00654"></a>00654 
<a name="l00655" id="l00655"></a>00655                 <span class="keywordflow">case</span> RS_CREATEANDGO:
<a name="l00656" id="l00656"></a>00656                 <span class="keywordflow">case</span> RS_CREATEANDWAIT:
<a name="l00657" id="l00657"></a>00657                     <span class="comment">/*</span>
<a name="l00658" id="l00658"></a>00658 <span class=
"comment">                     * Can only operate on newly created rows.</span>
<a name="l00659" id="l00659"></a>00659 <span class="comment">                     */</span>
<a name="l00660" id="l00660"></a>00660                     <span class=
"keywordflow">if</span> (!(newrowstash &amp;&amp; newrowstash-&gt;created)) {
<a name="l00661" id="l00661"></a>00661                         <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00662" id="l00662"></a>00662                                                   SNMP_ERR_INCONSISTENTVALUE);
<a name="l00663" id="l00663"></a>00663                         <span class="keywordflow">continue</span>;
<a name="l00664" id="l00664"></a>00664                     }
<a name="l00665" id="l00665"></a>00665                     <span class="keywordflow">break</span>;
<a name="l00666" id="l00666"></a>00666 
<a name="l00667" id="l00667"></a>00667                 <span class="keywordflow">case</span> RS_DESTROY:
<a name="l00668" id="l00668"></a>00668                     <span class="comment">/*</span>
<a name="l00669" id="l00669"></a>00669 <span class=
"comment">                     * Can operate on new or pre-existing rows.</span>
<a name="l00670" id="l00670"></a>00670 <span class="comment">                     */</span>
<a name="l00671" id="l00671"></a>00671                     <span class="keywordflow">break</span>;
<a name="l00672" id="l00672"></a>00672 
<a name="l00673" id="l00673"></a>00673                 <span class="keywordflow">case</span> RS_NOTREADY:
<a name="l00674" id="l00674"></a>00674                 <span class="keywordflow">default</span>:
<a name="l00675" id="l00675"></a>00675                     <span class="comment">/*</span>
<a name="l00676" id="l00676"></a>00676 <span class="comment">                     * Not a valid value to Set </span>
<a name="l00677" id="l00677"></a>00677 <span class="comment">                     */</span>
<a name="l00678" id="l00678"></a>00678                     <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00679" id="l00679"></a>00679                                               SNMP_ERR_WRONGVALUE);
<a name="l00680" id="l00680"></a>00680                     <span class="keywordflow">continue</span>;
<a name="l00681" id="l00681"></a>00681                 }
<a name="l00682" id="l00682"></a>00682             }
<a name="l00683" id="l00683"></a>00683             <span class="keywordflow">if</span> (!data ) {
<a name="l00684" id="l00684"></a>00684                 <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, request,
<a name="l00685" id="l00685"></a>00685                                           SNMP_ERR_NOCREATION);
<a name="l00686" id="l00686"></a>00686                 <span class="keywordflow">continue</span>;
<a name="l00687" id="l00687"></a>00687             }
<a name="l00688" id="l00688"></a>00688 
<a name="l00689" id="l00689"></a>00689             <span class="comment">/*</span>
<a name="l00690" id="l00690"></a>00690 <span class="comment">             * modify row and set new value </span>
<a name="l00691" id="l00691"></a>00691 <span class="comment">             */</span>
<a name="l00692" id="l00692"></a>00692             <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6"
title="Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a>(data-&gt;data.string);
<a name="l00693" id="l00693"></a>00693             data-&gt;data.string =
<a name="l00694" id="l00694"></a>00694                 <a class="code" href="group__util.html#g06867ff53bb86b745f23c52aa5e78829"
title=
"copies a (possible) unterminated string of a given length into a new buffer and null...">netsnmp_strdup_and_null</a>(request-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title=
"variable bindings">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#6ed7c00d712b83c174823b1cff6e9e29" title=
"value of variable">val</a>.string,
<a name="l00695" id="l00695"></a>00695                                         request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title="variable bindings">requestvb</a>-&gt;<a class=
"code" href="structvariable__list.html#17aaa6b445178fc39aba69642247d3e9" title=
"the length of the value to be copied into buf">val_len</a>);
<a name="l00696" id="l00696"></a>00696             <span class="keywordflow">if</span> (!data-&gt;data.string) {
<a name="l00697" id="l00697"></a>00697                 <a class="code" href=
"group__snmp__agent.html#gc0668f1fd9036ebc88a734d9d4a6a59b" title=
"set error for a request">netsnmp_set_request_error</a>(reqinfo, requests,
<a name="l00698" id="l00698"></a>00698                                           SNMP_ERR_RESOURCEUNAVAILABLE);
<a name="l00699" id="l00699"></a>00699             }
<a name="l00700" id="l00700"></a>00700             data-&gt;data_len = request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title="variable bindings">requestvb</a>-&gt;<a class=
"code" href="structvariable__list.html#17aaa6b445178fc39aba69642247d3e9" title=
"the length of the value to be copied into buf">val_len</a>;
<a name="l00701" id="l00701"></a>00701 
<a name="l00702" id="l00702"></a>00702             <span class=
"keywordflow">if</span> (datatable-&gt;rowstatus_column == table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#fbed55ce9b6c75a98fafc84559462b34" title="0 if OID not long enough">colnum</a>) {
<a name="l00703" id="l00703"></a>00703                 <span class="keywordflow">switch</span> (*(request-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#455d87f6b7178fe19ea564c60c0ccb6f" title=
"variable bindings">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#6ed7c00d712b83c174823b1cff6e9e29" title=
"value of variable">val</a>.integer)) {
<a name="l00704" id="l00704"></a>00704                 <span class="keywordflow">case</span> RS_CREATEANDGO:
<a name="l00705" id="l00705"></a>00705                     <span class="comment">/*</span>
<a name="l00706" id="l00706"></a>00706 <span class="comment">                     * XXX: check legality </span>
<a name="l00707" id="l00707"></a>00707 <span class="comment">                     */</span>
<a name="l00708" id="l00708"></a>00708                     *(data-&gt;data.integer) = RS_ACTIVE;
<a name="l00709" id="l00709"></a>00709                     <span class="keywordflow">break</span>;
<a name="l00710" id="l00710"></a>00710 
<a name="l00711" id="l00711"></a>00711                 <span class="keywordflow">case</span> RS_CREATEANDWAIT:
<a name="l00712" id="l00712"></a>00712                     <span class="comment">/*</span>
<a name="l00713" id="l00713"></a>00713 <span class="comment">                     * XXX: check legality </span>
<a name="l00714" id="l00714"></a>00714 <span class="comment">                     */</span>
<a name="l00715" id="l00715"></a>00715                     *(data-&gt;data.integer) = RS_NOTINSERVICE;
<a name="l00716" id="l00716"></a>00716                     <span class="keywordflow">break</span>;
<a name="l00717" id="l00717"></a>00717 
<a name="l00718" id="l00718"></a>00718                 <span class="keywordflow">case</span> RS_DESTROY:
<a name="l00719" id="l00719"></a>00719                     newrowstash-&gt;deleted = 1;
<a name="l00720" id="l00720"></a>00720                     <span class="keywordflow">break</span>;
<a name="l00721" id="l00721"></a>00721                 }
<a name="l00722" id="l00722"></a>00722             }
<a name="l00723" id="l00723"></a>00723             <span class="keywordflow">break</span>;
<a name="l00724" id="l00724"></a>00724 
<a name="l00725" id="l00725"></a>00725         <span class="keywordflow">case</span> MODE_SET_ACTION:
<a name="l00726" id="l00726"></a>00726 
<a name="l00727" id="l00727"></a>00727             <span class="comment">/*</span>
<a name="l00728" id="l00728"></a>00728 <span class="comment">             * Install the new row into the stored table.</span>
<a name="l00729" id="l00729"></a>00729 <span class="comment">             * Do this only *once* per row ....</span>
<a name="l00730" id="l00730"></a>00730 <span class="comment">             */</span>
<a name="l00731" id="l00731"></a>00731             <span class="keywordflow">if</span> (newrowstash-&gt;state != STATE_ACTION) {
<a name="l00732" id="l00732"></a>00732                 newrowstash-&gt;state = STATE_ACTION;
<a name="l00733" id="l00733"></a>00733                 <span class="keywordflow">if</span> (newrowstash-&gt;created) {
<a name="l00734" id="l00734"></a>00734                     <a class="code" href=
"group__table__dataset.html#gcaa808db27144a4f967024bd7c9b6b25" title=
"adds a new row to a dataset table">netsnmp_table_dataset_add_row</a>(datatable, newrow);
<a name="l00735" id="l00735"></a>00735                 } <span class="keywordflow">else</span> {
<a name="l00736" id="l00736"></a>00736                     <a class="code" href=
"group__table__dataset.html#gbccec67ba904c7cda380ca95596317c0" title=
"adds a new row to a dataset table">netsnmp_table_dataset_replace_row</a>(datatable,
<a name="l00737" id="l00737"></a>00737                                                       row, newrow);
<a name="l00738" id="l00738"></a>00738                 }
<a name="l00739" id="l00739"></a>00739             }
<a name="l00740" id="l00740"></a>00740             <span class="comment">/*</span>
<a name="l00741" id="l00741"></a>00741 <span class=
"comment">             * ... but every (relevant) varbind in the request will</span>
<a name="l00742" id="l00742"></a>00742 <span class="comment">             * need to know about this new row, so update the</span>
<a name="l00743" id="l00743"></a>00743 <span class="comment">             * per-request row information regardless</span>
<a name="l00744" id="l00744"></a>00744 <span class="comment">             */</span>
<a name="l00745" id="l00745"></a>00745             <span class="keywordflow">if</span> (newrowstash-&gt;created) {
<a name="l00746" id="l00746"></a>00746                 <a class="code" href=
"group__handler.html#gcc092f27f7c4203fe20665c8341023c8" title=
"add data to a request that can be extracted later by submodules">netsnmp_request_add_list_data</a>(request,
<a name="l00747" id="l00747"></a>00747                         <a class="code" href=
"group__data__list.html#g3dc286b678474c6adb610460ea71b03e" title=
"adds creates a data_list node given a name, data and a free function ptr.">netsnmp_create_data_list</a>(TABLE_DATA_NAME,
<a name="l00748" id="l00748"></a>00748                                                  newrow, NULL));
<a name="l00749" id="l00749"></a>00749             }
<a name="l00750" id="l00750"></a>00750             <span class="keywordflow">break</span>;
<a name="l00751" id="l00751"></a>00751 
<a name="l00752" id="l00752"></a>00752         <span class="keywordflow">case</span> MODE_SET_UNDO:
<a name="l00753" id="l00753"></a>00753             <span class="comment">/*</span>
<a name="l00754" id="l00754"></a>00754 <span class=
"comment">             * extract the new row, replace with the old or delete </span>
<a name="l00755" id="l00755"></a>00755 <span class="comment">             */</span>
<a name="l00756" id="l00756"></a>00756             <span class="keywordflow">if</span> (newrowstash-&gt;state != STATE_UNDO) {
<a name="l00757" id="l00757"></a>00757                 newrowstash-&gt;state = STATE_UNDO;
<a name="l00758" id="l00758"></a>00758                 <span class="keywordflow">if</span> (newrowstash-&gt;created) {
<a name="l00759" id="l00759"></a>00759                     <a class="code" href=
"group__table__dataset.html#g227574752f88882185e1a97a85f10765" title=
"removes a row from the table and then deletes it (and all its data)">netsnmp_table_dataset_remove_and_delete_row</a>(datatable, newrow);
<a name="l00760" id="l00760"></a>00760                 } <span class="keywordflow">else</span> {
<a name="l00761" id="l00761"></a>00761                     <a class="code" href=
"group__table__dataset.html#gbccec67ba904c7cda380ca95596317c0" title=
"adds a new row to a dataset table">netsnmp_table_dataset_replace_row</a>(datatable,
<a name="l00762" id="l00762"></a>00762                                                       newrow, row);
<a name="l00763" id="l00763"></a>00763                     <a class="code" href=
"group__table__dataset.html#gf44422bf337cbbd7d95a1b107d4e8971" title=
"deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_row</a>(newrow);
<a name="l00764" id="l00764"></a>00764                 }
<a name="l00765" id="l00765"></a>00765                 newrow = NULL;
<a name="l00766" id="l00766"></a>00766             }
<a name="l00767" id="l00767"></a>00767             <span class="keywordflow">break</span>;
<a name="l00768" id="l00768"></a>00768 
<a name="l00769" id="l00769"></a>00769         <span class="keywordflow">case</span> MODE_SET_COMMIT:
<a name="l00770" id="l00770"></a>00770             <span class="keywordflow">if</span> (newrowstash-&gt;state != STATE_COMMIT) {
<a name="l00771" id="l00771"></a>00771                 newrowstash-&gt;state = STATE_COMMIT;
<a name="l00772" id="l00772"></a>00772                 <span class="keywordflow">if</span> (!newrowstash-&gt;created) {
<a name="l00773" id="l00773"></a>00773                     <a class="code" href="structnetsnmp__request__info__s.html" title=
"The netsnmp request info structure.">netsnmp_request_info</a>       *req;
<a name="l00774" id="l00774"></a>00774                     <a class="code" href=
"group__table__dataset.html#gf44422bf337cbbd7d95a1b107d4e8971" title=
"deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_row</a>(row);
<a name="l00775" id="l00775"></a>00775 
<a name="l00776" id="l00776"></a>00776                     <span class=
"comment">/* Walk the request list to update the reference to the old row w/ th new one */</span>
<a name="l00777" id="l00777"></a>00777                     <span class=
"keywordflow">for</span> (req = requests; req; req=req-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#13370798dcabf32289599250f1b91e6f">next</a>) {
<a name="l00778" id="l00778"></a>00778         
<a name="l00779" id="l00779"></a>00779                         <span class="comment">/*</span>
<a name="l00780" id="l00780"></a>00780 <span class=
"comment">                                * For requests that have the old row values,</span>
<a name="l00781" id="l00781"></a>00781 <span class=
"comment">                                * so add the newly-created row information.</span>
<a name="l00782" id="l00782"></a>00782 <span class="comment">                        */</span>
<a name="l00783" id="l00783"></a>00783                         <span class=
"keywordflow">if</span> ((netsnmp_table_row *) <a class="code" href="group__table__data.html#g0fae612cdbaef2df9006cc01a0c22c57"
title="extracts the row being accessed passed from the table_data helper">netsnmp_extract_table_row</a>(req) == row) {
<a name="l00784" id="l00784"></a>00784                                 <a class="code" href=
"group__handler.html#gc1dd5d6dc36145dc6f1552750edce93c" title=
"remove data from a request">netsnmp_request_remove_list_data</a>(req, TABLE_DATA_ROW);
<a name="l00785" id="l00785"></a>00785                                 <a class="code" href=
"group__handler.html#gcc092f27f7c4203fe20665c8341023c8" title=
"add data to a request that can be extracted later by submodules">netsnmp_request_add_list_data</a>(req,
<a name="l00786" id="l00786"></a>00786                                     <a class="code" href=
"group__data__list.html#g3dc286b678474c6adb610460ea71b03e" title=
"adds creates a data_list node given a name, data and a free function ptr.">netsnmp_create_data_list</a>(TABLE_DATA_ROW, newrow, NULL));
<a name="l00787" id="l00787"></a>00787                         }
<a name="l00788" id="l00788"></a>00788                     }
<a name="l00789" id="l00789"></a>00789 
<a name="l00790" id="l00790"></a>00790                     row = NULL;
<a name="l00791" id="l00791"></a>00791                 }
<a name="l00792" id="l00792"></a>00792                 <span class="keywordflow">if</span> (newrowstash-&gt;deleted) {
<a name="l00793" id="l00793"></a>00793                     <a class="code" href=
"group__table__dataset.html#g227574752f88882185e1a97a85f10765" title=
"removes a row from the table and then deletes it (and all its data)">netsnmp_table_dataset_remove_and_delete_row</a>(datatable, newrow);
<a name="l00794" id="l00794"></a>00794                     newrow = NULL;
<a name="l00795" id="l00795"></a>00795                 }
<a name="l00796" id="l00796"></a>00796             }
<a name="l00797" id="l00797"></a>00797             <span class="keywordflow">break</span>;
<a name="l00798" id="l00798"></a>00798 
<a name="l00799" id="l00799"></a>00799         <span class="keywordflow">case</span> MODE_SET_FREE:
<a name="l00800" id="l00800"></a>00800             <span class=
"keywordflow">if</span> (newrowstash &amp;&amp; newrowstash-&gt;state != STATE_FREE) {
<a name="l00801" id="l00801"></a>00801                 newrowstash-&gt;state = STATE_FREE;
<a name="l00802" id="l00802"></a>00802                 <a class="code" href=
"group__table__dataset.html#gf44422bf337cbbd7d95a1b107d4e8971" title=
"deletes all the data from this node and beyond in the linked list">netsnmp_table_dataset_delete_row</a>(newrow);
<a name="l00803" id="l00803"></a>00803                 newrow = NULL;
<a name="l00804" id="l00804"></a>00804             }
<a name="l00805" id="l00805"></a>00805             <span class="keywordflow">break</span>;
<a name="l00806" id="l00806"></a>00806         }
<a name="l00807" id="l00807"></a>00807     }
<a name="l00808" id="l00808"></a>00808 
<a name="l00809" id="l00809"></a>00809     <span class="comment">/* next handler called automatically - 'AUTO_NEXT' */</span>
<a name="l00810" id="l00810"></a>00810     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
<a name="l00811" id="l00811"></a>00811 }
<a name="l00812" id="l00812"></a>00812 
<a name="l00816" id="l00816"></a>00816 NETSNMP_INLINE netsnmp_table_data_set *
<a name="l00817" id="l00817"></a><a class="code" href=
"group__table__dataset.html#gb215c65b2b8bc844e5711fcf03292883">00817</a> <a class="code" href=
"group__table__dataset.html#gb215c65b2b8bc844e5711fcf03292883" title=
"extracts a netsnmp_table_data_set pointer from a given request">netsnmp_extract_table_data_set</a>(<a class="code" href=
"structnetsnmp__request__info__s.html" title="The netsnmp request info structure.">netsnmp_request_info</a> *request)
<a name="l00818" id="l00818"></a>00818 {
<a name="l00819" id="l00819"></a>00819     <span class="keywordflow">return</span> (netsnmp_table_data_set *)
<a name="l00820" id="l00820"></a>00820         <a class="code" href="group__handler.html#gc8ebe16c4ca9e9e8d06fadcaa2650079"
title="extract data from a request that was added previously by a parent module">netsnmp_request_get_list_data</a>(request, TABLE_DATA_SET_NAME);
<a name="l00821" id="l00821"></a>00821 }
<a name="l00822" id="l00822"></a>00822 
<a name="l00826" id="l00826"></a>00826 netsnmp_table_data_set_storage *
<a name="l00827" id="l00827"></a><a class="code" href=
"group__table__dataset.html#g97801d47420ffa1e24b1c648cc4ed7e3">00827</a> <a class="code" href=
"group__table__dataset.html#g97801d47420ffa1e24b1c648cc4ed7e3" title=
"extracts a netsnmp_table_data_set pointer from a given request">netsnmp_extract_table_data_set_column</a>(<a class="code" href=
"structnetsnmp__request__info__s.html" title="The netsnmp request info structure.">netsnmp_request_info</a> *request,
<a name="l00828" id="l00828"></a>00828                                      <span class=
"keywordtype">unsigned</span> <span class="keywordtype">int</span> column)
<a name="l00829" id="l00829"></a>00829 {
<a name="l00830" id="l00830"></a>00830     netsnmp_table_data_set_storage *data =
<a name="l00831" id="l00831"></a>00831         <a class="code" href="group__table__data.html#gf5572e2cbd11d9de887a7620242d9b2b"
title=
"extracts the data from the row being accessed passed from the table_data helper">netsnmp_extract_table_row_data</a>( request );
<a name="l00832" id="l00832"></a>00832     <span class="keywordflow">if</span> (data) {
<a name="l00833" id="l00833"></a>00833         data = <a class="code" href=
"group__table__dataset.html#g415b0d8045da228d63325800cc6af88d" title=
"Finds a column within a given storage set, given the pointer to the start of the...">netsnmp_table_data_set_find_column</a>(data, column);
<a name="l00834" id="l00834"></a>00834     }
<a name="l00835" id="l00835"></a>00835     <span class="keywordflow">return</span> data;
<a name="l00836" id="l00836"></a>00836 }
<a name="l00837" id="l00837"></a>00837 
<a name="l00838" id="l00838"></a>00838 
<a name="l00839" id="l00839"></a>00839 <span class="comment">/* ==================================</span>
<a name="l00840" id="l00840"></a>00840 <span class="comment"> *</span>
<a name="l00841" id="l00841"></a>00841 <span class="comment"> * Data Set API: Config-based operation</span>
<a name="l00842" id="l00842"></a>00842 <span class="comment"> *</span>
<a name="l00843" id="l00843"></a>00843 <span class="comment"> * ================================== */</span>
<a name="l00844" id="l00844"></a>00844 
<a name="l00853" id="l00853"></a>00853 <span class="keywordtype">void</span>
<a name="l00854" id="l00854"></a><a class="code" href=
"group__table__dataset.html#g0abcc64b2de9687425d8402c0b3377da">00854</a> <a class="code" href=
"group__table__dataset.html#g0abcc64b2de9687425d8402c0b3377da" title=
"registers a table_dataset so that the &amp;quot;add_row&amp;quot; snmpd.conf token can be...">netsnmp_register_auto_data_table</a>(netsnmp_table_data_set *table_set,
<a name="l00855" id="l00855"></a>00855                                  <span class="keywordtype">char</span> *registration_name)
<a name="l00856" id="l00856"></a>00856 {
<a name="l00857" id="l00857"></a>00857     data_set_tables *tables;
<a name="l00858" id="l00858"></a>00858     tables = <a class="code" href="group__util.html#g9cd013bb193de5048149afeb9d94e424"
title="Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(data_set_tables);
<a name="l00859" id="l00859"></a>00859     <span class="keywordflow">if</span> (!tables)
<a name="l00860" id="l00860"></a>00860         <span class="keywordflow">return</span>;
<a name="l00861" id="l00861"></a>00861     tables-&gt;table_set = table_set;
<a name="l00862" id="l00862"></a>00862     <span class="keywordflow">if</span> (!registration_name) {
<a name="l00863" id="l00863"></a>00863         registration_name = table_set-&gt;table-&gt;name;
<a name="l00864" id="l00864"></a>00864     }
<a name="l00865" id="l00865"></a>00865     <a class="code" href="group__data__list.html#g6cd7db26b492e410140b95b3fe423153" title=
"adds data to a datalist">netsnmp_add_list_data</a>(&amp;auto_tables, <a class="code" href=
"group__data__list.html#g3dc286b678474c6adb610460ea71b03e" title=
"adds creates a data_list node given a name, data and a free function ptr.">netsnmp_create_data_list</a>(registration_name, tables, NULL));     <span class="comment">/* XXX */</span>
<a name="l00866" id="l00866"></a>00866 }
<a name="l00867" id="l00867"></a>00867 
<a name="l00868" id="l00868"></a>00868 <span class="preprocessor">#ifndef NETSNMP_DISABLE_MIB_LOADING</span>
<a name="l00869" id="l00869"></a>00869 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00870" id="l00870"></a>00870 _table_set_add_indexes(netsnmp_table_data_set *table_set, <span class=
"keyword">struct</span> tree *tp)
<a name="l00871" id="l00871"></a>00871 {
<a name="l00872" id="l00872"></a>00872     oid             name[MAX_OID_LEN];
<a name="l00873" id="l00873"></a>00873     <span class="keywordtype">size_t</span>          name_length = MAX_OID_LEN;
<a name="l00874" id="l00874"></a>00874     <span class="keyword">struct </span>index_list *index;
<a name="l00875" id="l00875"></a>00875     <span class="keyword">struct </span>tree     *indexnode;
<a name="l00876" id="l00876"></a>00876     u_char          type;
<a name="l00877" id="l00877"></a>00877     <span class="keywordtype">int</span>             fixed_len = 0;
<a name="l00878" id="l00878"></a>00878     
<a name="l00879" id="l00879"></a>00879     <span class="comment">/*</span>
<a name="l00880" id="l00880"></a>00880 <span class="comment">     * loop through indexes and add types </span>
<a name="l00881" id="l00881"></a>00881 <span class="comment">     */</span>
<a name="l00882" id="l00882"></a>00882     <span class=
"keywordflow">for</span> (index = tp-&gt;indexes; index; index = index-&gt;next) {
<a name="l00883" id="l00883"></a>00883         <span class="keywordflow">if</span> (!<a class="code" href=
"group__mib__utilities.html#gcc48b7be12a42c7c4e388e8775c60557" title=
"Given a string, parses an oid out of it (if possible).">snmp_parse_oid</a>(index-&gt;ilabel, name, &amp;name_length) ||
<a name="l00884" id="l00884"></a>00884             (NULL ==
<a name="l00885" id="l00885"></a>00885              (indexnode = get_tree(name, name_length, <a class="code" href=
"group__mib__utilities.html#g5830964581bdd9a3d10e9c626c275a07" title="Retrieves the tree head.">get_tree_head</a>())))) {
<a name="l00886" id="l00886"></a>00886             config_pwarn(<span class=
"stringliteral">"can't instatiate table since "</span>
<a name="l00887" id="l00887"></a>00887                          <span class=
"stringliteral">"I don't know anything about one index"</span>);
<a name="l00888" id="l00888"></a>00888             <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_WARNING, <span class=
"stringliteral">"  index %s not found in tree\n"</span>,
<a name="l00889" id="l00889"></a>00889                      index-&gt;ilabel);
<a name="l00890" id="l00890"></a>00890             <span class="keywordflow">return</span>;             <span class=
"comment">/* xxx mem leak */</span>
<a name="l00891" id="l00891"></a>00891         }
<a name="l00892" id="l00892"></a>00892             
<a name="l00893" id="l00893"></a>00893         type = mib_to_asn_type(indexnode-&gt;type);
<a name="l00894" id="l00894"></a>00894         <span class="keywordflow">if</span> (type == (u_char) - 1) {
<a name="l00895" id="l00895"></a>00895             config_pwarn(<span class="stringliteral">"unknown index type"</span>);
<a name="l00896" id="l00896"></a>00896             <span class="keywordflow">return</span>;             <span class=
"comment">/* xxx mem leak */</span>
<a name="l00897" id="l00897"></a>00897         }
<a name="l00898" id="l00898"></a>00898         <span class="comment">/*</span>
<a name="l00899" id="l00899"></a>00899 <span class=
"comment">         * if implied, mark it as such. also mark fixed length</span>
<a name="l00900" id="l00900"></a>00900 <span class=
"comment">         * octet strings as implied (ie no length prefix) as well.</span>
<a name="l00901" id="l00901"></a>00901 <span class="comment">         * */</span>
<a name="l00902" id="l00902"></a>00902         <span class=
"keywordflow">if</span> ((TYPE_OCTETSTR == indexnode-&gt;type) &amp;&amp;  <span class="comment">/* octet str */</span>
<a name="l00903" id="l00903"></a>00903             (NULL != indexnode-&gt;ranges) &amp;&amp;         <span class=
"comment">/* &amp; has range */</span>
<a name="l00904" id="l00904"></a>00904             (NULL == indexnode-&gt;ranges-&gt;next) &amp;&amp;   <span class=
"comment">/*   but only one */</span>
<a name="l00905" id="l00905"></a>00905             (indexnode-&gt;ranges-&gt;high ==            <span class=
"comment">/*   &amp; high==low */</span>
<a name="l00906" id="l00906"></a>00906              indexnode-&gt;ranges-&gt;low)) {
<a name="l00907" id="l00907"></a>00907             type |= ASN_PRIVATE;
<a name="l00908" id="l00908"></a>00908             fixed_len = indexnode-&gt;ranges-&gt;high;
<a name="l00909" id="l00909"></a>00909         }
<a name="l00910" id="l00910"></a>00910         <span class="keywordflow">else</span> <span class=
"keywordflow">if</span> (index-&gt;isimplied)
<a name="l00911" id="l00911"></a>00911             type |= ASN_PRIVATE;
<a name="l00912" id="l00912"></a>00912         
<a name="l00913" id="l00913"></a>00913         DEBUGMSGTL((<span class="stringliteral">"table_set_add_table"</span>,
<a name="l00914" id="l00914"></a>00914                     <span class=
"stringliteral">"adding default index of type %d\n"</span>, type));
<a name="l00915" id="l00915"></a>00915         <a class="code" href=
"group__table__dataset.html#gc5453f15d00c7d58881ba43109ca7709" title=
"adds an index to the table.">netsnmp_table_dataset_add_index</a>(table_set, type);
<a name="l00916" id="l00916"></a>00916 
<a name="l00917" id="l00917"></a>00917         <span class="comment">/*</span>
<a name="l00918" id="l00918"></a>00918 <span class="comment">         * hack alert: for fixed lenght strings, save the</span>
<a name="l00919" id="l00919"></a>00919 <span class="comment">         * lenght for use during oid parsing.</span>
<a name="l00920" id="l00920"></a>00920 <span class="comment">         */</span>
<a name="l00921" id="l00921"></a>00921         <span class="keywordflow">if</span> (fixed_len) {
<a name="l00922" id="l00922"></a>00922             <span class="comment">/*</span>
<a name="l00923" id="l00923"></a>00923 <span class="comment">             * find last (just added) index</span>
<a name="l00924" id="l00924"></a>00924 <span class="comment">             */</span>
<a name="l00925" id="l00925"></a>00925             <a class="code" href="structvariable__list.html" title=
"The netsnmp variable list binding structure, it&amp;#39;s typedef&amp;#39;d to netsnmp_variable_list...">netsnmp_variable_list</a> *var =  table_set-&gt;table-&gt;indexes_template;
<a name="l00926" id="l00926"></a>00926             <span class="keywordflow">while</span> (NULL != var-&gt;<a class="code" href=
"structvariable__list.html#036af3c8c73da042622a58afa452d76e" title="NULL for last variable.">next_variable</a>)
<a name="l00927" id="l00927"></a>00927                 var = var-&gt;<a class="code" href=
"structvariable__list.html#036af3c8c73da042622a58afa452d76e" title="NULL for last variable.">next_variable</a>;
<a name="l00928" id="l00928"></a>00928             var-&gt;<a class="code" href=
"structvariable__list.html#17aaa6b445178fc39aba69642247d3e9" title=
"the length of the value to be copied into buf">val_len</a> = fixed_len;
<a name="l00929" id="l00929"></a>00929         }
<a name="l00930" id="l00930"></a>00930     }
<a name="l00931" id="l00931"></a>00931 }
<a name="l00933" id="l00933"></a>00933 <span class="keywordtype">void</span>
<a name="l00934" id="l00934"></a>00934 netsnmp_config_parse_table_set(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *token, <span class="keywordtype">char</span> *line)
<a name="l00935" id="l00935"></a>00935 {
<a name="l00936" id="l00936"></a>00936     oid             table_name[MAX_OID_LEN];
<a name="l00937" id="l00937"></a>00937     <span class="keywordtype">size_t</span>          table_name_length = MAX_OID_LEN;
<a name="l00938" id="l00938"></a>00938     <span class="keyword">struct </span>tree    *tp;
<a name="l00939" id="l00939"></a>00939     netsnmp_table_data_set *table_set;
<a name="l00940" id="l00940"></a>00940     data_set_tables *tables;
<a name="l00941" id="l00941"></a>00941     <span class="keywordtype">unsigned</span> <span class=
"keywordtype">int</span>    mincol = 0xffffff, maxcol = 0;
<a name="l00942" id="l00942"></a>00942     <span class="keywordtype">char</span>           *pos;
<a name="l00943" id="l00943"></a>00943 
<a name="l00944" id="l00944"></a>00944     <span class="comment">/*</span>
<a name="l00945" id="l00945"></a>00945 <span class="comment">     * instatiate a fake table based on MIB information </span>
<a name="l00946" id="l00946"></a>00946 <span class="comment">     */</span>
<a name="l00947" id="l00947"></a>00947     DEBUGMSGTL((<span class="stringliteral">"9:table_set_add_table"</span>, <span class=
"stringliteral">"processing '%s'\n"</span>, line));
<a name="l00948" id="l00948"></a>00948     <span class="keywordflow">if</span> (NULL != (pos = strchr(line,<span class=
"charliteral">' '</span>))) {
<a name="l00949" id="l00949"></a>00949         config_pwarn(<span class="stringliteral">"ignoring extra tokens on line"</span>);
<a name="l00950" id="l00950"></a>00950         <a class="code" href="group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2"
title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_WARNING,<span class=
"stringliteral">"  ignoring '%s'\n"</span>, pos);
<a name="l00951" id="l00951"></a>00951         *pos = <span class="charliteral">'\0'</span>;
<a name="l00952" id="l00952"></a>00952     }
<a name="l00953" id="l00953"></a>00953 
<a name="l00954" id="l00954"></a>00954     <span class="comment">/*</span>
<a name="l00955" id="l00955"></a>00955 <span class="comment">     * check for duplicate table</span>
<a name="l00956" id="l00956"></a>00956 <span class="comment">     */</span>
<a name="l00957" id="l00957"></a>00957     tables = (data_set_tables *) <a class="code" href=
"group__data__list.html#g9bf1a62a625bd48320376f27ecee41c0" title=
"returns a data_list node&amp;#39;s data for a given name within a data_list">netsnmp_get_list_data</a>(auto_tables, line);
<a name="l00958" id="l00958"></a>00958     <span class="keywordflow">if</span> (NULL != tables) {
<a name="l00959" id="l00959"></a>00959         config_pwarn(<span class="stringliteral">"duplicate table definition"</span>);
<a name="l00960" id="l00960"></a>00960         <span class="keywordflow">return</span>;
<a name="l00961" id="l00961"></a>00961     }
<a name="l00962" id="l00962"></a>00962 
<a name="l00963" id="l00963"></a>00963     <span class="comment">/*</span>
<a name="l00964" id="l00964"></a>00964 <span class="comment">     * parse oid and find tree structure</span>
<a name="l00965" id="l00965"></a>00965 <span class="comment">     */</span>
<a name="l00966" id="l00966"></a>00966     <span class="keywordflow">if</span> (!<a class="code" href=
"group__mib__utilities.html#gcc48b7be12a42c7c4e388e8775c60557" title=
"Given a string, parses an oid out of it (if possible).">snmp_parse_oid</a>(line, table_name, &amp;table_name_length)) {
<a name="l00967" id="l00967"></a>00967         config_pwarn
<a name="l00968" id="l00968"></a>00968             (<span class=
"stringliteral">"can't instatiate table since I can't parse the table name"</span>);
<a name="l00969" id="l00969"></a>00969         <span class="keywordflow">return</span>;
<a name="l00970" id="l00970"></a>00970     }
<a name="l00971" id="l00971"></a>00971     <span class=
"keywordflow">if</span>(NULL == (tp = get_tree(table_name, table_name_length,
<a name="l00972" id="l00972"></a>00972                               <a class="code" href=
"group__mib__utilities.html#g5830964581bdd9a3d10e9c626c275a07" title="Retrieves the tree head.">get_tree_head</a>()))) {
<a name="l00973" id="l00973"></a>00973         config_pwarn(<span class="stringliteral">"can't instatiate table since "</span>
<a name="l00974" id="l00974"></a>00974                      <span class=
"stringliteral">"I can't find mib information about it"</span>);
<a name="l00975" id="l00975"></a>00975         <span class="keywordflow">return</span>;
<a name="l00976" id="l00976"></a>00976     }
<a name="l00977" id="l00977"></a>00977 
<a name="l00978" id="l00978"></a>00978     <span class=
"keywordflow">if</span> (NULL == (tp = tp-&gt;child_list) || NULL == tp-&gt;child_list) {
<a name="l00979" id="l00979"></a>00979         config_pwarn(<span class=
"stringliteral">"can't instatiate table since it doesn't appear to be "</span>
<a name="l00980" id="l00980"></a>00980                      <span class="stringliteral">"a proper table (no children)"</span>);
<a name="l00981" id="l00981"></a>00981         <span class="keywordflow">return</span>;
<a name="l00982" id="l00982"></a>00982     }
<a name="l00983" id="l00983"></a>00983 
<a name="l00984" id="l00984"></a>00984     table_set = <a class="code" href=
"group__table__dataset.html#gb523c6783716afd206f0512f93ef6503" title=
"Create a netsnmp_table_data_set structure given a table_data definition.">netsnmp_create_table_data_set</a>(line);
<a name="l00985" id="l00985"></a>00985 
<a name="l00986" id="l00986"></a>00986     <span class="comment">/*</span>
<a name="l00987" id="l00987"></a>00987 <span class="comment">     * check for augments indexes</span>
<a name="l00988" id="l00988"></a>00988 <span class="comment">     */</span>
<a name="l00989" id="l00989"></a>00989     <span class="keywordflow">if</span> (NULL != tp-&gt;augments) {
<a name="l00990" id="l00990"></a>00990         oid             name[MAX_OID_LEN];
<a name="l00991" id="l00991"></a>00991         <span class="keywordtype">size_t</span>          name_length = MAX_OID_LEN;
<a name="l00992" id="l00992"></a>00992         <span class="keyword">struct </span>tree    *tp2;
<a name="l00993" id="l00993"></a>00993     
<a name="l00994" id="l00994"></a>00994         <span class="keywordflow">if</span> (!<a class="code" href=
"group__mib__utilities.html#gcc48b7be12a42c7c4e388e8775c60557" title=
"Given a string, parses an oid out of it (if possible).">snmp_parse_oid</a>(tp-&gt;augments, name, &amp;name_length)) {
<a name="l00995" id="l00995"></a>00995             config_pwarn(<span class=
"stringliteral">"I can't parse the augment tabel name"</span>);
<a name="l00996" id="l00996"></a>00996             <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_WARNING, <span class=
"stringliteral">"  can't parse %s\n"</span>, tp-&gt;augments);
<a name="l00997" id="l00997"></a>00997             <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6"
title="Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a> (table_set);
<a name="l00998" id="l00998"></a>00998             <span class="keywordflow">return</span>;
<a name="l00999" id="l00999"></a>00999         }
<a name="l01000" id="l01000"></a>01000         <span class=
"keywordflow">if</span>(NULL == (tp2 = get_tree(name, name_length, <a class="code" href=
"group__mib__utilities.html#g5830964581bdd9a3d10e9c626c275a07" title="Retrieves the tree head.">get_tree_head</a>()))) {
<a name="l01001" id="l01001"></a>01001             config_pwarn(<span class=
"stringliteral">"can't instatiate table since "</span>
<a name="l01002" id="l01002"></a>01002                          <span class=
"stringliteral">"I can't find mib information about augment table"</span>);
<a name="l01003" id="l01003"></a>01003             <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_WARNING, <span class=
"stringliteral">"  table %s not found in tree\n"</span>,
<a name="l01004" id="l01004"></a>01004                      tp-&gt;augments);
<a name="l01005" id="l01005"></a>01005             <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6"
title="Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a> (table_set);
<a name="l01006" id="l01006"></a>01006             <span class="keywordflow">return</span>;
<a name="l01007" id="l01007"></a>01007         }
<a name="l01008" id="l01008"></a>01008         _table_set_add_indexes(table_set, tp2);
<a name="l01009" id="l01009"></a>01009     }
<a name="l01010" id="l01010"></a>01010 
<a name="l01011" id="l01011"></a>01011     _table_set_add_indexes(table_set, tp);
<a name="l01012" id="l01012"></a>01012     
<a name="l01013" id="l01013"></a>01013     <span class="comment">/*</span>
<a name="l01014" id="l01014"></a>01014 <span class="comment">     * loop through children and add each column info </span>
<a name="l01015" id="l01015"></a>01015 <span class="comment">     */</span>
<a name="l01016" id="l01016"></a>01016     <span class=
"keywordflow">for</span> (tp = tp-&gt;child_list; tp; tp = tp-&gt;next_peer) {
<a name="l01017" id="l01017"></a>01017         <span class="keywordtype">int</span>             canwrite = 0;
<a name="l01018" id="l01018"></a>01018         u_char          type;
<a name="l01019" id="l01019"></a>01019         type = mib_to_asn_type(tp-&gt;type);
<a name="l01020" id="l01020"></a>01020         <span class="keywordflow">if</span> (type == (u_char) - 1) {
<a name="l01021" id="l01021"></a>01021             config_pwarn(<span class="stringliteral">"unknown column type"</span>);
<a name="l01022" id="l01022"></a>01022             <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6"
title="Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a> (table_set);
<a name="l01023" id="l01023"></a>01023             <span class="keywordflow">return</span>;             <span class=
"comment">/* xxx mem leak */</span>
<a name="l01024" id="l01024"></a>01024         }
<a name="l01025" id="l01025"></a>01025 
<a name="l01026" id="l01026"></a>01026         DEBUGMSGTL((<span class="stringliteral">"table_set_add_table"</span>,
<a name="l01027" id="l01027"></a>01027                     <span class=
"stringliteral">"adding column %s(%ld) of type %d (access %d)\n"</span>,
<a name="l01028" id="l01028"></a>01028                     tp-&gt;label, tp-&gt;subid, type, tp-&gt;access));
<a name="l01029" id="l01029"></a>01029 
<a name="l01030" id="l01030"></a>01030         <span class="keywordflow">switch</span> (tp-&gt;access) {
<a name="l01031" id="l01031"></a>01031         <span class="keywordflow">case</span> MIB_ACCESS_CREATE:
<a name="l01032" id="l01032"></a>01032             table_set-&gt;allow_creation = 1;
<a name="l01033" id="l01033"></a>01033         <span class="keywordflow">case</span> MIB_ACCESS_READWRITE:
<a name="l01034" id="l01034"></a>01034         <span class="keywordflow">case</span> MIB_ACCESS_WRITEONLY:
<a name="l01035" id="l01035"></a>01035             canwrite = 1;
<a name="l01036" id="l01036"></a>01036         <span class="keywordflow">case</span> MIB_ACCESS_READONLY:
<a name="l01037" id="l01037"></a>01037             DEBUGMSGTL((<span class="stringliteral">"table_set_add_table"</span>,
<a name="l01038" id="l01038"></a>01038                         <span class=
"stringliteral">"adding column %ld of type %d\n"</span>, tp-&gt;subid, type));
<a name="l01039" id="l01039"></a>01039             <a class="code" href=
"group__table__dataset.html#g856fae0cafd9c19a1d856ad6f892c13e" title=
"adds a new default row to a table_set.">netsnmp_table_set_add_default_row</a>(table_set, tp-&gt;subid, type,
<a name="l01040" id="l01040"></a>01040                                               canwrite, NULL, 0);
<a name="l01041" id="l01041"></a>01041             mincol = <a class="code" href=
"group__util.html#gd1976dec11cfd62abaa4ecedad948f18" title=
"Computers the minimum of a and b.">SNMP_MIN</a>(mincol, tp-&gt;subid);
<a name="l01042" id="l01042"></a>01042             maxcol = <a class="code" href=
"group__util.html#ga70d7b83d1001df95cf64280e9545564" title=
"Computers the maximum of a and b.">SNMP_MAX</a>(maxcol, tp-&gt;subid);
<a name="l01043" id="l01043"></a>01043             <span class="keywordflow">break</span>;
<a name="l01044" id="l01044"></a>01044 
<a name="l01045" id="l01045"></a>01045         <span class="keywordflow">case</span> MIB_ACCESS_NOACCESS:
<a name="l01046" id="l01046"></a>01046         <span class="keywordflow">case</span> MIB_ACCESS_NOTIFY:
<a name="l01047" id="l01047"></a>01047             <span class="keywordflow">break</span>;
<a name="l01048" id="l01048"></a>01048 
<a name="l01049" id="l01049"></a>01049         <span class="keywordflow">default</span>:
<a name="l01050" id="l01050"></a>01050             config_pwarn(<span class="stringliteral">"unknown column access type"</span>);
<a name="l01051" id="l01051"></a>01051             <span class="keywordflow">break</span>;
<a name="l01052" id="l01052"></a>01052         }
<a name="l01053" id="l01053"></a>01053     }
<a name="l01054" id="l01054"></a>01054 
<a name="l01055" id="l01055"></a>01055     <span class="comment">/*</span>
<a name="l01056" id="l01056"></a>01056 <span class="comment">     * register the table </span>
<a name="l01057" id="l01057"></a>01057 <span class="comment">     */</span>
<a name="l01058" id="l01058"></a>01058     <a class="code" href="group__table__dataset.html#gc3daf62b5ff07dd03bc5b993e93ab103"
title=
"register a given data_set at a given oid (specified in the netsnmp_handler_registration...">netsnmp_register_table_data_set</a>(netsnmp_create_handler_registration
<a name="l01059" id="l01059"></a>01059                                     (line, NULL, table_name,
<a name="l01060" id="l01060"></a>01060                                      table_name_length,
<a name="l01061" id="l01061"></a>01061                                      HANDLER_CAN_RWRITE), table_set, NULL);
<a name="l01062" id="l01062"></a>01062 
<a name="l01063" id="l01063"></a>01063     <a class="code" href="group__table__dataset.html#g0abcc64b2de9687425d8402c0b3377da"
title=
"registers a table_dataset so that the &amp;quot;add_row&amp;quot; snmpd.conf token can be...">netsnmp_register_auto_data_table</a>(table_set, NULL);
<a name="l01064" id="l01064"></a>01064 }
<a name="l01065" id="l01065"></a>01065 <span class="preprocessor">#endif </span><span class=
"comment">/* NETSNMP_DISABLE_MIB_LOADING */</span>
<a name="l01066" id="l01066"></a>01066 
<a name="l01068" id="l01068"></a>01068 <span class="keywordtype">void</span>
<a name="l01069" id="l01069"></a>01069 netsnmp_config_parse_add_row(<span class="keyword">const</span> <span class=
"keywordtype">char</span> *token, <span class="keywordtype">char</span> *line)
<a name="l01070" id="l01070"></a>01070 {
<a name="l01071" id="l01071"></a>01071     <span class="keywordtype">char</span>            buf[SNMP_MAXBUF_MEDIUM];
<a name="l01072" id="l01072"></a>01072     <span class="keywordtype">char</span>            tname[SNMP_MAXBUF_MEDIUM];
<a name="l01073" id="l01073"></a>01073     <span class="keywordtype">size_t</span>          buf_size;
<a name="l01074" id="l01074"></a>01074     <span class="keywordtype">int</span>             rc;
<a name="l01075" id="l01075"></a>01075 
<a name="l01076" id="l01076"></a>01076     data_set_tables *tables;
<a name="l01077" id="l01077"></a>01077     <a class="code" href="structvariable__list.html" title=
"The netsnmp variable list binding structure, it&amp;#39;s typedef&amp;#39;d to netsnmp_variable_list...">netsnmp_variable_list</a> *vb;  <span class="comment">/* containing only types */</span>
<a name="l01078" id="l01078"></a>01078     netsnmp_table_row *row;
<a name="l01079" id="l01079"></a>01079     netsnmp_table_data_set_storage *dr;
<a name="l01080" id="l01080"></a>01080 
<a name="l01081" id="l01081"></a>01081     line = copy_nword(line, tname, SNMP_MAXBUF_MEDIUM);
<a name="l01082" id="l01082"></a>01082 
<a name="l01083" id="l01083"></a>01083     tables = (data_set_tables *) <a class="code" href=
"group__data__list.html#g9bf1a62a625bd48320376f27ecee41c0" title=
"returns a data_list node&amp;#39;s data for a given name within a data_list">netsnmp_get_list_data</a>(auto_tables, tname);
<a name="l01084" id="l01084"></a>01084     <span class="keywordflow">if</span> (!tables) {
<a name="l01085" id="l01085"></a>01085         config_pwarn(<span class=
"stringliteral">"Unknown table trying to add a row"</span>);
<a name="l01086" id="l01086"></a>01086         <span class="keywordflow">return</span>;
<a name="l01087" id="l01087"></a>01087     }
<a name="l01088" id="l01088"></a>01088 
<a name="l01089" id="l01089"></a>01089     <span class="comment">/*</span>
<a name="l01090" id="l01090"></a>01090 <span class="comment">     * do the indexes first </span>
<a name="l01091" id="l01091"></a>01091 <span class="comment">     */</span>
<a name="l01092" id="l01092"></a>01092     row = <a class="code" href="group__table__data.html#gfdadce2dee8bc75b2b0dfd8e634e46a3"
title="creates and returns a pointer to table data set">netsnmp_create_table_data_row</a>();
<a name="l01093" id="l01093"></a>01093 
<a name="l01094" id="l01094"></a>01094     <span class=
"keywordflow">for</span> (vb = tables-&gt;table_set-&gt;table-&gt;indexes_template; vb;
<a name="l01095" id="l01095"></a>01095          vb = vb-&gt;<a class="code" href=
"structvariable__list.html#036af3c8c73da042622a58afa452d76e" title="NULL for last variable.">next_variable</a>) {
<a name="l01096" id="l01096"></a>01096         <span class="keywordflow">if</span> (!line) {
<a name="l01097" id="l01097"></a>01097             config_pwarn(<span class="stringliteral">"missing an index value"</span>);
<a name="l01098" id="l01098"></a>01098             <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6"
title="Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a> (row);
<a name="l01099" id="l01099"></a>01099             <span class="keywordflow">return</span>;
<a name="l01100" id="l01100"></a>01100         }
<a name="l01101" id="l01101"></a>01101 
<a name="l01102" id="l01102"></a>01102         DEBUGMSGTL((<span class="stringliteral">"table_set_add_row"</span>, <span class=
"stringliteral">"adding index of type %d\n"</span>,
<a name="l01103" id="l01103"></a>01103                     vb-&gt;<a class="code" href=
"structvariable__list.html#8bd719974b3554116631ea80dc88b6aa" title="ASN type of variable.">type</a>));
<a name="l01104" id="l01104"></a>01104         buf_size = SNMP_MAXBUF_MEDIUM;
<a name="l01105" id="l01105"></a>01105         line = read_config_read_memory(vb-&gt;<a class="code" href=
"structvariable__list.html#8bd719974b3554116631ea80dc88b6aa" title="ASN type of variable.">type</a>, line, buf, &amp;buf_size);
<a name="l01106" id="l01106"></a>01106         netsnmp_table_row_add_index(row, vb-&gt;<a class="code" href=
"structvariable__list.html#8bd719974b3554116631ea80dc88b6aa" title="ASN type of variable.">type</a>, buf, buf_size);
<a name="l01107" id="l01107"></a>01107     }
<a name="l01108" id="l01108"></a>01108 
<a name="l01109" id="l01109"></a>01109     <span class="comment">/*</span>
<a name="l01110" id="l01110"></a>01110 <span class="comment">     * then do the data </span>
<a name="l01111" id="l01111"></a>01111 <span class="comment">     */</span>
<a name="l01112" id="l01112"></a>01112     <span class=
"keywordflow">for</span> (dr = tables-&gt;table_set-&gt;default_row; dr; dr = dr-&gt;next) {
<a name="l01113" id="l01113"></a>01113         <span class="keywordflow">if</span> (!line) {
<a name="l01114" id="l01114"></a>01114             config_pwarn(<span class="stringliteral">"missing a data value. "</span>
<a name="l01115" id="l01115"></a>01115                          <span class=
"stringliteral">"All columns must be specified."</span>);
<a name="l01116" id="l01116"></a>01116             <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_WARNING,<span class=
"stringliteral">"  can't find value for column %d\n"</span>,
<a name="l01117" id="l01117"></a>01117                      dr-&gt;column - 1);
<a name="l01118" id="l01118"></a>01118             <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6"
title="Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a> (row);
<a name="l01119" id="l01119"></a>01119             <span class="keywordflow">return</span>;
<a name="l01120" id="l01120"></a>01120         }
<a name="l01121" id="l01121"></a>01121 
<a name="l01122" id="l01122"></a>01122         buf_size = SNMP_MAXBUF_MEDIUM;
<a name="l01123" id="l01123"></a>01123         line = read_config_read_memory(dr-&gt;type, line, buf, &amp;buf_size);
<a name="l01124" id="l01124"></a>01124         DEBUGMSGTL((<span class="stringliteral">"table_set_add_row"</span>,
<a name="l01125" id="l01125"></a>01125                     <span class=
"stringliteral">"adding data at column %d of type %d\n"</span>, dr-&gt;column,
<a name="l01126" id="l01126"></a>01126                     dr-&gt;type));
<a name="l01127" id="l01127"></a>01127         <a class="code" href=
"group__table__dataset.html#gaa497e6eec3b370c5901905696bc78af" title=
"sets a given column in a row with data given a type, value, and length.">netsnmp_set_row_column</a>(row, dr-&gt;column, dr-&gt;type, buf, buf_size);
<a name="l01128" id="l01128"></a>01128         <span class="keywordflow">if</span> (dr-&gt;writable)
<a name="l01129" id="l01129"></a>01129             <a class="code" href=
"group__table__dataset.html#g5dce210cd4d59eb8b01478ee5d0dc348" title=
"marks a given column in a row as writable or not.">netsnmp_mark_row_column_writable</a>(row, dr-&gt;column, 1);       <span class="comment">/* make writable */</span>
<a name="l01130" id="l01130"></a>01130     }
<a name="l01131" id="l01131"></a>01131     rc = <a class="code" href="group__table__data.html#gfa6a070da8369ec7a3c87e4fdcd014de"
title=
"Adds a row of data to a given table (stored in proper lexographical order).">netsnmp_table_data_add_row</a>(tables-&gt;table_set-&gt;table, row);
<a name="l01132" id="l01132"></a>01132     <span class="keywordflow">if</span> (SNMPERR_SUCCESS != rc) {
<a name="l01133" id="l01133"></a>01133         config_pwarn(<span class="stringliteral">"error adding table row"</span>);
<a name="l01134" id="l01134"></a>01134     }
<a name="l01135" id="l01135"></a>01135     <span class="keywordflow">if</span> (NULL != line) {
<a name="l01136" id="l01136"></a>01136         config_pwarn(<span class=
"stringliteral">"extra data value. Too many columns specified."</span>);
<a name="l01137" id="l01137"></a>01137         <a class="code" href="group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2"
title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_WARNING,<span class=
"stringliteral">"  extra data '%s'\n"</span>, line);
<a name="l01138" id="l01138"></a>01138     }
<a name="l01139" id="l01139"></a>01139 }
<a name="l01140" id="l01140"></a>01140 
<a name="l01141" id="l01141"></a>01141 
<a name="l01142" id="l01142"></a>01142 <span class="comment">/* ==================================</span>
<a name="l01143" id="l01143"></a>01143 <span class="comment"> *</span>
<a name="l01144" id="l01144"></a>01144 <span class="comment"> * Data Set API: Row operations</span>
<a name="l01145" id="l01145"></a>01145 <span class="comment"> *</span>
<a name="l01146" id="l01146"></a>01146 <span class="comment"> * ================================== */</span>
<a name="l01147" id="l01147"></a>01147 
<a name="l01149" id="l01149"></a>01149 netsnmp_table_row *
<a name="l01150" id="l01150"></a><a class="code" href=
"group__table__dataset.html#g97de8fced32fab9d344e8265d1ba6eed">01150</a> <a class="code" href=
"group__table__dataset.html#g97de8fced32fab9d344e8265d1ba6eed" title=
"returns the first row in the table">netsnmp_table_data_set_get_first_row</a>(netsnmp_table_data_set *table)
<a name="l01151" id="l01151"></a>01151 {
<a name="l01152" id="l01152"></a>01152     <span class="keywordflow">return</span> <a class="code" href=
"group__table__data.html#g22709ef5a1d6198937526679b0a0e503" title=
"returns the first row in the table">netsnmp_table_data_get_first_row</a>(table-&gt;table);
<a name="l01153" id="l01153"></a>01153 }
<a name="l01154" id="l01154"></a>01154 
<a name="l01156" id="l01156"></a>01156 netsnmp_table_row *
<a name="l01157" id="l01157"></a><a class="code" href=
"group__table__dataset.html#gb4df0ce460721ca4eb500f5656a881cb">01157</a> <a class="code" href=
"group__table__dataset.html#gb4df0ce460721ca4eb500f5656a881cb" title=
"returns the next row in the table">netsnmp_table_data_set_get_next_row</a>(netsnmp_table_data_set *table,
<a name="l01158" id="l01158"></a>01158                                     netsnmp_table_row      *row)
<a name="l01159" id="l01159"></a>01159 {
<a name="l01160" id="l01160"></a>01160     <span class="keywordflow">return</span> <a class="code" href=
"group__table__data.html#g5946b9b88fd3d284d6994a5c4b6eaa62" title=
"returns the next row in the table">netsnmp_table_data_get_next_row</a>(table-&gt;table, row);
<a name="l01161" id="l01161"></a>01161 }
<a name="l01162" id="l01162"></a>01162 
<a name="l01163" id="l01163"></a>01163 <span class="keywordtype">int</span>
<a name="l01164" id="l01164"></a>01164 netsnmp_table_set_num_rows(netsnmp_table_data_set *table)
<a name="l01165" id="l01165"></a>01165 {
<a name="l01166" id="l01166"></a>01166     <span class="keywordflow">if</span> (!table)
<a name="l01167" id="l01167"></a>01167         <span class="keywordflow">return</span> 0;
<a name="l01168" id="l01168"></a>01168     <span class="keywordflow">return</span> netsnmp_table_data_num_rows(table-&gt;table);
<a name="l01169" id="l01169"></a>01169 }
<a name="l01170" id="l01170"></a>01170 
<a name="l01171" id="l01171"></a>01171 <span class="comment">/* ==================================</span>
<a name="l01172" id="l01172"></a>01172 <span class="comment"> *</span>
<a name="l01173" id="l01173"></a>01173 <span class="comment"> * Data Set API: Column operations</span>
<a name="l01174" id="l01174"></a>01174 <span class="comment"> *</span>
<a name="l01175" id="l01175"></a>01175 <span class="comment"> * ================================== */</span>
<a name="l01176" id="l01176"></a>01176 
<a name="l01180" id="l01180"></a>01180 netsnmp_table_data_set_storage *
<a name="l01181" id="l01181"></a><a class="code" href=
"group__table__dataset.html#g415b0d8045da228d63325800cc6af88d">01181</a> <a class="code" href=
"group__table__dataset.html#g415b0d8045da228d63325800cc6af88d" title=
"Finds a column within a given storage set, given the pointer to the start of the...">netsnmp_table_data_set_find_column</a>(netsnmp_table_data_set_storage *start,
<a name="l01182" id="l01182"></a>01182                                    <span class="keywordtype">unsigned</span> <span class=
"keywordtype">int</span> column)
<a name="l01183" id="l01183"></a>01183 {
<a name="l01184" id="l01184"></a>01184     <span class="keywordflow">while</span> (start &amp;&amp; start-&gt;column != column)
<a name="l01185" id="l01185"></a>01185         start = start-&gt;next;
<a name="l01186" id="l01186"></a>01186     <span class="keywordflow">return</span> start;
<a name="l01187" id="l01187"></a>01187 }
<a name="l01188" id="l01188"></a>01188 
<a name="l01192" id="l01192"></a>01192 <span class="keywordtype">int</span>
<a name="l01193" id="l01193"></a><a class="code" href=
"group__table__dataset.html#g5dce210cd4d59eb8b01478ee5d0dc348">01193</a> <a class="code" href=
"group__table__dataset.html#g5dce210cd4d59eb8b01478ee5d0dc348" title=
"marks a given column in a row as writable or not.">netsnmp_mark_row_column_writable</a>(netsnmp_table_row *row, <span class=
"keywordtype">int</span> column,
<a name="l01194" id="l01194"></a>01194                                  <span class="keywordtype">int</span> writable)
<a name="l01195" id="l01195"></a>01195 {
<a name="l01196" id="l01196"></a>01196     netsnmp_table_data_set_storage *data;
<a name="l01197" id="l01197"></a>01197 
<a name="l01198" id="l01198"></a>01198     <span class="keywordflow">if</span> (!row)
<a name="l01199" id="l01199"></a>01199         <span class="keywordflow">return</span> SNMPERR_GENERR;
<a name="l01200" id="l01200"></a>01200 
<a name="l01201" id="l01201"></a>01201     data = (netsnmp_table_data_set_storage *) row-&gt;data;
<a name="l01202" id="l01202"></a>01202     data = <a class="code" href=
"group__table__dataset.html#g415b0d8045da228d63325800cc6af88d" title=
"Finds a column within a given storage set, given the pointer to the start of the...">netsnmp_table_data_set_find_column</a>(data, column);
<a name="l01203" id="l01203"></a>01203 
<a name="l01204" id="l01204"></a>01204     <span class="keywordflow">if</span> (!data) {
<a name="l01205" id="l01205"></a>01205         <span class="comment">/*</span>
<a name="l01206" id="l01206"></a>01206 <span class="comment">         * create it </span>
<a name="l01207" id="l01207"></a>01207 <span class="comment">         */</span>
<a name="l01208" id="l01208"></a>01208         data = <a class="code" href="group__util.html#g9cd013bb193de5048149afeb9d94e424"
title=
"Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(netsnmp_table_data_set_storage);
<a name="l01209" id="l01209"></a>01209         <span class="keywordflow">if</span> (!data) {
<a name="l01210" id="l01210"></a>01210             <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_CRIT, <span class=
"stringliteral">"no memory in netsnmp_set_row_column"</span>);
<a name="l01211" id="l01211"></a>01211             <span class="keywordflow">return</span> SNMPERR_MALLOC;
<a name="l01212" id="l01212"></a>01212         }
<a name="l01213" id="l01213"></a>01213         data-&gt;column = column;
<a name="l01214" id="l01214"></a>01214         data-&gt;writable = writable;
<a name="l01215" id="l01215"></a>01215         data-&gt;next = row-&gt;data;
<a name="l01216" id="l01216"></a>01216         row-&gt;data = data;
<a name="l01217" id="l01217"></a>01217     } <span class="keywordflow">else</span> {
<a name="l01218" id="l01218"></a>01218         data-&gt;writable = writable;
<a name="l01219" id="l01219"></a>01219     }
<a name="l01220" id="l01220"></a>01220     <span class="keywordflow">return</span> SNMPERR_SUCCESS;
<a name="l01221" id="l01221"></a>01221 }
<a name="l01222" id="l01222"></a>01222 
<a name="l01227" id="l01227"></a>01227 <span class="keywordtype">int</span>
<a name="l01228" id="l01228"></a><a class="code" href=
"group__table__dataset.html#gaa497e6eec3b370c5901905696bc78af">01228</a> <a class="code" href=
"group__table__dataset.html#gaa497e6eec3b370c5901905696bc78af" title=
"sets a given column in a row with data given a type, value, and length.">netsnmp_set_row_column</a>(netsnmp_table_row *row, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> column,
<a name="l01229" id="l01229"></a>01229                        <span class="keywordtype">int</span> type, <span class=
"keyword">const</span> <span class="keywordtype">char</span> *value, <span class="keywordtype">size_t</span> value_len)
<a name="l01230" id="l01230"></a>01230 {
<a name="l01231" id="l01231"></a>01231     netsnmp_table_data_set_storage *data;
<a name="l01232" id="l01232"></a>01232 
<a name="l01233" id="l01233"></a>01233     <span class="keywordflow">if</span> (!row)
<a name="l01234" id="l01234"></a>01234         <span class="keywordflow">return</span> SNMPERR_GENERR;
<a name="l01235" id="l01235"></a>01235 
<a name="l01236" id="l01236"></a>01236     data = (netsnmp_table_data_set_storage *) row-&gt;data;
<a name="l01237" id="l01237"></a>01237     data = <a class="code" href=
"group__table__dataset.html#g415b0d8045da228d63325800cc6af88d" title=
"Finds a column within a given storage set, given the pointer to the start of the...">netsnmp_table_data_set_find_column</a>(data, column);
<a name="l01238" id="l01238"></a>01238 
<a name="l01239" id="l01239"></a>01239     <span class="keywordflow">if</span> (!data) {
<a name="l01240" id="l01240"></a>01240         <span class="comment">/*</span>
<a name="l01241" id="l01241"></a>01241 <span class="comment">         * create it </span>
<a name="l01242" id="l01242"></a>01242 <span class="comment">         */</span>
<a name="l01243" id="l01243"></a>01243         data = <a class="code" href="group__util.html#g9cd013bb193de5048149afeb9d94e424"
title=
"Mallocs memory of sizeof(t), zeros it and returns a pointer to it.">SNMP_MALLOC_TYPEDEF</a>(netsnmp_table_data_set_storage);
<a name="l01244" id="l01244"></a>01244         <span class="keywordflow">if</span> (!data) {
<a name="l01245" id="l01245"></a>01245             <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_CRIT, <span class=
"stringliteral">"no memory in netsnmp_set_row_column"</span>);
<a name="l01246" id="l01246"></a>01246             <span class="keywordflow">return</span> SNMPERR_MALLOC;
<a name="l01247" id="l01247"></a>01247         }
<a name="l01248" id="l01248"></a>01248 
<a name="l01249" id="l01249"></a>01249         data-&gt;column = column;
<a name="l01250" id="l01250"></a>01250         data-&gt;type = type;
<a name="l01251" id="l01251"></a>01251         data-&gt;next = row-&gt;data;
<a name="l01252" id="l01252"></a>01252         row-&gt;data = data;
<a name="l01253" id="l01253"></a>01253     }
<a name="l01254" id="l01254"></a>01254 
<a name="l01255" id="l01255"></a>01255     <span class="keywordflow">if</span> (value) {
<a name="l01256" id="l01256"></a>01256         <span class="keywordflow">if</span> (data-&gt;type != type)
<a name="l01257" id="l01257"></a>01257             <span class="keywordflow">return</span> SNMPERR_GENERR;
<a name="l01258" id="l01258"></a>01258 
<a name="l01259" id="l01259"></a>01259         <a class="code" href="group__util.html#g951e93edb6f0ea941e26155e3f8912a6" title=
"Frees a pointer only if it is !NULL and sets its value to NULL.">SNMP_FREE</a>(data-&gt;data.voidp);
<a name="l01260" id="l01260"></a>01260         <span class="keywordflow">if</span> (value_len) {
<a name="l01261" id="l01261"></a>01261             <span class="keywordflow">if</span> (<a class="code" href=
"group__util.html#ge28321822c83004ae8eedcc3de2b2fde" title=
"Duplicates a memory block.">memdup</a>(&amp;data-&gt;data.string, value, (value_len)) !=
<a name="l01262" id="l01262"></a>01262                 SNMPERR_SUCCESS) {
<a name="l01263" id="l01263"></a>01263                 <a class="code" href=
"group__snmp__logging.html#g9ba905368ea1c551b969af44b13e37c2" title=
"This snmp logging function allows variable argument list given the specified format...">snmp_log</a>(LOG_CRIT, <span class=
"stringliteral">"no memory in netsnmp_set_row_column"</span>);
<a name="l01264" id="l01264"></a>01264                 <span class="keywordflow">return</span> SNMPERR_MALLOC;
<a name="l01265" id="l01265"></a>01265             }
<a name="l01266" id="l01266"></a>01266         } <span class="keywordflow">else</span> {
<a name="l01267" id="l01267"></a>01267             data-&gt;data.string = malloc(1);
<a name="l01268" id="l01268"></a>01268         }
<a name="l01269" id="l01269"></a>01269         data-&gt;data_len = value_len;
<a name="l01270" id="l01270"></a>01270     }
<a name="l01271" id="l01271"></a>01271     <span class="keywordflow">return</span> SNMPERR_SUCCESS;
<a name="l01272" id="l01272"></a>01272 }
<a name="l01273" id="l01273"></a>01273 
<a name="l01274" id="l01274"></a>01274 <span class="comment">/* ==================================</span>
<a name="l01275" id="l01275"></a>01275 <span class="comment"> *</span>
<a name="l01276" id="l01276"></a>01276 <span class="comment"> * Data Set API: Index operations</span>
<a name="l01277" id="l01277"></a>01277 <span class="comment"> *</span>
<a name="l01278" id="l01278"></a>01278 <span class="comment"> * ================================== */</span>
<a name="l01279" id="l01279"></a>01279 
<a name="l01281" id="l01281"></a>01281 <span class="keywordtype">void</span>
<a name="l01282" id="l01282"></a><a class="code" href=
"group__table__dataset.html#gc5453f15d00c7d58881ba43109ca7709">01282</a> <a class="code" href=
"group__table__dataset.html#gc5453f15d00c7d58881ba43109ca7709" title=
"adds an index to the table.">netsnmp_table_dataset_add_index</a>(netsnmp_table_data_set *table, u_char type)
<a name="l01283" id="l01283"></a>01283 {
<a name="l01284" id="l01284"></a>01284     <span class="keywordflow">if</span> (!table)
<a name="l01285" id="l01285"></a>01285         <span class="keywordflow">return</span>;
<a name="l01286" id="l01286"></a>01286     netsnmp_table_data_add_index(table-&gt;table, type);
<a name="l01287" id="l01287"></a>01287 }
<a name="l01288" id="l01288"></a>01288 
<a name="l01291" id="l01291"></a>01291 <span class="keywordtype">void</span>
<a name="l01292" id="l01292"></a><a class="code" href=
"group__table__dataset.html#g7fceab6c9539e65c2c0cc59752d34149">01292</a> <a class="code" href=
"group__table__dataset.html#g7fceab6c9539e65c2c0cc59752d34149" title=
"adds multiple indexes to a table_dataset helper object.">netsnmp_table_set_add_indexes</a>(netsnmp_table_data_set *tset,
<a name="l01293" id="l01293"></a>01293                               ...)
<a name="l01294" id="l01294"></a>01294 {
<a name="l01295" id="l01295"></a>01295     va_list         debugargs;
<a name="l01296" id="l01296"></a>01296     <span class="keywordtype">int</span>             type;
<a name="l01297" id="l01297"></a>01297 
<a name="l01298" id="l01298"></a>01298     va_start(debugargs, tset);
<a name="l01299" id="l01299"></a>01299 
<a name="l01300" id="l01300"></a>01300     <span class="keywordflow">if</span> (tset)
<a name="l01301" id="l01301"></a>01301         <span class="keywordflow">while</span> ((type = va_arg(debugargs, <span class=
"keywordtype">int</span>)) != 0)
<a name="l01302" id="l01302"></a>01302             netsnmp_table_data_add_index(tset-&gt;table, type);
<a name="l01303" id="l01303"></a>01303 
<a name="l01304" id="l01304"></a>01304     va_end(debugargs);
<a name="l01305" id="l01305"></a>01305 }
<a name="l01306" id="l01306"></a>01306 
</pre>
    </div>
  </div>
  <hr size="1" />

  <address style="text-align: right;">
    <small>Generated on Wed Aug 26 10:35:46 2009 for net-snmp by  <a href="http://www.doxygen.org/index.html"><img src=
    "doxygen.png" alt="doxygen" align="middle" border="0" /></a> 1.5.7.1</small>
  </address>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

