<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <!-- Generated by Doxygen 1.3.9.1 -->

  <div class="qindex">
    <a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class=
    "qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class=
    "qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class=
    "qindex" href="examples.html">Examples</a>
  </div>

  <div class="nav">
    <a class="el" href="dir_000003.html">agent</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">helpers</a>
  </div>

  <h1>stash_to_next.c</h1>

  <div class="fragment">
    <pre class="fragment">
00001 <span class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
00002 
00003 <span class="preprocessor">#if HAVE_STRING_H</span>
00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
00005 <span class="preprocessor">#else</span>
00006 <span class="preprocessor">#include &lt;strings.h&gt;</span>
00007 <span class="preprocessor">#endif</span>
00008 
00009 <span class="preprocessor">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
00010 <span class="preprocessor">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</span>
00011 
00012 <span class="preprocessor">#include &lt;net-snmp/agent/stash_cache.h&gt;</span>
00013 <span class="preprocessor">#include &lt;net-snmp/agent/stash_to_next.h&gt;</span>
00014 
00026 <a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *
<a name="l00027" id="l00027"></a><a class="code" href="group__stash__to__next.html#ga0">00027</a> <a class="code" href=
"group__stash__to__next.html#ga0">netsnmp_get_stash_to_next_handler</a>(<span class="keywordtype">void</span>)
00028 {
00029     <a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler =
00030         <a class="code" href="group__handler.html#ga7">netsnmp_create_handler</a>(<span class=
"stringliteral">"stash_to_next"</span>,
00031                                netsnmp_stash_to_next_helper);
00032 
00033     <span class="keywordflow">if</span> (NULL != handler)
00034         handler-&gt;<a class="code" href="structnetsnmp__mib__handler__s.html#o2">flags</a> |= MIB_HANDLER_AUTO_NEXT;
00035 
00036     <span class="keywordflow">return</span> handler;
00037 }
00038 
00040 <span class="keywordtype">int</span>
00041 netsnmp_stash_to_next_helper(<a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler,
00042                             <a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo,
00043                             <a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00044                             <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests)
00045 {
00046 
00047     <span class="keywordtype">int</span>             ret = SNMP_ERR_NOERROR;
00048     <span class="keywordtype">int</span>             namelen;
00049     <span class="keywordtype">int</span>             finished = 0;
00050     netsnmp_oid_stash_node **cinfo;
00051     <a class="code" href="structvariable__list.html">netsnmp_variable_list</a>   *vb;
00052     <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a>    *reqtmp;
00053 
00054     <span class="comment">/*</span>
00055 <span class="comment">     * this code depends on AUTO_NEXT being set</span>
00056 <span class="comment">     */</span>
00057     netsnmp_assert(handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o2">flags</a> &amp; MIB_HANDLER_AUTO_NEXT);
00058 
00059     <span class="comment">/*</span>
00060 <span class="comment">     * Don't do anything for any modes except GET_STASH. Just return,</span>
00061 <span class="comment">     * and the agent will call the next handler (AUTO_NEXT).</span>
00062 <span class="comment">     *</span>
00063 <span class="comment">     * If the handler chain already supports GET_STASH, we don't</span>
00064 <span class="comment">     * need to do anything here either.  Once again, we just return</span>
00065 <span class="comment">     * and the agent will call the next handler (AUTO_NEXT).</span>
00066 <span class="comment">     *</span>
00067 <span class="comment">     * Otherwise, we munge the mode to GET_NEXT, and call the</span>
00068 <span class="comment">     * next handler ourselves, repeatedly until we've retrieved the</span>
00069 <span class="comment">     * full contents of the table or subtree.</span>
00070 <span class="comment">     *   Then restore the mode and return to the calling handler </span>
00071 <span class="comment">     * (setting AUTO_NEXT_OVERRRIDE so the agent knows what we did).</span>
00072 <span class="comment">     */</span>
00073     <span class="keywordflow">if</span> (MODE_GET_STASH == reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00074         <span class="keywordflow">if</span> ( reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o5">modes</a> &amp; HANDLER_CAN_STASH ) {
00075             <span class="keywordflow">return</span> ret;
00076         }
00077         cinfo  = <a class="code" href="group__stash__cache.html#ga5">netsnmp_extract_stash_cache</a>( reqinfo );
00078         reqtmp = <a class="code" href="group__util.html#ga39">SNMP_MALLOC_TYPEDEF</a>(<a class="code" href=
"structnetsnmp__request__info__s.html">netsnmp_request_info</a>);
00079         vb = reqtmp-&gt;<a class="code" href="structnetsnmp__request__info__s.html#o0">requestvb</a> = <a class="code"
href="group__util.html#ga39">SNMP_MALLOC_TYPEDEF</a>( <a class="code" href=
"structvariable__list.html">netsnmp_variable_list</a> );
00080         vb-&gt;<a class="code" href="structvariable__list.html#o3">type</a> = ASN_NULL;
00081         snmp_set_var_objid( vb, reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o2">rootoid</a>, reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o3">rootoid_len</a> );
00082 
00083         reqinfo-&gt;<a class="code" href="structnetsnmp__agent__request__info__s.html#o0">mode</a> = MODE_GETNEXT;
00084         <span class="keywordflow">while</span> (!finished) {
00085             ret = <a class="code" href=
"group__handler.html#ga17">netsnmp_call_next_handler</a>(handler, reginfo, reqinfo, reqtmp);
00086             namelen = <a class="code" href="group__util.html#ga46">SNMP_MIN</a>(vb-&gt;<a class="code" href=
"structvariable__list.html#o2">name_length</a>, reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o3">rootoid_len</a>);
00087             <span class="keywordflow">if</span> ( !<a class="code" href=
"group__library.html#ga103">snmp_oid_compare</a>( reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o2">rootoid</a>, reginfo-&gt;<a class="code" href=
"structnetsnmp__handler__registration__s.html#o3">rootoid_len</a>,
00088                                    vb-&gt;<a class="code" href="structvariable__list.html#o1">name</a>, namelen) &amp;&amp;
00089                  vb-&gt;<a class="code" href=
"structvariable__list.html#o3">type</a> != ASN_NULL &amp;&amp; vb-&gt;<a class="code" href=
"structvariable__list.html#o3">type</a> != SNMP_ENDOFMIBVIEW ) {
00090                 <span class="comment">/*</span>
00091 <span class="comment">                 * This result is relevant so save it, and prepare</span>
00092 <span class="comment">                 * the request varbind for the next query.</span>
00093 <span class="comment">                 */</span>
00094                 <a class="code" href="group__oid__stash.html#ga2">netsnmp_oid_stash_add_data</a>( cinfo, vb-&gt;<a class=
"code" href="structvariable__list.html#o1">name</a>, vb-&gt;<a class="code" href="structvariable__list.html#o2">name_length</a>,
00095                                             snmp_clone_varbind( vb ));
00096                     <span class="comment">/*</span>
00097 <span class="comment">                     * Tidy up the response structure,</span>
00098 <span class="comment">                     *  ready for retrieving the next entry</span>
00099 <span class="comment">                     */</span>
00100                 <a class="code" href="group__data__list.html#ga2">netsnmp_free_all_list_data</a>(reqtmp-&gt;<a class="code"
href="structnetsnmp__request__info__s.html#o1">parent_data</a>);
00101                 reqtmp-&gt;<a class="code" href="structnetsnmp__request__info__s.html#o1">parent_data</a> = NULL;
00102                 reqtmp-&gt;<a class="code" href="structnetsnmp__request__info__s.html#o6">processed</a> = 0;
00103                 vb-&gt;<a class="code" href="structvariable__list.html#o3">type</a> = ASN_NULL;
00104             } <span class="keywordflow">else</span> {
00105                 finished = 1;
00106             }
00107         }
00108         reqinfo-&gt;<a class="code" href="structnetsnmp__agent__request__info__s.html#o0">mode</a> = MODE_GET_STASH;
00109 
00110         <span class="comment">/*</span>
00111 <span class="comment">         * let the handler chain processing know that we've already</span>
00112 <span class="comment">         * called the next handler</span>
00113 <span class="comment">         */</span>
00114         handler-&gt;<a class="code" href=
"structnetsnmp__mib__handler__s.html#o2">flags</a> |= MIB_HANDLER_AUTO_NEXT_OVERRIDE_ONCE;
00115     }
00116 
00117     <span class="keywordflow">return</span> ret;
00118 }
</pre>
  </div>
  <hr size="1" />

  <address style="align: right;">
    <small>Generated on Fri Dec 30 13:47:50 2005 for net-snmp by&nbsp; <a href="http://www.doxygen.org/index.html"><img src=
    "doxygen.png" alt="doxygen" align="middle" border="0" /></a> 1.3.9.1</small>
  </address>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

