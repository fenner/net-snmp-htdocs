<!--#set var="section" value="development" -->
<!--#include virtual="/page-top.html" -->
<!-- CONTENT START -->
  <!-- Generated by Doxygen 1.3.9.1 -->

  <div class="qindex">
    <a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class=
    "qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class=
    "qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class=
    "qindex" href="examples.html">Examples</a>
  </div>

  <div class="nav">
    <a class="el" href="dir_000003.html">agent</a>&nbsp;/&nbsp;<a class="el" href=
    "dir_000007.html">mibgroup</a>&nbsp;/&nbsp;<a class="el" href="dir_000008.html">examples</a>
  </div>

  <h1>netSnmpHostsTable.c</h1>

  <div class="fragment">
    <pre class="fragment">
00001 <span class="comment">/*</span>
00002 <span class="comment"> * Note: this file originally auto-generated by mib2c using</span>
00003 <span class="comment"> *        : mib2c.iterate_access.conf,v 1.4 2003/07/01 00:15:11 hardaker Exp $</span>
00004 <span class="comment"> */</span>
00005 
00006 <span class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
00007 <span class="preprocessor">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
00008 <span class="preprocessor">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</span>
00009 <span class="preprocessor">#include "netSnmpHostsTable.h"</span>
00010 <span class="preprocessor">#include "netSnmpHostsTable_checkfns.h"</span>
00011 <span class="preprocessor">#include "netSnmpHostsTable_access.h"</span>
00012 
00013 <span class="keyword">static</span> netsnmp_oid_stash_node *undoStorage = NULL;
00014 <span class="keyword">static</span> netsnmp_oid_stash_node *commitStorage = NULL;
00015 
00016 <span class="keyword">struct </span>undoInfo {
00017     <span class="keywordtype">void</span>           *ptr;
00018     size_t          len;
00019 };
00020 
00021 <span class="keyword">struct </span>commitInfo {
00022     <span class="keywordtype">void</span>           *data_context;
00023     <span class="keywordtype">int</span>             have_committed;
00024     <span class="keywordtype">int</span>             new_row;
00025 };
00026 
00027 <span class="keywordtype">void</span>
00028 netSnmpHostsTable_free_undoInfo(<span class="keywordtype">void</span> *vptr)
00029 {
00030     <span class="keyword">struct </span>undoInfo *ui = vptr;
00031     <span class="keywordflow">if</span> (!ui)
00032         <span class="keywordflow">return</span>;
00033     <a class="code" href="group__util.html#ga36">SNMP_FREE</a>(ui-&gt;ptr);
00034     <a class="code" href="group__util.html#ga36">SNMP_FREE</a>(ui);
00035 }
00036 
00038 <span class="keywordtype">void</span>
00039 initialize_table_netSnmpHostsTable(<span class="keywordtype">void</span>)
00040 {
00041     <span class="keyword">static</span> oid      netSnmpHostsTable_oid[] =
00042         { 1, 3, 6, 1, 4, 1, 8072, 2, 2, 2 };
00043     <a class="code" href=
"structnetsnmp__table__registration__info__s.html">netsnmp_table_registration_info</a> *table_info;
00044     <a class="code" href="structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *my_handler;
00045     <a class="code" href="structnetsnmp__iterator__info__s.html">netsnmp_iterator_info</a> *iinfo;
00046 
00048     table_info = <a class="code" href="group__util.html#ga39">SNMP_MALLOC_TYPEDEF</a>(<a class="code" href=
"structnetsnmp__table__registration__info__s.html">netsnmp_table_registration_info</a>);
00049     iinfo = <a class="code" href="group__util.html#ga39">SNMP_MALLOC_TYPEDEF</a>(<a class="code" href=
"structnetsnmp__iterator__info__s.html">netsnmp_iterator_info</a>);
00050 
00053     my_handler = netsnmp_create_handler_registration(<span class="stringliteral">"netSnmpHostsTable"</span>,
00054                                                      netSnmpHostsTable_handler,
00055                                                      netSnmpHostsTable_oid,
00056                                                      OID_LENGTH
00057                                                      (netSnmpHostsTable_oid),
00058                                                      HANDLER_CAN_RWRITE);
00059 
00060     <span class="keywordflow">if</span> (!my_handler || !table_info || !iinfo) {
00061         <a class="code" href="group__snmp__logging.html#ga41">snmp_log</a>(LOG_ERR,
00062                  <span class="stringliteral">"malloc failed in initialize_table_netSnmpHostsTable"</span>);
00063         <span class="keywordflow">return</span>; 
00064     }
00065 
00066     <span class="comment">/***************************************************</span>
00067 <span class="comment">     * Setting up the table's definition</span>
00068 <span class="comment">     */</span>
00069     netsnmp_table_helper_add_indexes(table_info, ASN_OCTET_STR,
00071                                      0);
00072 
00075     table_info-&gt;<a class="code" href="structnetsnmp__table__registration__info__s.html#o2">min_column</a> = 2;
00076     table_info-&gt;<a class="code" href="structnetsnmp__table__registration__info__s.html#o3">max_column</a> = 5;
00077 
00079     iinfo-&gt;<a class="code" href=
"structnetsnmp__iterator__info__s.html#o0">get_first_data_point</a> = netSnmpHostsTable_get_first_data_point;
00080     iinfo-&gt;<a class="code" href=
"structnetsnmp__iterator__info__s.html#o1">get_next_data_point</a> = netSnmpHostsTable_get_next_data_point;
00081 
00083     iinfo-&gt;<a class="code" href=
"structnetsnmp__iterator__info__s.html#o2">make_data_context</a> = netSnmpHostsTable_context_convert_function;
00084     iinfo-&gt;<a class="code" href=
"structnetsnmp__iterator__info__s.html#o4">free_data_context</a> = netSnmpHostsTable_data_free;
00085     iinfo-&gt;<a class="code" href=
"structnetsnmp__iterator__info__s.html#o5">free_loop_context_at_end</a> = netSnmpHostsTable_loop_free;
00086 
00088     iinfo-&gt;<a class="code" href="structnetsnmp__iterator__info__s.html#o8">table_reginfo</a> = table_info;
00089 
00090     <span class="comment">/***************************************************</span>
00091 <span class="comment">     * registering the table with the master agent</span>
00092 <span class="comment">     */</span>
00093     DEBUGMSGTL((<span class="stringliteral">"initialize_table_netSnmpHostsTable"</span>,
00094                 <span class="stringliteral">"Registering table netSnmpHostsTable as a table iterator\n"</span>));
00095     <a class="code" href="group__table__iterator.html#ga11">netsnmp_register_table_iterator</a>(my_handler, iinfo);
00096 }
00097 
00099 <span class="keywordtype">void</span>
00100 init_netSnmpHostsTable(<span class="keywordtype">void</span>)
00101 {
00102 
00104     initialize_table_netSnmpHostsTable();
00105 }
00106 
00108 <span class="keywordtype">int</span>
00109 netSnmpHostsTable_handler(<a class="code" href="structnetsnmp__mib__handler__s.html">netsnmp_mib_handler</a> *handler,
00110                           <a class="code" href=
"structnetsnmp__handler__registration__s.html">netsnmp_handler_registration</a> *reginfo,
00111                           <a class="code" href=
"structnetsnmp__agent__request__info__s.html">netsnmp_agent_request_info</a> *reqinfo,
00112                           <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a> *requests)
00113 {
00114 
00115     <a class="code" href="structnetsnmp__request__info__s.html">netsnmp_request_info</a> *request;
00116     <a class="code" href="structnetsnmp__table__request__info__s.html">netsnmp_table_request_info</a> *table_info;
00117     <a class="code" href="structvariable__list.html">netsnmp_variable_list</a> *var;
00118     <span class="keyword">struct </span>commitInfo *ci = NULL;
00119 
00120     <span class="keywordtype">void</span>           *data_context = NULL;
00121 
00122     oid            *suffix;
00123     size_t          suffix_len;
00124 
00125     <span class="keywordflow">for</span> (request = requests; request; request = request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o13">next</a>) {
00126         <span class="comment">/* column and row index encoded portion */</span>
00127         var = request-&gt;<a class="code" href="structnetsnmp__request__info__s.html#o0">requestvb</a>;
00128         suffix     = var-&gt;<a class="code" href="structvariable__list.html#o1">name</a> + reginfo-&gt;<a class="code"
href="structnetsnmp__handler__registration__s.html#o3">rootoid_len</a> + 1;
00129         suffix_len = var-&gt;<a class="code" href="structvariable__list.html#o2">name_length</a> - (reginfo-&gt;<a class=
"code" href="structnetsnmp__handler__registration__s.html#o3">rootoid_len</a> + 1);
00130 
00131         <span class="keywordflow">if</span> (request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o6">processed</a> != 0)
00132             <span class="keywordflow">continue</span>;
00133 
00134         <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00135         <span class="keywordflow">case</span> MODE_GET:
00136         <span class="keywordflow">case</span> MODE_SET_RESERVE1:
00137             data_context = <a class="code" href=
"group__table__iterator.html#ga12">netsnmp_extract_iterator_context</a>(request);
00138             <span class="keywordflow">if</span> (data_context == NULL) {
00139                 <span class="keywordflow">if</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a> == MODE_GET) {
00140                     <a class="code" href="group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request,
00141                                               SNMP_NOSUCHINSTANCE);
00142                     <span class="keywordflow">continue</span>;
00143                 }
00144             }
00145             <span class="keywordflow">break</span>;
00146 
00147         <span class="keywordflow">default</span>:               <span class="comment">/* == the other SET modes */</span>
00148             ci = <a class="code" href="group__oid__stash.html#ga5">netsnmp_oid_stash_get_data</a>(commitStorage,
00149                                             suffix + 1, suffix_len - 1);
00150             <span class="keywordflow">break</span>;
00151 
00152         }
00153 
00155         table_info = <a class="code" href="group__table.html#ga2">netsnmp_extract_table_info</a>(request);
00161         <span class="keywordflow">if</span> (table_info == NULL) {
00162             <span class="keywordflow">continue</span>;
00163         }
00164 
00165         <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00166         <span class="keywordflow">case</span> MODE_GET:
00167             <span class="keywordflow">switch</span> (table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#o0">colnum</a>) {
00168             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESSTYPE:
00169                 {
00170                     <span class="keywordtype">long</span>           *retval;
00171                     size_t          retval_len = 0;
00172                     retval =
00173                         get_netSnmpHostAddressType(data_context,
00174                                                    &amp;retval_len);
00175                     <a class="code" href="group__snmp__client.html#ga19">snmp_set_var_typed_value</a>(var, ASN_INTEGER,
00176                                              (<span class="keyword">const</span> u_char *) retval,
00177                                              retval_len);
00178                 }
00179                 <span class="keywordflow">break</span>;
00180 
00181             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESS:
00182                 {
00183                     <span class="keywordtype">char</span>           *retval;
00184                     size_t          retval_len = 0;
00185                     retval =
00186                         get_netSnmpHostAddress(data_context, &amp;retval_len);
00187                     <a class="code" href="group__snmp__client.html#ga19">snmp_set_var_typed_value</a>(var, ASN_OCTET_STR,
00188                                              (<span class="keyword">const</span> u_char *) retval,
00189                                              retval_len);
00190                 }
00191                 <span class="keywordflow">break</span>;
00192 
00193             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTSTORAGE:
00194                 {
00195                     <span class="keywordtype">long</span>           *retval;
00196                     size_t          retval_len = 0;
00197                     retval =
00198                         get_netSnmpHostStorage(data_context, &amp;retval_len);
00199                     <a class="code" href="group__snmp__client.html#ga19">snmp_set_var_typed_value</a>(var, ASN_INTEGER,
00200                                              (<span class="keyword">const</span> u_char *) retval,
00201                                              retval_len);
00202                 }
00203                 <span class="keywordflow">break</span>;
00204 
00205             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTROWSTATUS:
00206                 {
00207                     <span class="keywordtype">long</span>           *retval;
00208                     size_t          retval_len = 0;
00209                     retval =
00210                         get_netSnmpHostRowStatus(data_context,
00211                                                  &amp;retval_len);
00212                     <a class="code" href="group__snmp__client.html#ga19">snmp_set_var_typed_value</a>(var, ASN_INTEGER,
00213                                              (<span class="keyword">const</span> u_char *) retval,
00214                                              retval_len);
00215                 }
00216                 <span class="keywordflow">break</span>;
00217 
00218             <span class="keywordflow">default</span>:
00220                 <a class="code" href="group__snmp__logging.html#ga41">snmp_log</a>(LOG_ERR,
00221                          <span class=
"stringliteral">"problem encountered in netSnmpHostsTable_handler: unknown column\n"</span>);
00222             }
00223             <span class="keywordflow">break</span>;
00224 
00225         <span class="keywordflow">case</span> MODE_SET_RESERVE1:
00226             ci = <a class="code" href="group__oid__stash.html#ga5">netsnmp_oid_stash_get_data</a>(commitStorage,
00227                                             suffix + 1, suffix_len - 1);
00228 
00229             <span class="keywordflow">if</span> (!ci) {
00231                 ci = <a class="code" href="group__util.html#ga38">SNMP_MALLOC_STRUCT</a>(commitInfo);
00232                 <span class="keywordflow">if</span> (!data_context) {
00233                     ci-&gt;data_context =
00234                         netSnmpHostsTable_create_data_context(table_info-&gt;
00235                                                               indexes);
00236                     ci-&gt;new_row = 1;
00237                 } <span class="keywordflow">else</span> {
00238                     ci-&gt;data_context = data_context;
00239                 }
00240                 <a class="code" href="group__oid__stash.html#ga2">netsnmp_oid_stash_add_data</a>(&amp;commitStorage,
00241                                            suffix + 1, suffix_len - 1, ci);
00242             }
00243             <span class="keywordflow">break</span>;
00244 
00245         <span class="keywordflow">case</span> MODE_SET_RESERVE2:
00246             <span class="keywordflow">switch</span> (table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#o0">colnum</a>) {
00247             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESSTYPE:
00248                 {
00249                     <span class="keywordtype">long</span>           *retval;
00250                     size_t          retval_len = 0;
00251                     <span class="keyword">struct </span>undoInfo *ui = NULL;
00252                     <span class="keywordtype">int</span>             ret;
00253 
00255                     retval =
00256                         get_netSnmpHostAddressType(ci-&gt;data_context,
00257                                                    &amp;retval_len);
00258                     <span class="keywordflow">if</span> (retval) {
00259                         ui = <a class="code" href="group__util.html#ga38">SNMP_MALLOC_STRUCT</a>(undoInfo);
00260                         ui-&gt;len = retval_len;
00261                         <a class="code" href="group__util.html#ga5">memdup</a>((u_char **) &amp; ui-&gt;ptr,
00262                                (u_char *) retval, ui-&gt;len);
00263                     }
00264 
00267                     ret =
00268                         check_netSnmpHostAddressType(request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00269                                                      type,
00270                                                      (<span class="keywordtype">long</span> *) request-&gt;
00271                                                      requestvb-&gt;val.string,
00272                                                      request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00273                                                      val_len, retval,
00274                                                      retval_len);
00275                     <span class="keywordflow">if</span> (ret != 0) {
00276                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00277                         netSnmpHostsTable_free_undoInfo(ui);
00278                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ui) {
00280                         <a class="code" href="group__oid__stash.html#ga2">netsnmp_oid_stash_add_data</a>(&amp;undoStorage,
00281                                                    suffix, suffix_len, ui);
00282                     }
00283 
00284                 }
00285                 <span class="keywordflow">break</span>;
00286             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESS:
00287                 {
00288                     <span class="keywordtype">char</span>           *retval;
00289                     size_t          retval_len = 0;
00290                     <span class="keyword">struct </span>undoInfo *ui = NULL;
00291                     <span class="keywordtype">int</span>             ret;
00292 
00294                     retval =
00295                         get_netSnmpHostAddress(ci-&gt;data_context,
00296                                                &amp;retval_len);
00297                     <span class="keywordflow">if</span> (retval) {
00298                         ui = <a class="code" href="group__util.html#ga38">SNMP_MALLOC_STRUCT</a>(undoInfo);
00299                         ui-&gt;len = retval_len;
00300                         <a class="code" href="group__util.html#ga5">memdup</a>((u_char **) &amp; ui-&gt;ptr,
00301                                (u_char *) retval, ui-&gt;len);
00302                     }
00303 
00306                     ret =
00307                         check_netSnmpHostAddress(request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#o3">type</a>,
00308                                                  (<span class="keywordtype">char</span> *) request-&gt;
00309                                                  requestvb-&gt;val.string,
00310                                                  request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00311                                                  val_len, retval,
00312                                                  retval_len);
00313                     <span class="keywordflow">if</span> (ret != 0) {
00314                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00315                         netSnmpHostsTable_free_undoInfo(ui);
00316                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ui) {
00318                         <a class="code" href="group__oid__stash.html#ga2">netsnmp_oid_stash_add_data</a>(&amp;undoStorage,
00319                                                    suffix, suffix_len, ui);
00320                     }
00321 
00322                 }
00323                 <span class="keywordflow">break</span>;
00324             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTSTORAGE:
00325                 {
00326                     <span class="keywordtype">long</span>           *retval;
00327                     size_t          retval_len = 0;
00328                     <span class="keyword">struct </span>undoInfo *ui = NULL;
00329                     <span class="keywordtype">int</span>             ret;
00330 
00332                     retval =
00333                         get_netSnmpHostStorage(ci-&gt;data_context,
00334                                                &amp;retval_len);
00335                     <span class="keywordflow">if</span> (retval) {
00336                         ui = <a class="code" href="group__util.html#ga38">SNMP_MALLOC_STRUCT</a>(undoInfo);
00337                         ui-&gt;len = retval_len;
00338                         <a class="code" href="group__util.html#ga5">memdup</a>((u_char **) &amp; ui-&gt;ptr,
00339                                (u_char *) retval, ui-&gt;len);
00340                     }
00341 
00344                     ret =
00345                         check_netSnmpHostStorage(request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href="structvariable__list.html#o3">type</a>,
00346                                                  (<span class="keywordtype">long</span> *) request-&gt;
00347                                                  requestvb-&gt;val.string,
00348                                                  request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00349                                                  val_len, retval,
00350                                                  retval_len);
00351                     <span class="keywordflow">if</span> (ret != 0) {
00352                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00353                         netSnmpHostsTable_free_undoInfo(ui);
00354                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ui) {
00356                         <a class="code" href="group__oid__stash.html#ga2">netsnmp_oid_stash_add_data</a>(&amp;undoStorage,
00357                                                    suffix, suffix_len, ui);
00358                     }
00359 
00360                 }
00361                 <span class="keywordflow">break</span>;
00362             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTROWSTATUS:
00363                 {
00364                     <span class="keywordtype">long</span>           *retval;
00365                     size_t          retval_len = 0;
00366                     <span class="keyword">struct </span>undoInfo *ui = NULL;
00367                     <span class="keywordtype">int</span>             ret;
00368 
00370                     retval =
00371                         get_netSnmpHostRowStatus(ci-&gt;data_context,
00372                                                  &amp;retval_len);
00373                     <span class="keywordflow">if</span> (retval) {
00374                         ui = <a class="code" href="group__util.html#ga38">SNMP_MALLOC_STRUCT</a>(undoInfo);
00375                         ui-&gt;len = retval_len;
00376                         <a class="code" href="group__util.html#ga5">memdup</a>((u_char **) &amp; ui-&gt;ptr,
00377                                (u_char *) retval, ui-&gt;len);
00378                     }
00379 
00382                     ret =
00383                         check_netSnmpHostRowStatus(request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00384                                                    type,
00385                                                    (<span class="keywordtype">long</span> *) request-&gt;
00386                                                    requestvb-&gt;val.string,
00387                                                    request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00388                                                    val_len, retval,
00389                                                    retval_len);
00390                     <span class="keywordflow">if</span> (ret != 0) {
00391                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00392                         netSnmpHostsTable_free_undoInfo(ui);
00393                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ui) {
00395                         <a class="code" href="group__oid__stash.html#ga2">netsnmp_oid_stash_add_data</a>(&amp;undoStorage,
00396                                                    suffix, suffix_len, ui);
00397                     }
00398 
00399                 }
00400                 <span class="keywordflow">break</span>;
00401             <span class="keywordflow">default</span>:
00402                 <a class="code" href="group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request,
00403                                           SNMP_ERR_NOTWRITABLE);
00404                 <span class="keywordflow">break</span>;
00405             }
00406             <span class="keywordflow">break</span>;
00407 
00408         <span class="keywordflow">case</span> MODE_SET_ACTION:
00410             <span class="keywordflow">switch</span> (table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#o0">colnum</a>) {
00411             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESSTYPE:
00412                 {
00413                     <span class="keywordtype">int</span>             ret;
00414                     ret = set_netSnmpHostAddressType(ci-&gt;data_context,
00415                                                      (<span class="keywordtype">long</span> *) request-&gt;
00416                                                      requestvb-&gt;val.string,
00417                                                      request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00418                                                      val_len);
00419                     <span class="keywordflow">if</span> (ret) {
00420                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00421                     }
00422                 }
00423                 <span class="keywordflow">break</span>;
00424             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESS:
00425                 {
00426                     <span class="keywordtype">int</span>             ret;
00427                     ret = set_netSnmpHostAddress(ci-&gt;data_context,
00428                                                  (<span class="keywordtype">char</span> *) request-&gt;
00429                                                  requestvb-&gt;val.string,
00430                                                  request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00431                                                  val_len);
00432                     <span class="keywordflow">if</span> (ret) {
00433                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00434                     }
00435                 }
00436                 <span class="keywordflow">break</span>;
00437             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTSTORAGE:
00438                 {
00439                     <span class="keywordtype">int</span>             ret;
00440                     ret = set_netSnmpHostStorage(ci-&gt;data_context,
00441                                                  (<span class="keywordtype">long</span> *) request-&gt;
00442                                                  requestvb-&gt;val.string,
00443                                                  request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00444                                                  val_len);
00445                     <span class="keywordflow">if</span> (ret) {
00446                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00447                     }
00448                 }
00449                 <span class="keywordflow">break</span>;
00450             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTROWSTATUS:
00451                 {
00452                     <span class="keywordtype">int</span>             ret;
00453                     ret = set_netSnmpHostRowStatus(ci-&gt;data_context,
00454                                                    (<span class="keywordtype">long</span> *) request-&gt;
00455                                                    requestvb-&gt;val.string,
00456                                                    request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;
00457                                                    val_len);
00458                     <span class="keywordflow">if</span> (ret) {
00459                         <a class="code" href=
"group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request, ret);
00460                     }
00461                     <span class="keywordflow">if</span> (*request-&gt;<a class="code" href=
"structnetsnmp__request__info__s.html#o0">requestvb</a>-&gt;<a class="code" href=
"structvariable__list.html#o4">val</a>.integer == RS_DESTROY) {
00462                         ci-&gt;new_row = -1;
00463                     }
00464                 }
00465                 <span class="keywordflow">break</span>;
00466             }
00467             <span class="keywordflow">break</span>;
00468 
00469         <span class="keywordflow">case</span> MODE_SET_COMMIT:
00470             <span class="keywordflow">if</span> (!ci-&gt;have_committed) {
00472                 netSnmpHostsTable_commit_row(&amp;ci-&gt;data_context,
00473                                              ci-&gt;new_row);
00474                 ci-&gt;have_committed = 1;
00475             }
00476             <span class="keywordflow">break</span>;
00477 
00478         <span class="keywordflow">case</span> MODE_SET_UNDO:
00480             <span class="keywordflow">switch</span> (table_info-&gt;<a class="code" href=
"structnetsnmp__table__request__info__s.html#o0">colnum</a>) {
00481             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESSTYPE:
00482                 {
00483                     <span class="keywordtype">int</span>             retval;
00484                     <span class="keyword">struct </span>undoInfo *ui;
00485                     ui = <a class="code" href="group__oid__stash.html#ga5">netsnmp_oid_stash_get_data</a>(undoStorage,
00486                                                     suffix, suffix_len);
00487                     retval =
00488                         set_netSnmpHostAddressType(ci-&gt;data_context,
00489                                                    ui-&gt;ptr, ui-&gt;len);
00490                     <span class="keywordflow">if</span> (retval) {
00491                         <a class="code" href="group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request,
00492                                                   SNMP_ERR_UNDOFAILED);
00493                     }
00494                 }
00495                 <span class="keywordflow">break</span>;
00496             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTADDRESS:
00497                 {
00498                     <span class="keywordtype">int</span>             retval;
00499                     <span class="keyword">struct </span>undoInfo *ui;
00500                     ui = <a class="code" href="group__oid__stash.html#ga5">netsnmp_oid_stash_get_data</a>(undoStorage,
00501                                                     suffix, suffix_len);
00502                     retval =
00503                         set_netSnmpHostAddress(ci-&gt;data_context, ui-&gt;ptr,
00504                                                ui-&gt;len);
00505                     <span class="keywordflow">if</span> (retval) {
00506                         <a class="code" href="group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request,
00507                                                   SNMP_ERR_UNDOFAILED);
00508                     }
00509                 }
00510                 <span class="keywordflow">break</span>;
00511             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTSTORAGE:
00512                 {
00513                     <span class="keywordtype">int</span>             retval;
00514                     <span class="keyword">struct </span>undoInfo *ui;
00515                     ui = <a class="code" href="group__oid__stash.html#ga5">netsnmp_oid_stash_get_data</a>(undoStorage,
00516                                                     suffix, suffix_len);
00517                     retval =
00518                         set_netSnmpHostStorage(ci-&gt;data_context, ui-&gt;ptr,
00519                                                ui-&gt;len);
00520                     <span class="keywordflow">if</span> (retval) {
00521                         <a class="code" href="group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request,
00522                                                   SNMP_ERR_UNDOFAILED);
00523                     }
00524                 }
00525                 <span class="keywordflow">break</span>;
00526             <span class="keywordflow">case</span> COLUMN_NETSNMPHOSTROWSTATUS:
00527                 {
00528                     <span class="keywordtype">int</span>             retval;
00529                     <span class="keyword">struct </span>undoInfo *ui;
00530                     ui = <a class="code" href="group__oid__stash.html#ga5">netsnmp_oid_stash_get_data</a>(undoStorage,
00531                                                     suffix, suffix_len);
00532                     retval =
00533                         set_netSnmpHostRowStatus(ci-&gt;data_context, ui-&gt;ptr,
00534                                                  ui-&gt;len);
00535                     <span class="keywordflow">if</span> (retval) {
00536                         <a class="code" href="group__snmp__agent.html#ga83">netsnmp_set_request_error</a>(reqinfo, request,
00537                                                   SNMP_ERR_UNDOFAILED);
00538                     }
00539                 }
00540                 <span class="keywordflow">break</span>;
00541             }
00542             <span class="keywordflow">break</span>;
00543 
00544         <span class="keywordflow">case</span> MODE_SET_FREE:
00545             <span class="keywordflow">break</span>;
00546 
00547         <span class="keywordflow">default</span>:
00548             <a class="code" href="group__snmp__logging.html#ga41">snmp_log</a>(LOG_ERR,
00549                      <span class=
"stringliteral">"problem encountered in netSnmpHostsTable_handler: unsupported mode\n"</span>);
00550         }
00551     }
00552 
00554     <span class="keywordflow">switch</span> (reqinfo-&gt;<a class="code" href=
"structnetsnmp__agent__request__info__s.html#o0">mode</a>) {
00555     <span class="keywordflow">case</span> MODE_SET_UNDO:
00556     <span class="keywordflow">case</span> MODE_SET_FREE:
00557     <span class="keywordflow">case</span> MODE_SET_COMMIT:
00559         <a class="code" href="group__oid__stash.html#ga9">netsnmp_oid_stash_free</a>(&amp;undoStorage,
00560                                netSnmpHostsTable_free_undoInfo);
00561         <a class="code" href=
"group__oid__stash.html#ga9">netsnmp_oid_stash_free</a>(&amp;commitStorage, netsnmp_oid_stash_no_free);
00562     }
00563 
00564 
00565     <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
00566 }
</pre>
  </div>
  <hr size="1" />

  <address style="align: right;">
    <small>Generated on Fri Dec 30 13:47:45 2005 for net-snmp by&nbsp; <a href="http://www.doxygen.org/index.html"><img src=
    "doxygen.png" alt="doxygen" align="middle" border="0" /></a> 1.3.9.1</small>
  </address>
<!-- CONTENT END -->
<!--#include virtual="/page-bottom.html" -->

